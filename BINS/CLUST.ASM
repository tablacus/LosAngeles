;
;	CLUST	by Larn M.R.
;
	$INCLUDE	LA.DEF
;
	ORG	$3000
;
	LD	A,$1A
	CALL	#PRINT
	LD	IX,(#IBFAD)
	CALL	#FILE
	JP	C,USAGE
	LD	A,(IX+1)
	CP	"/"
	JP	Z,USAGE
	CP	"-"
	JP	Z,USAGE
	CP	$20
	JR	NZ,MAIN
	LD	DE,WILD
	CALL	#FILEX
MAIN:
	LD	A,(#WIDTH)
	CP	40
	JR	NZ,MAIN0
	LD	(PATCH1+1),5
MAIN0:
	CALL	#RDFAT
	CALL	#MOTOFF
	CALL	NC,#SOPENX
MAIN1:
	RET	C
;
	LD	B,8
NAME1:
	LD	A,(HL)
	INC	HL
	CALL	#PRINT
	DJNZ	NAME1
	LD	A,"."
	CALL	#PRINT
	LD	B,3
NAME2:
	LD	A,(HL)
	INC	HL
	CALL	#PRINT
	DJNZ	NAME2
	CALL	#PRNTS
;
	LD	DE,$001A-11
	ADD	HL,DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
;
MAIN2:
PATCH1:	LD	B,13
MAIN3:
	CALL	#PRNTS
	EX	DE,HL
	CALL	#PRTHL
	EX	DE,HL
;
	PUSH	BC
	CALL	#GNCL
	POP	BC
	CALL	#ENDCL
	JR	NC,MAINE
	DJNZ	MAIN3
	CALL	#PAUSE
	DW	PAUSEX
	CALL	#LTNL
	LD	B,13
SPACE:
	CALL	#PRNTS
	DJNZ	SPACE
	JR	MAIN2
;
MAINE:
	CALL	#LTNL
	LD	A,(#WILD)
	OR	A
	RET	Z
	CALL	#PAUSE
	DW	PAUSEX
	CALL	#NOPENX
	JP	NC,MAIN1
	RET	Z
PAUSEX:
	AND	A
	RET
;
USAGE:	CALL	#MPRNT
	DB	"clust v1.01"
	DB	" Lovers",$0D
	DB	"usage:",$0D
	DB	" CLUST [filename]",$0D
	DB	0
	AND	A
	RET
;
WILD:	DB	"*.*",0
;
