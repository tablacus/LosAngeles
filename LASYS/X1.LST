                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.0.0, LST:Full:4
                                ;
                                ;   L-os Angeles for X1/turbo/Z
                                ;
                                ;   Programmed by
                                ;
                                ;   Gaku Nakagawa as Larn M.R.(Lovers)
                                ;
       0001                     VH  EQU 1
       0040                     VL  EQU $40 ;v1.40
                                ;
                                    INCLUDE "X1IOCS.ASM"
                                ;
                                ;   X1-IOCS CALL
                                ;
                                
       FFC0                     EXTSP   EQU 0FFC0H
       0000                     STACK   EQU 00000H
       0019                     LINE    EQU 25
                                
000000 0000                         ORG $0000
000000 0000 C3FA00          10      JP  IOCS_BOOT
       0003                     AT_GETL:
000003 0003 C3120E          10      JP  IOCS_GETL
                                
000007 0007                         ORG $0007
       0007                     AT_WIDTH:
000007 0007 50                      DB  80
                                
00000E 000E                         ORG $000E
       000E                     AT_XYADR:
00000E 000E 0000                    DW  0
000010 0010 0000                _TXADR: DW  0
                                
000013 0013                         ORG $0013
       0013                     AT_PRINT:
000013 0013 C3650B          10      JP  IOCS_PRINT
                                
000018 0018                         ORG $0018
000018 0018 C3D404          10      JP  BIOS
                                
       001B                     AT_CONYS:
00001B 001B 00                      DB  0
       001C                     AT_CONYE:
00001C 001C 19                      DB  MAXLN
                                
00001E 001E                         ORG $001E
       001E                     AT_CONXS:
00001E 001E 00                      DB  0
       001F                     AT_CONXE:
00001F 001F 50                      DB  WIDTH
                                
000026 0026                         ORG $0026
       0026                     AT_COLORF:
000026 0026 07                      DB  7
                                
00002E 002E                         ORG $002E
       002E                     AT_KEY: 
       002E                     _KEYD:
00002E 002E 00FF                    DW  0FF00H
                                
000038 0038                         ORG $0038
000038 0038 C3FD1F          10      JP  _COLD
                                
00004D 004D                         ORG $004D
       004D                     AT_WIDCH:
00004D 004D C3EB04          10      JP  IOCS_WIDCH
                                
000052 0052                         ORG $0052
000052 0052 0007                INTVEC: DW  INT
                                
000066 0066                         ORG $0066
       0066                     NMI:
000066 0066 C3FD1F          10      JP  _COLD
                                
000080 0080                         ORG $0080
000080 0080 1C07                CTC0:   DW  INTCTCE
000082 0082 1C07                CTC1:   DW  INTCTCE
000084 0084 3E07                CTC2:   DW  INTCTC2
000086 0086 1C07                CTC3:   DW  INTCTCE
000088 0088 0000                _CTC:   DW  0
                                
0000FA 00FA                         ORG $00FA
       00FA                     IOCS_BOOT:
0000FA 00FA F3               4      DI
0000FB 00FB ED5E             8      IM  2
0000FD 00FD 310000          10      LD  SP,STACK
000100 0100 21FD1F          10      LD  HL,_COLD
000103 0103 220100          16      LD  ($0001),HL
000106 0106 214C26          10      LD  HL,BIOS_SRC
000109 0109 1151FF          10      LD  DE,BIOS_DEST
00010C 010C 011B00          10      LD  BC,BIOS_END-BIOS_DEST
00010F 010F EDB0                    LDIR
                                
000111 0111 010000          10      LD  BC,0
000114 0114 ED438800        20      LD  (_CTC),BC
000118 0118 01040A          10      LD  BC,00A04H
00011B 011B CDAC01          17      CALL    CHKCTC
00011E 011E 010407          10      LD  BC,00704H
000121 0121 CDAC01          17      CALL    CHKCTC
000124 0124 01A81F          10      LD  BC,01FA8H
000127 0127 CDAC01          17      CALL    CHKCTC
00012A 012A 01A01F          10      LD  BC,01FA0H
00012D 012D CDAC01          17      CALL    CHKCTC
                                
000130 0130 0E80             7      LD  C,080H      ;INIT DMA
000132 0132 2106C3          10      LD  HL,0C306H
       0135                     INIDMA:
000135 0135 ED61            12      OUT (C),H
000137 0137 2D               4      DEC L
000138 0138 20FB            12      JR  NZ,INIDMA
                                
00013A 013A 3E50             7      LD  A,80
00013C 013C CD4D00          17      CALL    AT_WIDCH
                                
00013F 013F 01AA10          10      LD  BC,010AAH   ;PALET
000142 0142 ED49            12      OUT (C),C
000144 0144 01CC11          10      LD  BC,011CCH
000147 0147 ED49            12      OUT (C),C
000149 0149 01F012          10      LD  BC,012F0H
00014C 014C ED49            12      OUT (C),C
00014E 014E 04               4      INC B
00014F 014F ED71                    DB  0EDH,071H
                                
000151 0151 3EE4             7      LD  A,0E4H
000153 0153 CDFE0D          17      CALL    COMOUT
000156 0156 AF               4      XOR A
000157 0157 CD070E          17      CALL    OT49SB
                                
00015A 015A 3E00             7      LD  A,INTVEC/256
00015C 015C ED47             9      LD  I,A
                                
00015E 015E ED4B8800        20      LD  BC,(_CTC)
000162 0162 0B               6      DEC BC
000163 0163 0B               6      DEC BC
                                
000164 0164 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
000166 0166 3E80             7      LD  A,CTC0
000168 0168 ED79            12      OUT (C),A
                                
00016A 016A 0C               4      INC C
00016B 016B 3E47             7      LD  A,047H
00016D 016D ED79            12      OUT (C),A
00016F 016F 3E0D             7      LD  A,13        ;Baudrate 9600-13
000171 0171 ED79            12      OUT (C),A
                                
000173 0173 3EE4             7      LD  A,0E4H
000175 0175 CDFE0D          17      CALL    COMOUT
000178 0178 3E52             7      LD  A,INTVEC
00017A 017A CD070E          17      CALL    OT49SB
                                ;
00017D 017D 01C41F          10      LD  BC,01FC4H
000180 0180 3E0C             7      LD  A,00CH
000182 0182 ED79            12      OUT (C),A
                                
000184 0184 0EC0             7      LD  C,0C0H
000186 0186 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
                                
000188 0188 0C               4      INC C
000189 0189 3E28             7      LD  A,40
00018B 018B ED79            12      OUT (C),A
                                
00018D 018D 0C               4      INC C
00018E 018E ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
                                
000190 0190 0C               4      INC C
000191 0191 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
                                
000193 0193 0EC5             7      LD  C,0C5H
000195 0195 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
                                
000197 0197 CD5FFF          17      CALL    CHECK_BIOS
00019A 019A FEC9             7      CP  0C9H
00019C 019C 280B            12      JR  Z,BIOSOK
00019E 019E 3EAF             7      LD  A,0AFH      ;XOR    A
0001A0 01A0 32770B          13      LD  (X1KPAT),A
0001A3 01A3 213C09          10      LD  HL,SCRNX
0001A6 01A6 221C20          16      LD  (_SCRN+1),HL
       01A9                     BIOSOK:
0001A9 01A9 C30024          10      JP  INIT
                                
       01AC                     CHKCTC:
0001AC 01AC C5              11      PUSH    BC
0001AD 01AD 110347          10      LD  DE,04703H
       01B0                     INICTC1:
0001B0 01B0 0C               4      INC C
0001B1 01B1 ED51            12      OUT (C),D
0001B3 01B3 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
0001B5 01B5 1D               4      DEC E
0001B6 01B6 20F8            12      JR  NZ,INICTC1
0001B8 01B8 C1              10      POP BC
                                
0001B9 01B9 11FA07          10      LD  DE,007FAH
0001BC 01BC ED51            12      OUT (C),D
0001BE 01BE ED59            12      OUT (C),E
0001C0 01C0 ED78            12      IN  A,(C)
0001C2 01C2 BB               4      CP  E
0001C3 01C3 C0              11      RET NZ
0001C4 01C4 ED51            12      OUT (C),D
0001C6 01C6 ED51            12      OUT (C),D
0001C8 01C8 ED78            12      IN  A,(C)
0001CA 01CA BA               4      CP  D
0001CB 01CB C0              11      RET NZ
0001CC 01CC 03               6      INC BC
0001CD 01CD 03               6      INC BC
0001CE 01CE ED438800        20      LD  (_CTC),BC
0001D2 01D2 C9              10      RET
                                
       01D3                     GETL:
0001D3 01D3 CD0300          17      CALL    AT_GETL
0001D6 01D6 D0              11      RET NC
0001D7 01D7 3E1B             7      LD  A,$1B
0001D9 01D9 12               7      LD  (DE),A
0001DA 01DA 13               6      INC DE
0001DB 01DB AF               4      XOR A
0001DC 01DC 12               7      LD  (DE),A
0001DD 01DD 1B               6      DEC DE
0001DE 01DE C9              10      RET
                                ;
       01DF                     GETKY:
0001DF 01DF 3A2E00          13      LD  A,(AT_KEY)
0001E2 01E2 B7               4      OR  A
0001E3 01E3 C2D020          10      JP  NZ,_KYBFC
0001E6 01E6 C9              10      RET
                                ;
       01E7                     XSCRN:
0001E7 01E7 E5              11      PUSH    HL
0001E8 01E8 C5              11      PUSH    BC
0001E9 01E9 CD4D05          17      CALL    AT_VRCALC
0001EC 01EC 4D               4      LD  C,L
0001ED 01ED 44               4      LD  B,H
0001EE 01EE ED78            12      IN  A,(C)
0001F0 01F0 C1              10      POP BC
0001F1 01F1 E1              10      POP HL
0001F2 01F2 C9              10      RET
                                
0002AA 02AA                         ORG $02AA
       02AA                     AT_FLGET:
0002AA 02AA C5              11      PUSH    BC
0002AB 02AB E5              11      PUSH    HL
0002AC 02AC ED4B1000        20      LD  BC,(_TXADR)
0002B0 02B0 CBE8             8      SET 5,B
0002B2 02B2 ED60            12      IN  H,(C)
       02B4                     FLGET1:
0002B4 02B4 3A2F00          13      LD  A,(_KEYD+1)
0002B7 02B7 0F               4      RRCA
0002B8 02B8 0F               4      RRCA
0002B9 02B9 E610             7      AND 010H
0002BB 02BB F608             7      OR  8
0002BD 02BD ED68            12      IN  L,(C)
0002BF 02BF B5               4      OR  L
0002C0 02C0 ED79            12      OUT (C),A
0002C2 02C2 CDCC02          17      CALL    IOCS_INKEY
0002C5 02C5 28ED            12      JR  Z,FLGET1
0002C7 02C7 ED61            12      OUT (C),H
0002C9 02C9 E1              10      POP HL
0002CA 02CA C1              10      POP BC
0002CB 02CB C9              10      RET
                                
       02CC                     IOCS_INKEY:
0002CC 02CC FB               4      EI
0002CD 02CD E5              11      PUSH    HL
0002CE 02CE 2AA60E          16      LD  HL,(_KEYPS)
0002D1 02D1 7C               4      LD  A,H
0002D2 02D2 AD               4      XOR L
0002D3 02D3 2809            12      JR  Z,INKEY1
0002D5 02D5 7C               4      LD  A,H
0002D6 02D6 3C               4      INC A
0002D7 02D7 32A70E          13      LD  (_KEYPS+1),A
0002DA 02DA 6F               4      LD  L,A
0002DB 02DB 2606             7      LD  H,KEYBF/256
0002DD 02DD 7E               7      LD  A,(HL)
       02DE                     INKEY1:
0002DE 02DE E1              10      POP HL
0002DF 02DF B7               4      OR  A
0002E0 02E0 C9              10      RET
                                
0003E3 03E3                         ORG $03E3
       03E3                     AT_KYBFS:
0003E3 03E3 C39807          10      JP  KEYBS
0003E6 03E6 C9              10      RET
                                
0004A3 04A3                         ORG $04A3
       04A3                     AT_NL:
0004A3 04A3 C5              11      PUSH    BC
0004A4 04A4 D5              11      PUSH    DE
0004A5 04A5 E5              11      PUSH    HL
0004A6 04A6 CD4608          17      CALL    CTRL04
0004A9 04A9 E1              10      POP HL
0004AA 04AA D1              10      POP DE
0004AB 04AB C1              10      POP BC
0004AC 04AC C9              10      RET
                                
0004C8 04C8                         ORG $04C8
       04C8                     AT_PRNT0:
0004C8 04C8 F5              11      PUSH    AF
0004C9 04C9 FE20             7      CP  $20
0004CB 04CB 3002            12      JR  NC,PRNT01
0004CD 04CD 3E20             7      LD  A,$20
       04CF                     PRNT01:
0004CF 04CF CD650B          17      CALL    IOCS_PRINT
0004D2 04D2 F1              10      POP AF
0004D3 04D3 C9              10      RET
                                
       04D4                     BIOS:
0004D4 04D4 E5              11      PUSH    HL
0004D5 04D5 211080          10      LD  HL,08010H
0004D8 04D8 39              11      ADD HL,SP
0004D9 04D9 E1              10      POP HL
0004DA 04DA DA51FF          10      JP  C,BIOS1
0004DD 04DD ED73E804        20      LD  (SPPAT+1),SP    ;スタックがBIOS-ROMと被っている場合
0004E1 04E1 31C0FF          10      LD  SP,EXTSP
0004E4 04E4 CD51FF          17      CALL    BIOS1
0004E7 04E7 310000          10  SPPAT:  LD  SP,0
0004EA 04EA C9              10      RET
                                
       04EB                     IOCS_WIDCH:
0004EB 04EB C5              11      PUSH    BC
0004EC 04EC D5              11      PUSH    DE
0004ED 04ED E5              11      PUSH    HL
                                
0004EE 04EE 01F01F          10      LD  BC,$01FF0
0004F1 04F1 FE29             7      CP  41
0004F3 04F3 380D            12      JR  C,WIDTH40
0004F5 04F5 ED78            12      IN  A,(C)
0004F7 04F7 0F               4      RRCA
0004F8 04F8 210B13          10      LD  HL,_C8025L
0004FB 04FB 3810            12      JR  C,SETCRTC
0004FD 04FD 211B13          10      LD  HL,_C8025H
000500 0500 180B            12      JR  SETCRTC
       0502                     WIDTH40:
000502 0502 ED78            12      IN  A,(C)
000504 0504 0F               4      RRCA
000505 0505 212B13          10      LD  HL,_C4025L
000508 0508 3803            12      JR  C,SETCRTC
00050A 050A 213B13          10      LD  HL,_C4025H
       050D                     SETCRTC:
00050D 050D 11FB12          10      LD  DE,_CRTCD
000510 0510 011000          10      LD  BC,16
000513 0513 EDB0                    LDIR
                                
000515 0515 21FB12          10      LD  HL,_CRTCD
000518 0518 AF               4      XOR A
       0519                     SETCRT1:
000519 0519 010018          10      LD  BC,01800H
00051C 051C ED79            12      OUT (C),A
00051E 051E 0C               4      INC C
00051F 051F 04               4      INC B
000520 0520 EDA3            16      OUTI
000522 0522 3C               4      INC A
000523 0523 FE0C             7      CP  12
000525 0525 20F2            12      JR  NZ,SETCRT1
000527 0527 23               6      INC HL
000528 0528 23               6      INC HL
000529 0529 01031B          10      LD  BC,01A03H+00100H    ;OUTIは先にBを減らすので足している
00052C 052C EDA3            16      OUTI
00052E 052E 01D020          10      LD  BC,01FD0H+00100H
000531 0531 EDA3            16      OUTI
                                
000533 0533 CD2208          17      CALL    CTRL0C
000536 0536 E1              10      POP HL
000537 0537 D1              10      POP DE
000538 0538 C1              10      POP BC
000539 0539 3A0A13          13      LD  A,(WK1FD0)
00053C 053C 32051F          13      LD  (_WK1FD0),A
00053F 053F 3AFC12          13      LD  A,(_CRTCD+1)
000542 0542 320700          13      LD  (AT_WIDTH),A
000545 0545 A7               4      AND A
000546 0546 C9              10      RET
                                
00054D 054D                         ORG $054D
       054D                     AT_VRCALC:
       054D                     LOC1:
00054D 054D D5              11      PUSH    DE
00054E 054E 4D               4      LD  C,L
00054F 054F 0608             7      LD  B,8
000551 0551 5C               4      LD  E,H
000552 0552 1600             7      LD  D,0
000554 0554 2AFB12          16      LD  HL,(_CRTCD)
000557 0557 6A               4      LD  L,D
       0558                     LOC2:
000558 0558 29              11      ADD HL,HL
000559 0559 3001            12      JR  NC,LOC3
00055B 055B 19              11      ADD HL,DE
       055C                     LOC3:
00055C 055C 10FA            13      DJNZ    LOC2
00055E 055E 09              11      ADD HL,BC
00055F 055F D1              10      POP DE
000560 0560 C9              10      RET
                                
       0561                     ZERO_MEMORY_DE:
000561 0561 AF               4      XOR A
       0562                     FILL_MEMORY_DE:
000562 0562 12               7      LD  (DE),A
000563 0563 13               6      INC DE
000564 0564 10FC            13      DJNZ    FILL_MEMORY_DE
000566 0566 C9              10      RET
                                
000600 0600                         ORG $0600
000600 0600                     KEYBF:  DS  256
                                
       0700                     INT:
000700 0700 F5              11      PUSH    AF
000701 0701 E5              11      PUSH    HL
000702 0702 2100FF          10      LD  HL,$FF00
000705 0705 39              11      ADD HL,SP
000706 0706 380F            12      JR  C,INTP1X
000708 0708 ED731307        20      LD  (INTSP+1),SP
00070C 070C 31C0FF          10      LD  SP,EXTSP
00070F 070F CD1F07          17      CALL    INTP1
000712 0712 310000          10  INTSP:  LD  SP,0
000715 0715 1803            12      JR  INTPE
       0717                     INTP1X:
000717 0717 CD1F07          17      CALL    INTP1
       071A                     INTPE:
00071A 071A E1              10      POP HL
       071B                     INTPE2:
00071B 071B F1              10      POP AF
       071C                     INTCTCE:
00071C 071C FB               4      EI
00071D 071D ED4D            15      RETI
       071F                     INTP1:
00071F 071F C5              11      PUSH    BC
                                
000720 0720 CD490B          17      CALL    IN49SB
000723 0723 67               4      LD  H,A
000724 0724 CD490B          17      CALL    IN49SB
000727 0727 6F               4      LD  L,A
                                
000728 0728 FE08             7      CP  8       ;DELキー
00072A 072A 2005            12      JR  NZ,SCEXE
00072C 072C 7C               4      LD  A,H
00072D 072D E611             7      AND 011H        ;CTRLキー + GRAPHキー
00072F 072F 2808            12      JR  Z,RESET
       0731                     SCEXE:
000731 0731 222E00          16      LD  (_KEYD),HL
000734 0734 CD6507          17      CALL    KEYSET1
                                
000737 0737 C1              10      POP BC
000738 0738 C9              10      RET
                                
       0739                     RESET:
000739 0739 3E1D             7      LD  A,01DH
00073B 073B D300            11      OUT (0),A
00073D 073D C7              12      RST 0
                                
       073E                     INTCTC2:
00073E 073E F5              11      PUSH    AF
00073F 073F 3E00             7  INTCPAT:LD  A,000H
000741 0741 3D               4      DEC A
000742 0742 324007          13      LD  (INTCPAT+1),A
000745 0745 20D4            12      JR  NZ,INTPE2
                                
000747 0747 3A2E00          13      LD  A,(_KEYD)
00074A 074A B7               4      OR  A
00074B 074B 28CE            12      JR  Z,INTPE2
       074D                     KEYSET0:
00074D 074D E5              11      PUSH    HL
00074E 074E 2AA60E          16      LD  HL,(_KEYPS)
000751 0751 7C               4      LD  A,H
000752 0752 AD               4      XOR L
000753 0753 2006            12      JR  NZ,INTC2A
                                
000755 0755 2A2E00          16      LD  HL,(_KEYD)
000758 0758 CD8F07          17      CALL    KEYSET
       075B                     INTC2A:
00075B 075B 3AA80E          13      LD  A,(_KEYSP)
00075E 075E E60F             7      AND 00FH
000760 0760 324007          13      LD  (INTCPAT+1),A
                                
000763 0763 18B5            12      JR  INTPE
                                
       0765                     KEYSET1:
000765 0765 CB6C             8      BIT 5,H
000767 0767 F5              11      PUSH    AF
000768 0768 ED4B8800        20      LD  BC,(_CTC)
00076C 076C 78               4      LD  A,B
00076D 076D B1               4      OR  C
00076E 076E 2006            12      JR  NZ,KEYS10E
                                
000770 0770 F1              10      POP AF
000771 0771 201C            12      JR  NZ,KEYSET
000773 0773 F5              11      PUSH    AF
000774 0774 18D7            12      JR  KEYSET0
       0776                     KEYS10E:
000776 0776 F1              10      POP AF
000777 0777 C8              11      RET Z
000778 0778 F5              11      PUSH    AF
000779 0779 3E03             7      LD  A,3     ;CTC STOP
00077B 077B ED79            12      OUT (C),A
00077D 077D F1              10      POP AF
                                
00077E 077E B7               4      OR  A
00077F 077F C8              11      RET Z
                                
000780 0780 E5              11      PUSH    HL
000781 0781 2AA80E          16      LD  HL,(_KEYSP)
000784 0784 3EA7             7      LD  A,0A7H
000786 0786 ED79            12      OUT (C),A
000788 0788 ED69            12      OUT (C),L
00078A 078A 7C               4      LD  A,H
00078B 078B 324007          13      LD  (INTCPAT+1),A
00078E 078E E1              10      POP HL
                                
       078F                     KEYSET:
00078F 078F 7D               4      LD  A,L
000790 0790 CB7C             8      BIT 7,H
000792 0792 CCB607          17      CALL    Z,FKEY
000795 0795 CB74             8      BIT 6,H
000797 0797 C0              11      RET NZ
       0798                     KEYBS:
000798 0798 B7               4      OR  A
000799 0799 C8              11      RET Z
       079A                     KEYBS1:
00079A 079A FE03             7      CP  3
00079C 079C CCD020          17      CALL    Z,_KYBFC
00079F 079F E5              11      PUSH    HL
0007A0 07A0 F5              11      PUSH    AF
0007A1 07A1 2AA60E          16      LD  HL,(_KEYPS)
0007A4 07A4 2C               4      INC L
0007A5 07A5 7D               4      LD  A,L
0007A6 07A6 BC               4      CP  H
0007A7 07A7 2809            12      JR  Z,POP_AF_HL_SCF_RET
0007A9 07A9 32A60E          13      LD  (_KEYPS),A
0007AC 07AC 2606             7      LD  H,KEYBF/256
0007AE 07AE F1              10      POP AF
0007AF 07AF 77               7      LD  (HL),A
0007B0 07B0 E1              10      POP HL
0007B1 07B1 C9              10      RET
                                
       07B2                     POP_AF_HL_SCF_RET:
0007B2 07B2 F1              10      POP AF
0007B3 07B3 E1              10      POP HL
0007B4 07B4 37               4      SCF
0007B5 07B5 C9              10      RET
                                
       07B6                     FKEY:
0007B6 07B6 CB75             8      BIT 6,L
0007B8 07B8 C8              11      RET Z
0007B9 07B9 3E1B             7      LD  A,01BH
0007BB 07BB CD9A07          17      CALL    KEYBS1
0007BE 07BE 7D               4      LD  A,L
0007BF 07BF C6AF             7      ADD A,020H-'q'
0007C1 07C1 CB7D             8      BIT 7,L
0007C3 07C3 C8              11      RET Z
0007C4 07C4 2E50             7      LD  L,'P'
0007C6 07C6 D690             7      SUB 0E1H+020H-'q'
0007C8 07C8 2810            12      JR  Z,KEYBSL
0007CA 07CA 2C               4      INC L
0007CB 07CB 3D               4      DEC A
0007CC 07CC 280C            12      JR  Z,KEYBSL
0007CE 07CE 2C               4      INC L
0007CF 07CF D609             7      SUB 0EBH-0E2H
0007D1 07D1 2807            12      JR  Z,KEYBSL
0007D3 07D3 2E43             7      LD  L,'C'
0007D5 07D5 3D               4      DEC A
0007D6 07D6 2802            12      JR  Z,KEYBSL
0007D8 07D8 2E58             7      LD  L,'X'
       07DA                     KEYBSL:
0007DA 07DA 7D               4      LD  A,L
0007DB 07DB 18BD            12      JR  KEYBS1
                                
0007F7 07F7                         ORG $07F7
       07F7                     AT_BELL:
       07F7                     CTRL07:
0007F7 07F7 214014          10      LD  HL,BEEPD
       07FA                     BEEP1:
0007FA 07FA 7E               7      LD  A,(HL)
0007FB 07FB 23               6      INC HL
0007FC 07FC FEFF             7      CP  0FFH
0007FE 07FE C8              11      RET Z
0007FF 07FF F3               4      DI
000800 0800 061C             7      LD  B,01CH
000802 0802 ED79            12      OUT (C),A
000804 0804 EDA3            16      OUTI
000806 0806 FB               4      EI
000807 0807 18F1            12      JR  BEEP1
                                
       0809                     C12S:
000809 0809 CBE0             8      SET 4,B
00080B 080B CBD8             8      SET 3,B
00080D 080D ED60            12      IN  H,(C)
00080F 080F ED59            12  X1PAT:  OUT (C),E
000811 0811 5C               4      LD  E,H
000812 0812 CB98             8      RES 3,B
000814 0814 ED60            12      IN  H,(C)
000816 0816 ED51            12      OUT (C),D
000818 0818 54               4      LD  D,H
000819 0819 CBA0             8      RES 4,B
00081B 081B ED60            12      IN  H,(C)
00081D 081D ED69            12      OUT (C),L
00081F 081F 6C               4      LD  L,H
000820 0820 3D               4      DEC A
000821 0821 C9              10      RET
                                
       0822                     CTRL0C:
000822 0822 CDB90C          17      CALL    CTRL0B
       0825                     CTRL06:
000825 0825 ED4B1000        20      LD  BC,(_TXADR)
       0829                     C1AX1:
000829 0829 78               4      LD  A,B
00082A 082A F638             7      OR  038H
00082C 082C 47               4      LD  B,A
00082D 082D ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令   kanji
00082F 082F CB98             8      RES 3,B
000831 0831 3E20             7      LD  A,020H
000833 0833 ED79            12      OUT (C),A       ;Text
000835 0835 CBA0             8      RES 4,B
000837 0837 3A2600          13      LD  A,(AT_COLORF)
00083A 083A ED79            12      OUT (C),A       ;Color
00083C 083C 03               6      INC BC
00083D 083D CBA8             8      RES 5,B
00083F 083F 2A0513          16      LD  HL,(_CRTCD+10)
000842 0842 09              11      ADD HL,BC
000843 0843 30E4            12      JR  NC,C1AX1
000845 0845 C9              10      RET
                                
       0846                     CTRL04:
000846 0846 CD3F09          17      CALL    _POS
000849 0849 7D               4      LD  A,L
00084A 084A B7               4      OR  A
00084B 084B C8              11      RET Z
       084C                     CTRL03:
00084C 084C CDA00C          17      CALL    CTRL0D
       084F                     CTRL0A:
       084F                     CTRL1F:
00084F 084F ED4B1000        20      LD  BC,(_TXADR)
000853 0853 2AFC12          16      LD  HL,(_CRTCD+1)
000856 0856 2600             7      LD  H,0
000858 0858 09              11      ADD HL,BC
000859 0859 44               4      LD  B,H
00085A 085A 4D               4      LD  C,L
00085B 085B 2A0513          16      LD  HL,(_CRTCD+10)
00085E 085E 09              11      ADD HL,BC
00085F 085F 3F               4      CCF
000860 0860 9F               4      SBC A,A
000861 0861 C3130C          10      JP  PRINTE8
                                
       0864                     CTRL0E:
000864 0864 CD3F09          17      CALL    _POS
000867 0867 7C               4      LD  A,H
000868 0868 1804            12      JR  SCR1
       086A                     SCR:
00086A 086A 3A1C00          13      LD  A,(AT_CONYE)
00086D 086D 3D               4      DEC A
       086E                     SCR1:
00086E 086E C5              11      PUSH    BC
00086F 086F D5              11      PUSH    DE
000870 0870 F5              11      PUSH    AF
000871 0871 3E07             7      LD  A,7
000873 0873 21D108          10      LD  HL,SCRDMAD
000876 0876 CDC708          17      CALL    SETDMA
000879 0879 F1              10      POP AF
00087A 087A 210038          10      LD  HL,03800H
                                
       087D                     SCRUP1:
00087D 087D B7               4      OR  A
00087E 087E 287A            12      JR  Z,SCRCL
000880 0880 F5              11      PUSH    AF
000881 0881 CDD808          17      CALL    UPSUB       ;kanji
000884 0884 3A0713          13      LD  A,(_CRTCD+12)
000887 0887 5F               4      LD  E,A
000888 0888 16F7             7      LD  D,0F7H
00088A 088A 19              11      ADD HL,DE
00088B 088B D5              11      PUSH    DE
00088C 088C CDD808          17      CALL    UPSUB       ;Text
00088F 088F D1              10      POP DE
000890 0890 19              11      ADD HL,DE
000891 0891 CDD808          17      CALL    UPSUB       ;Color
000894 0894 CBE4             8      SET 4,H
000896 0896 F1              10      POP AF
000897 0897 3D               4      DEC A
000898 0898 18E3            12      JR  SCRUP1
                                
       089A                     AT_SCRCL:
00089A 089A 215020          10      LD  HL,02000H+80
00089D 089D 3A421F          13      LD  A,(_COLORF)
       08A0                     AT_SCRCL1:
0008A0 08A0 CBE0             8      SET 4,B
0008A2 08A2 ED61            12      OUT (C),H
0008A4 08A4 CBA0             8      RES 4,B
0008A6 08A6 ED79            12      OUT (C),A
0008A8 08A8 03               6      INC BC
0008A9 08A9 2D               4      DEC L
0008AA 08AA 20F4            12      JR  NZ,AT_SCRCL1
0008AC 08AC C1              10      POP BC
0008AD 08AD D9               4      EXX
0008AE 08AE C1              10      POP BC
0008AF 08AF D9               4      EXX
0008B0 08B0 C9              10      RET
                                
       08B1                     AT_UPSUB:
0008B1 08B1 2E28             7      LD  L,40
       08B3                     AT_UPSUB1:
0008B3 08B3 D9               4      EXX
0008B4 08B4 ED78            12      IN  A,(C)
0008B6 08B6 03               6      INC BC
0008B7 08B7 D9               4      EXX
0008B8 08B8 ED79            12      OUT (C),A
0008BA 08BA 03               6      INC BC
0008BB 08BB D9               4      EXX
0008BC 08BC ED78            12      IN  A,(C)
0008BE 08BE 03               6      INC BC
0008BF 08BF D9               4      EXX
0008C0 08C0 ED79            12      OUT (C),A
0008C2 08C2 03               6      INC BC
0008C3 08C3 2D               4      DEC L
0008C4 08C4 20ED            12      JR  NZ,AT_UPSUB1
0008C6 08C6 C9              10      RET
                                
       08C7                     SETDMA:
0008C7 08C7 01871F          10      LD  BC,01F87H
       08CA                     SDMAI:
0008CA 08CA 04               4      INC B
0008CB 08CB EDA3            16      OUTI
0008CD 08CD 3D               4      DEC A
0008CE 08CE 20FA            12      JR  NZ,SDMAI
0008D0 08D0 C9              10      RET
                                
       08D1                     SCRDMAD:
0008D1 08D1 C3                      DB  0C3H        ;WR6 リセット
0008D2 08D2 9A                      DB  09AH        ;WR5 ストップ WAIT READY:HIGH
0008D3 08D3 65                      DB  065H        ;WR0 ブロック長(LH)
0008D4 08D4 4F00                    DW  79
0008D6 08D6 1C                      DB  01CH        ;WR1 ポートAインクリメント I/O
0008D7 08D7 18                      DB  018H        ;WR0 ポートAアドレス(LH)
                                
       08D8                     UPSUB:
0008D8 08D8 3AFC12          13      LD  A,(_CRTCD+1)
0008DB 08DB 5F               4      LD  E,A
0008DC 08DC 1600             7      LD  D,0
0008DE 08DE 3ECD             7      LD  A,0CDH      ;WR4 バースト ポートB開始アドレス(LH)
0008E0 08E0 ED79            12      OUT (C),A
0008E2 08E2 ED69            12      OUT (C),L       ;SOURCE
0008E4 08E4 ED61            12      OUT (C),H
0008E6 08E6 19              11      ADD HL,DE
0008E7 08E7 3E1D             7      LD  A,01DH      ;WR0 ポートA開始アドレス(LH) ポートA→ポートB 転送
0008E9 08E9 ED79            12      OUT (C),A
0008EB 08EB ED69            12      OUT (C),L       ;DEST
0008ED 08ED ED61            12      OUT (C),H
       08EF                     GO_DMA:
0008EF 08EF 3ECF             7      LD  A,0CFH
0008F1 08F1 ED79            12      OUT (C),A       ;WR6 ロード
0008F3 08F3 3EB3             7      LD  A,0B3H
0008F5 08F5 ED79            12      OUT (C),A       ;WR6 強制RDY
0008F7 08F7 ED49            12      OUT (C),C       ;WR6 イネーブル
0008F9 08F9 C9              10      RET
                                
       08FA                     SCRCL:
0008FA 08FA 44               4      LD  B,H
0008FB 08FB 4D               4      LD  C,L
0008FC 08FC 215020          10      LD  HL,02000H+80
0008FF 08FF 3A2600          13      LD  A,(AT_COLORF)
       0902                     SCRCL1:
000902 0902 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令
000904 0904 CB98             8      RES 3,B
000906 0906 ED61            12      OUT (C),H
000908 0908 CBA0             8      RES 4,B
00090A 090A ED79            12      OUT (C),A
00090C 090C CBD8             8      SET 3,B
00090E 090E CBE0             8      SET 4,B
000910 0910 03               6      INC BC
000911 0911 2D               4      DEC L
000912 0912 20EE            12      JR  NZ,SCRCL1
000914 0914 D1              10      POP DE
000915 0915 C1              10      POP BC
000916 0916 C9              10      RET
                                
       0917                     SCRN:
000917 0917 D5              11      PUSH    DE
000918 0918 ED58            12      IN  E,(C)       ;Text
00091A 091A CBD8             8      SET 3,B
00091C 091C ED50            12      IN  D,(C)       ;Kanji
00091E 091E 2819            12      JR  Z,SCRNE
000920 0920 AF               4      XOR A
000921 0921 C5              11      PUSH    BC
000922 0922 013730          10      LD  BC,03037H   ;VRMJIS
000925 0925 DF              12      RST 018H
000926 0926 01522F          10      LD  BC,02F52H   ;JISSFT
000929 0929 DF              12      RST 018H
00092A 092A C1              10      POP BC
00092B 092B ED78            12      IN  A,(C)
00092D 092D CB98             8      RES 3,B
00092F 092F E640             7      AND 040H
000931 0931 2003            12      JR  NZ,SCRN1
000933 0933 7A               4      LD  A,D
000934 0934 D1              10      POP DE
000935 0935 C9              10      RET
       0936                     SCRN1:
000936 0936 7B               4      LD  A,E
000937 0937 D1              10      POP DE
000938 0938 C9              10      RET
                                
       0939                     SCRNE:
000939 0939 D1              10      POP DE
00093A 093A CB98             8      RES 3,B
       093C                     SCRNX:
00093C 093C ED78            12      IN  A,(C)
00093E 093E C9              10      RET
                                
       093F                     CSR:
       093F                     _POS:
00093F 093F 2A1000          16      LD  HL,(_TXADR)
000942 0942 C5              11      PUSH    BC
000943 0943 ED4B0713        20      LD  BC,(_CRTCD+12)
000947 0947 AF               4      XOR A
       0948                     POS1:
000948 0948 09              11      ADD HL,BC
000949 0949 3C               4      INC A
00094A 094A 38FC            12      JR  C,POS1
00094C 094C ED42            15      SBC HL,BC
00094E 094E 3D               4      DEC A
00094F 094F 67               4      LD  H,A
000950 0950 C1              10      POP BC
000951 0951 A7               4      AND A
000952 0952 C9              10      RET
                                
0009A1 09A1                         ORG $09A1
0009A1 09A1 C9              10      RET
                                
       09A2                     CTRL12:
0009A2 09A2 D5              11      PUSH    DE
0009A3 09A3 CD3F09          17      CALL    _POS
0009A6 09A6 3AFC12          13      LD  A,(_CRTCD+1)
0009A9 09A9 95               4      SUB L
0009AA 09AA ED4B1000        20      LD  BC,(_TXADR)
0009AE 09AE 110020          10      LD  DE,02000H   ;D:Text E:Kanji
0009B1 09B1 2A2600          16      LD  HL,(AT_COLORF)  ;L:Color
0009B4 09B4 CBE8             8      SET 5,B
       09B6                     C12X1:
0009B6 09B6 CD0908          17      CALL    C12S
0009B9 09B9 03               6      INC BC
0009BA 09BA 20FA            12      JR  NZ,C12X1
0009BC 09BC D1              10      POP DE
0009BD 09BD C9              10      RET
                                
000A8F 0A8F                         ORG $0A8F
000A8F 0A8F AF               4      XOR A
000A90 0A90 4F               4      LD  C,A
000A91 0A91 210340          10      LD  HL,$4003
       0A94                     CLS1:
000A94 0A94 44               4      LD  B,H
       0A95                     CLS2:
000A95 0A95 ED71                    DB  $ED,$71
000A97 0A97 04               4      INC B
000A98 0A98 20FB            12      JR  NZ,CLS2
                                ;
000A9A 0A9A 85               4      ADD A,L
000A9B 0A9B 4F               4      LD  C,A
000A9C 0A9C 20F6            12      JR  NZ,CLS1
000A9E 0A9E C9              10      RET
                                
                                
000B49 0B49                         ORG $0B49
       0B49                     AT_IN49SB:
       0B49                     IN49SB:
000B49 0B49 C5              11      PUSH    BC
000B4A 0B4A 01011A          10      LD  BC,01A01H
       0B4D                     CANR:
000B4D 0B4D ED78            12      IN  A,(C)
000B4F 0B4F E620             7      AND 020H
000B51 0B51 20FA            12      JR  NZ,CANR
000B53 0B53 010019          10      LD  BC,01900H
000B56 0B56 ED78            12      IN  A,(C)
000B58 0B58 C1              10      POP BC
000B59 0B59 C9              10      RET
       0B5A                     CANW:
000B5A 0B5A 01011A          10      LD  BC,01A01H
000B5D 0B5D ED48            12      IN  C,(C)
000B5F 0B5F CB71             8      BIT 6,C
000B61 0B61 20F7            12      JR  NZ,CANW
000B63 0B63 C9              10      RET
                                
       0B64                     PRINT_E:
000B64 0B64 7B               4      LD  A,E
       0B65                     IOCS_PRINT:
000B65 0B65 D5              11      PUSH    DE
000B66 0B66 5F               4      LD  E,A
000B67 0B67 C5              11      PUSH    BC
000B68 0B68 E5              11      PUSH    HL
000B69 0B69 3E1F             7      LD  A,01FH
000B6B 0B6B BB               4      CP  E
000B6C 0B6C 3032            12      JR  NC,CTRL
       0B6E                     PRINTC:
000B6E 0B6E A7               4  INSFLG: AND A
000B6F 0B6F DCA209          17      CALL    C,CTRL12
                                
000B72 0B72 3E00             7  KANFLG: LD  A,000H
000B74 0B74 B7               4      OR  A
000B75 0B75 203F            12      JR  NZ,KANJI2
000B77 0B77 7B               4  X1KPAT: LD  A,E
000B78 0B78 FE80             7      CP  080H
000B7A 0B7A 380D            12      JR  C,ANK
000B7C 0B7C FEA0             7      CP  0A0H
000B7E 0B7E 3804            12      JR  C,KANJI1
000B80 0B80 FEE0             7      CP  0E0H
000B82 0B82 3805            12      JR  C,ANK
       0B84                     KANJI1:
000B84 0B84 32730B          13      LD  (KANFLG+1),A
000B87 0B87 1811            12      JR  PRINTE5
       0B89                     ANK:
000B89 0B89 ED4B1000        20      LD  BC,(_TXADR)
000B8D 0B8D 78               4      LD  A,B
000B8E 0B8E F638             7      OR  038H
000B90 0B90 47               4      LD  B,A
000B91 0B91 ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令   kanji
000B93 0B93 CB98             8      RES 3,B
000B95 0B95 ED59            12      OUT (C),E       ;Text
       0B97                     KANJIE:
000B97 0B97 CD010C          17      CALL    PRINTE7
       0B9A                     PRINTE5:
000B9A 0B9A E1              10      POP HL
000B9B 0B9B C1              10      POP BC
000B9C 0B9C 7B               4      LD  A,E
000B9D 0B9D D1              10      POP DE
000B9E 0B9E A7               4      AND A
000B9F 0B9F C9              10      RET
                                
       0BA0                     CTRL:
000BA0 0BA0 CDE80B          17      CALL    KANCLR
000BA3 0BA3 3EA7             7      LD  A,0A7H      ;AND    A
000BA5 0BA5 326E0B          13      LD  (INSFLG),A
000BA8 0BA8 7B               4      LD  A,E
000BA9 0BA9 87               4      ADD A,A
000BAA 0BAA 6F               4      LD  L,A
000BAB 0BAB 2614             7      LD  H,CTRLTB/256
000BAD 0BAD 7E               7      LD  A,(HL)
000BAE 0BAE 2C               4      INC L
000BAF 0BAF 66               7      LD  H,(HL)
000BB0 0BB0 6F               4      LD  L,A
000BB1 0BB1 CD811F          17      CALL    JP_HL
000BB4 0BB4 18E4            12      JR  PRINTE5
                                
       0BB6                     KANJI2:
000BB6 0BB6 D5              11      PUSH    DE
000BB7 0BB7 57               4      LD  D,A
000BB8 0BB8 01812F          10      LD  BC,02F81H   ;SFTJIS
000BBB 0BBB DF              12      RST 018H
000BBC 0BBC 01C32F          10      LD  BC,02FC3H   ;Instead or JISVRM
000BBF 0BBF DF              12      RST 018H
                                
000BC0 0BC0 ED4B1000        20      LD  BC,(_TXADR)
000BC4 0BC4 78               4      LD  A,B
000BC5 0BC5 F638             7      OR  038H
000BC7 0BC7 47               4      LD  B,A
000BC8 0BC8 ED51            12      OUT (C),D       ;kanji
000BCA 0BCA CB98             8      RES 3,B
000BCC 0BCC ED59            12      OUT (C),E       ;Text
000BCE 0BCE CD010C          17      CALL    PRINTE7
000BD1 0BD1 ED4B1000        20      LD  BC,(_TXADR)
000BD5 0BD5 78               4      LD  A,B
000BD6 0BD6 F638             7      OR  038H
000BD8 0BD8 47               4      LD  B,A
000BD9 0BD9 CBF2             8      SET 6,D
000BDB 0BDB ED51            12      OUT (C),D       ;Kanji
000BDD 0BDD CB98             8      RES 3,B
000BDF 0BDF ED59            12      OUT (C),E       ;Text
000BE1 0BE1 D1              10      POP DE
000BE2 0BE2 AF               4      XOR A
000BE3 0BE3 32730B          13      LD  (KANFLG+1),A
000BE6 0BE6 18AF            12      JR  KANJIE
                                
       0BE8                     KANCLR:
000BE8 0BE8 3A730B          13      LD  A,(KANFLG+1)
000BEB 0BEB B7               4      OR  A
000BEC 0BEC C8              11      RET Z
000BED 0BED ED4B1000        20      LD  BC,(_TXADR)
000BF1 0BF1 78               4      LD  A,B
000BF2 0BF2 F638             7      OR  038H
000BF4 0BF4 47               4      LD  B,A
000BF5 0BF5 AF               4      XOR A
000BF6 0BF6 32730B          13      LD  (KANFLG+1),A
000BF9 0BF9 ED79            12      OUT (C),A       ;Kanji
000BFB 0BFB CB98             8      RES 3,B
000BFD 0BFD 3E20             7      LD  A,020H
000BFF 0BFF ED79            12      OUT (C),A       ;Text
       0C01                     PRINTE7:
000C01 0C01 CBA0             8      RES 4,B
       0C03                     PRINTE6:
000C03 0C03 3A2600          13      LD  A,(AT_COLORF)
       0C06                     PRINTE4:
000C06 0C06 ED79            12      OUT (C),A       ;Color
000C08 0C08 78               4      LD  A,B
000C09 0C09 E607             7      AND 7
000C0B 0C0B 47               4      LD  B,A
       0C0C                     PRINTE2:
000C0C 0C0C 03               6      INC BC
       0C0D                     PRINTE3:
000C0D 0C0D 2A0513          16      LD  HL,(_CRTCD+10)
000C10 0C10 A7               4      AND A
000C11 0C11 ED4A            15      ADC HL,BC
       0C13                     PRINTE8:
000C13 0C13 2805            12      JR  Z,PRINT2
       0C15                     PRINTE1:
000C15 0C15 ED431000        20      LD  (_TXADR),BC
       0C19                     PRINTE:
000C19 0C19 C9              10      RET
                                
       0C1A                     PRINT2:
000C1A 0C1A CD6A08          17      CALL    SCR
000C1D 0C1D 2A0713          16      LD  HL,(_CRTCD+12)
000C20 0C20 09              11      ADD HL,BC
000C21 0C21 221000          16      LD  (_TXADR),HL
000C24 0C24 C9              10      RET
                                
       0C25                     CTRL1D:
000C25 0C25 ED4B1000        20      LD  BC,(_TXADR)
000C29 0C29 78               4      LD  A,B
000C2A 0C2A B1               4      OR  C
000C2B 0C2B C8              11      RET Z
000C2C 0C2C 0B               6      DEC BC
000C2D 0C2D 18E6            12      JR  PRINTE1
                                
       0C2F                     CTRL1E:
000C2F 0C2F ED4B1000        20      LD  BC,(_TXADR)
000C33 0C33 2A0713          16      LD  HL,(_CRTCD+12)
000C36 0C36 09              11      ADD HL,BC
000C37 0C37 D0              11      RET NC
000C38 0C38 44               4      LD  B,H
000C39 0C39 4D               4      LD  C,L
000C3A 0C3A 18D9            12      JR  PRINTE1
                                
       0C3C                     CTRL1C:
000C3C 0C3C ED4B1000        20      LD  BC,(_TXADR)
000C40 0C40 18CA            12      JR  PRINTE2
                                
       0C42                     CTRL09:
000C42 0C42 ED4B1000        20      LD  BC,(_TXADR)
000C46 0C46 79               4      LD  A,C
000C47 0C47 E6F8             7      AND 0F8H
000C49 0C49 C608             7      ADD A,8
000C4B 0C4B 4F               4      LD  C,A
000C4C 0C4C 88               4      ADC A,B
000C4D 0C4D 91               4      SUB C
000C4E 0C4E 47               4      LD  B,A
000C4F 0C4F 18BC            12      JR  PRINTE3
                                
       0C51                     CTRL02:
       0C51                     CTRL08:
000C51 0C51 2A1000          16      LD  HL,(_TXADR)
000C54 0C54 7C               4      LD  A,H
000C55 0C55 B5               4      OR  L
000C56 0C56 C8              11      RET Z
000C57 0C57 2B               6      DEC HL
000C58 0C58 221000          16      LD  (_TXADR),HL
000C5B 0C5B D5              11      PUSH    DE
000C5C 0C5C CD3F09          17      CALL    _POS
000C5F 0C5F 3AFC12          13      LD  A,(_CRTCD+1)
000C62 0C62 95               4      SUB L
000C63 0C63 6F               4      LD  L,A
000C64 0C64 2D               4      DEC L
000C65 0C65 2638             7      LD  H,038H
000C67 0C67 ED4B1000        20      LD  BC,(_TXADR)
000C6B 0C6B 09              11      ADD HL,BC
000C6C 0C6C 44               4      LD  B,H
000C6D 0C6D 4D               4      LD  C,L
000C6E 0C6E 110020          10      LD  DE,02000H   ;D:Text E:kanji
000C71 0C71 2A2600          16      LD  HL,(AT_COLORF)  ;L:Color
       0C74                     C8X1:
000C74 0C74 CD0908          17      CALL    C12S
000C77 0C77 0B               6      DEC BC
000C78 0C78 20FA            12      JR  NZ,C8X1
000C7A 0C7A D1              10      POP DE
000C7B 0C7B C9              10      RET
                                
       0C7C                     CTRL05:
000C7C 0C7C CD3F09          17      CALL    _POS
000C7F 0C7F 3AFC12          13      LD  A,(_CRTCD+1)
000C82 0C82 95               4      SUB L
000C83 0C83 6F               4      LD  L,A
000C84 0C84 2620             7      LD  H,020H
000C86 0C86 ED4B1000        20      LD  BC,(_TXADR)
       0C8A                     C05X1:
000C8A 0C8A 78               4      LD  A,B
000C8B 0C8B F638             7      OR  038H
000C8D 0C8D 47               4      LD  B,A
000C8E 0C8E ED71                    DB  0EDH,071H   ;OUT (C),0  Z80未定義命令   kanji
000C90 0C90 CB98             8      RES 3,B
000C92 0C92 ED61            12      OUT (C),H       ;Text
000C94 0C94 CBA0             8      RES 4,B
000C96 0C96 3A2600          13      LD  A,(AT_COLORF)
000C99 0C99 ED79            12      OUT (C),A       ;Color
000C9B 0C9B 03               6      INC BC
000C9C 0C9C 2D               4      DEC L
000C9D 0C9D 20EB            12      JR  NZ,C05X1
000C9F 0C9F C9              10      RET
                                
       0CA0                     CTRL0D:
000CA0 0CA0 CD3F09          17      CALL    _POS
000CA3 0CA3 2E00             7      LD  L,0
       0CA5                     LOC:
000CA5 0CA5 C5              11      PUSH    BC
000CA6 0CA6 E5              11      PUSH    HL
000CA7 0CA7 CDE80B          17      CALL    KANCLR
000CAA 0CAA CD4D05          17      CALL    AT_VRCALC
000CAD 0CAD 221000          16      LD  (_TXADR),HL
000CB0 0CB0 E1              10      POP HL
000CB1 0CB1 C1              10      POP BC
000CB2 0CB2 C9              10      RET
                                
       0CB3                     CTRL01:
000CB3 0CB3 3E37             7      LD  A,037H      ;SCF
000CB5 0CB5 326E0B          13      LD  (INSFLG),A
000CB8 0CB8 C9              10      RET
                                
       0CB9                     CTRL0B:
000CB9 0CB9 210000          10      LD  HL,0
000CBC 0CBC 221000          16      LD  (_TXADR),HL
000CBF 0CBF C9              10      RET
                                
       0CC0                     CTRL1B:
000CC0 0CC0 C9              10      RET
                                
000DFE 0DFE                         ORG $0DFE
       0DFE                     AT_COMOUT:
       0DFE                     COMOUT:
000DFE 0DFE FB               4      EI
000DFF 0DFF CD070E          17      CALL    OT49SB
000E02 0E02 CD5A0B          17      CALL    CANW
000E05 0E05 F3               4      DI
000E06 0E06 C9              10      RET
       0E07                     OT49SB:
000E07 0E07 C5              11      PUSH    BC
000E08 0E08 CD5A0B          17      CALL    CANW
000E0B 0E0B 010019          10      LD  BC,01900H
000E0E 0E0E ED79            12      OUT (C),A
000E10 0E10 C1              10      POP BC
000E11 0E11 C9              10      RET
                                
       0E12                     IOCS_GETL:
000E12 0E12 ED537F0E        20      LD  (KBPAT+1),DE
000E16 0E16 C5              11      PUSH    BC
000E17 0E17 E5              11      PUSH    HL
                                
000E18 0E18 CD3F09          17      CALL    _POS
000E1B 0E1B E5              11      PUSH    HL
       0E1C                     GETL1:
000E1C 0E1C CDAA02          17      CALL    AT_FLGET
000E1F 0E1F FE0D             7      CP  00DH
000E21 0E21 281E            12      JR  Z,GETL1OK
000E23 0E23 FE09             7      CP  9
000E25 0E25 2008            12      JR  NZ,GETL1V
000E27 0E27 2A7F0E          16      LD  HL,(KBPAT+1)
000E2A 0E2A CDC914          17      CALL    MSX
000E2D 0E2D 18ED            12      JR  GETL1
       0E2F                     GETL1V:
000E2F 0E2F FE03             7      CP  3
000E31 0E31 284F            12      JR  Z,GETL_CANCEL
000E33 0E33 FE1B             7      CP  01BH
000E35 0E35 284B            12      JR  Z,GETL_CANCEL
000E37 0E37 F5              11      PUSH    AF
000E38 0E38 CDB30C          17      CALL    CTRL01
000E3B 0E3B F1              10      POP AF
000E3C 0E3C CDF41F          17      CALL    _PRINT
000E3F 0E3F 18DB            12      JR  GETL1
       0E41                     GETL1OK:
000E41 0E41 ED5B7F0E        20      LD  DE,(KBPAT+1)
000E45 0E45 3AFC12          13      LD  A,(_CRTCD+1)
000E48 0E48 47               4      LD  B,A
000E49 0E49 CD6105          17      CALL    ZERO_MEMORY_DE
                                
000E4C 0E4C D1              10      POP DE
000E4D 0E4D CD3F09          17      CALL    _POS
000E50 0E50 2E00             7      LD  L,0
000E52 0E52 3AFC12          13      LD  A,(_CRTCD+1)
000E55 0E55 95               4      SUB L
000E56 0E56 57               4      LD  D,A
000E57 0E57 CD4D05          17      CALL    LOC1
000E5A 0E5A 4D               4      LD  C,L
000E5B 0E5B 7C               4      LD  A,H
000E5C 0E5C F630             7      OR  030H
000E5E 0E5E 47               4      LD  B,A
000E5F 0E5F 5A               4      LD  E,D
000E60 0E60 2A7F0E          16      LD  HL,(KBPAT+1)
       0E63                     GETL2:
000E63 0E63 CD1B20          17      CALL    _SCRN
000E66 0E66 03               6      INC BC
000E67 0E67 77               7      LD  (HL),A
000E68 0E68 23               6      INC HL
000E69 0E69 1D               4      DEC E
000E6A 0E6A 20F7            12      JR  NZ,GETL2
                                
000E6C 0E6C 3E0D             7      LD  A,$0D
000E6E 0E6E CD650B          17      CALL    PRINT
       0E71                     GETL3:
000E71 0E71 2B               6      DEC HL
000E72 0E72 7E               7      LD  A,(HL)
000E73 0E73 FE21             7      CP  021H
000E75 0E75 3005            12      JR  NC,GETL_END
000E77 0E77 AF               4      XOR A
000E78 0E78 77               7      LD  (HL),A
000E79 0E79 15               4      DEC D
000E7A 0E7A 20F5            12      JR  NZ,GETL3
       0E7C                     GETL_END:
000E7C 0E7C E1              10      POP HL
000E7D 0E7D C1              10      POP BC
000E7E 0E7E 110000          10  KBPAT:  LD  DE,0
000E81 0E81 C9              10      RET
       0E82                     GETL_CANCEL:
000E82 0E82 37               4      SCF
000E83 0E83 E1              10      POP HL
000E84 0E84 18F6            12      JR  GETL_END
                                
000EA5 0EA5                         ORG $0EA5
000EA5 0EA5 00                      DB  0
000EA6 0EA6 0000                _KEYPS: DW  0
000EA8 0EA8 C210                _KEYSP: DW  010C2H
                                
001000 1000                         ORG $1000
       1000                     AT_MON:
001000 1000 3E2A             7      LD  A,"*"
       1002                     MONMX:
001002 1002 CDF41F          17      CALL    _PRINT
001005 1005 ED5B761F        20      LD  DE,(_KBFAD)
001009 1009 CDD31F          17      CALL    _GETL
00100C 100C CD3410          17      CALL    MONANL
00100F 100F 181C            12      JR  MONS
       1011                     MONMZ2:
001011 1011 23               6      INC HL
001012 1012 22A610          16      LD  (MONDADD+1),HL
001015 1015 1816            12      JR  MONS
                                ;
       1017                     MONMZ:
001017 1017 3E2E             7      LD  A,"."
001019 1019 CDF41F          17      CALL    _PRINT
00101C 101C 2AA610          16      LD  HL,(MONDADD+1)
00101F 101F CDBE1F          17      CALL    _PRTHL
001022 1022 CDF11F          17      CALL    _PRNTS
001025 1025 7E               7      LD  A,(HL)
001026 1026 CDC11F          17      CALL    _PRTHX
001029 1029 3E2D             7      LD  A,"-"
00102B 102B 18D5            12      JR  MONMX
       102D                     MONS:
00102D 102D 3E00             7  MONMF:  LD  A,$00
00102F 102F B7               4      OR  A
001030 1030 20E5            12      JR  NZ,MONMZ
001032 1032 18CC            12      JR  AT_MON
       1034                     MONANL:
001034 1034 1A               7      LD  A,(DE)
001035 1035 13               6      INC DE
001036 1036 FE2A             7      CP  "*"
001038 1038 2031            12      JR  NZ,MONA2
00103A 103A 1A               7      LD  A,(DE)
00103B 103B CD5114          17      CALL    CAP
00103E 103E 13               6      INC DE
00103F 103F FE54             7      CP  "T"
001041 1041 CADD11          10      JP  Z,MONT
001044 1044 FE47             7      CP  "G"
001046 1046 CAD811          10      JP  Z,MONG
001049 1049 FE4D             7      CP  "M"
00104B 104B 2813            12      JR  Z,MONM
00104D 104D FE44             7      CP  "D"
00104F 104F 284F            12      JR  Z,MOND
001051 1051 FE46             7      CP  "F"
001053 1053 CAD910          10      JP  Z,MONF
001056 1056 FE52             7      CP  "R"
001058 1058 2803            12      JR  Z,MONR
00105A 105A FE21             7      CP  "!"
00105C 105C C0              11      RET NZ
       105D                     MONR:
00105D 105D F1              10      POP AF
00105E 105E AF               4      XOR A
00105F 105F C9              10      RET
                                ;
       1060                     MONM:
001060 1060 3E01             7      LD  A,1
001062 1062 322E10          13      LD  (MONMF+1),A
001065 1065 CDB21F          17      CALL    _HLHEX
001068 1068 D8              11      RET C
001069 1069 1869            12      JR  MONA6
                                ;
       106B                     MONA2:
00106B 106B FE3A             7      CP  ":"
00106D 106D 201C            12      JR  NZ,MONA2X
00106F 106F CDB21F          17      CALL    _HLHEX
001072 1072 D8              11      RET C
       1073                     MONA3:
001073 1073 0600             7      LD  B,0
       1075                     MONA4:
001075 1075 CDB51F          17      CALL    _2HEX
001078 1078 3805            12      JR  C,MONA5
00107A 107A 77               7      LD  (HL),A
00107B 107B 23               6      INC HL
00107C 107C 04               4      INC B
00107D 107D 18F6            12      JR  MONA4
                                ;
       107F                     MONA5:
00107F 107F 78               4      LD  A,B
001080 1080 B7               4      OR  A
001081 1081 2051            12      JR  NZ,MONA6
001083 1083 CDD410          17      CALL    MONA6
       1086                     MONME:
001086 1086 AF               4      XOR A
001087 1087 322E10          13      LD  (MONMF+1),A
00108A 108A C9              10      RET
                                ;
       108B                     MONA2X:
00108B 108B FE2E             7      CP  "."
00108D 108D 20F7            12      JR  NZ,MONME
00108F 108F CDB21F          17      CALL    _HLHEX
001092 1092 13               6      INC DE
001093 1093 13               6      INC DE
001094 1094 13               6      INC DE
001095 1095 13               6      INC DE
001096 1096 CDDC20          17      CALL    _SPSK
001099 1099 1A               7      LD  A,(DE)
00109A 109A B7               4      OR  A
00109B 109B 20D6            12      JR  NZ,MONA3
00109D 109D 23               6      INC HL
00109E 109E 1834            12      JR  MONA6
                                ;
       10A0                     MOND:
0010A0 10A0 CDB21F          17      CALL    _HLHEX
0010A3 10A3 3003            12      JR  NC,MOND1
0010A5 10A5 210000          10  MONDADD:LD  HL,0
       10A8                     MOND1:
0010A8 10A8 E5              11      PUSH    HL
0010A9 10A9 CDB21F          17      CALL    _HLHEX
0010AC 10AC D1              10      POP DE
0010AD 10AD 3812            12      JR  C,MOND1X
0010AF 10AF ED52            15      SBC HL,DE
0010B1 10B1 7C               4      LD  A,H
0010B2 10B2 B7               4      OR  A
0010B3 10B3 EB               4      EX  DE,HL
0010B4 10B4 200B            12      JR  NZ,MOND1X
0010B6 10B6 7B               4      LD  A,E
0010B7 10B7 0F               4      RRCA
0010B8 10B8 0F               4      RRCA
0010B9 10B9 0F               4      RRCA
0010BA 10BA 0F               4      RRCA
0010BB 10BB E60F             7      AND $0F
0010BD 10BD 3C               4      INC A
0010BE 10BE 4F               4      LD  C,A
0010BF 10BF 1802            12      JR  MOND2
       10C1                     MOND1X:
0010C1 10C1 0E10             7      LD  C,16
       10C3                     MOND2:
0010C3 10C3 3A5C1F          13      LD  A,(_WIDTH)
0010C6 10C6 C6B0             7      ADD A,-80
0010C8 10C8 9F               4      SBC A,A
0010C9 10C9 E608             7      AND 8
0010CB 10CB C608             7      ADD A,8
0010CD 10CD 47               4      LD  B,A
0010CE 10CE CDA611          17      CALL    MONDX
0010D1 10D1 0D               4      DEC C
0010D2 10D2 20EF            12      JR  NZ,MOND2
       10D4                     MONA6:
0010D4 10D4 22A610          16      LD  (MONDADD+1),HL
0010D7 10D7 AF               4      XOR A
0010D8 10D8 C9              10      RET
                                ;
       10D9                     MONF:
0010D9 10D9 CDB21F          17      CALL    _HLHEX
0010DC 10DC D8              11      RET C
0010DD 10DD 22FE10          16      LD  (MFST+1),HL
0010E0 10E0 CDB21F          17      CALL    _HLHEX
0010E3 10E3 D8              11      RET C
0010E4 10E4 22FB10          16      LD  (MFSE+1),HL
0010E7 10E7 2A761F          16      LD  HL,(_KBFAD)
0010EA 10EA 06FF             7      LD  B,-1
       10EC                     MONF1:
0010EC 10EC 04               4      INC B
0010ED 10ED CDB51F          17      CALL    _2HEX
0010F0 10F0 77               7      LD  (HL),A
0010F1 10F1 23               6      INC HL
0010F2 10F2 30F8            12      JR  NC,MONF1
0010F4 10F4 78               4      LD  A,B
0010F5 10F5 B7               4      OR  A
0010F6 10F6 C8              11      RET Z
0010F7 10F7 328B11          13      LD  (MFSL+1),A
                                ;
0010FA 10FA 210000          10  MFSE:   LD  HL,0
0010FD 10FD 110000          10  MFST:   LD  DE,0
001100 1100 ED52            15      SBC HL,DE
001102 1102 44               4      LD  B,H
001103 1103 4D               4      LD  C,L
001104 1104 03               6      INC BC
001105 1105 2A761F          16      LD  HL,(_KBFAD)
001108 1108 EB               4      EX  DE,HL
001109 1109 1A               7      LD  A,(DE)
       110A                     MONF2:
00110A 110A EDB1                    CPIR
00110C 110C CC8611          17      CALL    Z,MONFS
00110F 110F E0              11      RET PO
001110 1110 18F8            12      JR  MONF2
                                ;
                                
00111F 111F                         ORG $111F
       111F                     AT_HLHEX:
00111F 111F E5              11      PUSH    HL
001120 1120 D5              11      PUSH    DE
001121 1121 CD4311          17      CALL    HLHEX5
001124 1124 3818            12      JR  C,HLHEX3
001126 1126 6F               4      LD  L,A
001127 1127 2600             7      LD  H,0
       1129                     HLHEX1:
001129 1129 CD4811          17      CALL    HLHEX6
00112C 112C 380C            12      JR  C,HLHEX2
00112E 112E 29              11      ADD HL,HL
00112F 112F 29              11      ADD HL,HL
001130 1130 29              11      ADD HL,HL
001131 1131 29              11      ADD HL,HL
001132 1132 85               4      ADD A,L
001133 1133 6F               4      LD  L,A
001134 1134 3E00             7      LD  A,$00
001136 1136 8C               4      ADC A,H
001137 1137 67               4      LD  H,A
001138 1138 18EF            12      JR  HLHEX1
       113A                     HLHEX2:
00113A 113A F1              10      POP AF
00113B 113B F1              10      POP AF
00113C 113C AF               4      XOR A
00113D 113D C9              10      RET
       113E                     HLHEX3:
00113E 113E D1              10      POP DE
00113F 113F E1              10      POP HL
001140 1140 37               4      SCF
001141 1141 C9              10      RET
       1142                     HLHEX4:
001142 1142 13               6      INC DE
       1143                     HLHEX5:
001143 1143 1A               7      LD  A,(DE)
001144 1144 FE20             7      CP  $20
001146 1146 28FA            12      JR  Z,HLHEX4
       1148                     HLHEX6:
001148 1148 1A               7      LD  A,(DE)
001149 1149 CDB81F          17      CALL    _HEX
00114C 114C D8              11      RET C
00114D 114D 13               6      INC DE
00114E 114E C9              10      RET
                                
00115E 115E                         ORG $115E
       115E                     AT_2HEX:
00115E 115E C5              11      PUSH    BC
00115F 115F D5              11      PUSH    DE
001160 1160 CD4311          17      CALL    HLHEX5
001163 1163 3813            12      JR  C,AHEX3
001165 1165 4F               4      LD  C,A
001166 1166 CD4811          17      CALL    HLHEX6
001169 1169 3808            12      JR  C,AHEX1
00116B 116B 47               4      LD  B,A
00116C 116C 79               4      LD  A,C
00116D 116D 07               4      RLCA
00116E 116E 07               4      RLCA
00116F 116F 07               4      RLCA
001170 1170 07               4      RLCA
001171 1171 80               4      ADD A,B
001172 1172 4F               4      LD  C,A
       1173                     AHEX1:
001173 1173 79               4      LD  A,C
       1174                     AHEX2:
001174 1174 C1              10      POP BC
001175 1175 C1              10      POP BC
001176 1176 B7               4      OR  A
001177 1177 C9              10      RET
       1178                     AHEX3:
001178 1178 1A               7      LD  A,(DE)
001179 1179 FE3B             7      CP  $3B
00117B 117B 2804            12      JR  Z,AHEX4
00117D 117D D1              10      POP DE
00117E 117E C1              10      POP BC
00117F 117F 37               4      SCF
001180 1180 C9              10      RET
       1181                     AHEX4:
001181 1181 13               6      INC DE
001182 1182 1A               7      LD  A,(DE)
001183 1183 13               6      INC DE
001184 1184 18EE            12      JR  AHEX2
                                
       1186                     MONFS:
001186 1186 F5              11      PUSH    AF
001187 1187 C5              11      PUSH    BC
001188 1188 D5              11      PUSH    DE
001189 1189 E5              11      PUSH    HL
00118A 118A 0601             7  MFSL:   LD  B,1
       118C                     MONFS1:
00118C 118C 05               4      DEC B
00118D 118D 280B            12      JR  Z,MONFSX
00118F 118F 13               6      INC DE
001190 1190 1A               7      LD  A,(DE)
001191 1191 BE               7      CP  (HL)
001192 1192 23               6      INC HL
001193 1193 28F7            12      JR  Z,MONFS1
       1195                     MONFSX2:
001195 1195 E1              10      POP HL
001196 1196 D1              10      POP DE
001197 1197 C1              10      POP BC
001198 1198 F1              10      POP AF
001199 1199 C9              10      RET
                                ;
       119A                     MONFSX:
00119A 119A E1              10      POP HL
00119B 119B E5              11      PUSH    HL
00119C 119C 2B               6      DEC HL
00119D 119D 3A8B11          13      LD  A,(MFSL+1)
0011A0 11A0 47               4      LD  B,A
0011A1 11A1 CDA611          17      CALL    MONDX
0011A4 11A4 18EF            12      JR  MONFSX2
                                ;
       11A6                     MONDX:
0011A6 11A6 C5              11      PUSH    BC
0011A7 11A7 3E3A             7      LD  A,":"
0011A9 11A9 CDF41F          17      CALL    _PRINT
0011AC 11AC CDBE1F          17      CALL    _PRTHL
       11AF                     MOND3:
0011AF 11AF CDF11F          17      CALL    _PRNTS
0011B2 11B2 7E               7      LD  A,(HL)
0011B3 11B3 23               6      INC HL
0011B4 11B4 CDC11F          17      CALL    _PRTHX
0011B7 11B7 10F6            13      DJNZ    MOND3
0011B9 11B9 CDE21F          17      CALL    _MPRNT
0011BC 11BC 202F00                  DB  " /",0
0011BF 11BF C1              10      POP BC
0011C0 11C0 1600             7      LD  D,0
0011C2 11C2 58               4      LD  E,B
0011C3 11C3 ED52            15      SBC HL,DE
       11C5                     MOND4:
0011C5 11C5 7E               7      LD  A,(HL)
0011C6 11C6 23               6      INC HL
0011C7 11C7 FE20             7      CP  $20
0011C9 11C9 3002            12      JR  NC,MOND5
0011CB 11CB 3E2E             7      LD  A,"."
       11CD                     MOND5:
0011CD 11CD CDF41F          17      CALL    _PRINT
0011D0 11D0 10F3            13      DJNZ    MOND4
0011D2 11D2 CDF11F          17      CALL    _PRNTS
0011D5 11D5 C3EE1F          10      JP  _LTNL
                                ;
       11D8                     MONG:
0011D8 11D8 CDB21F          17      CALL    _HLHEX
0011DB 11DB D8              11      RET C
0011DC 11DC E9               4      JP  (HL)
                                ;
       11DD                     MONT:
0011DD 11DD CDB21F          17      CALL    _HLHEX
0011E0 11E0 D8              11      RET C
0011E1 11E1 22F611          16      LD  (MTS+1),HL
0011E4 11E4 CDB21F          17      CALL    _HLHEX
0011E7 11E7 D8              11      RET C
0011E8 11E8 22F311          16      LD  (MTE+1),HL
0011EB 11EB CDB21F          17      CALL    _HLHEX
0011EE 11EE D8              11      RET C
0011EF 11EF 22FF11          16      LD  (MTD+1),HL
                                ;
0011F2 11F2 210000          10  MTE:    LD  HL,0
0011F5 11F5 110000          10  MTS:    LD  DE,0
0011F8 11F8 ED52            15      SBC HL,DE
0011FA 11FA D8              11      RET C
0011FB 11FB 44               4      LD  B,H
0011FC 11FC 4D               4      LD  C,L
0011FD 11FD EB               4      EX  DE,HL
                                ;
0011FE 11FE 110000          10  MTD:    LD  DE,0
001201 1201 E5              11      PUSH    HL
001202 1202 ED52            15      SBC HL,DE
001204 1204 E1              10      POP HL
001205 1205 3804            12      JR  C,MONT2
                                ;
001207 1207 03               6      INC BC
001208 1208 EDB0                    LDIR
00120A 120A C9              10      RET
                                ;
       120B                     MONT2:
00120B 120B 09              11      ADD HL,BC
00120C 120C EB               4      EX  DE,HL
00120D 120D 09              11      ADD HL,BC
00120E 120E EB               4      EX  DE,HL
00120F 120F 03               6      INC BC
001210 1210 EDB8                    LDDR
001212 1212 C9              10      RET
                                
0012DC 12DC                         ORG $12DC
       12DC                     AT_LPRNT:
0012DC 12DC C5              11      PUSH    BC
0012DD 12DD 01011A          10      LD  BC,01A01H
0012E0 12E0 F5              11      PUSH    AF
       12E1                     _S05X1:
0012E1 12E1 ED78            12      IN  A,(C)
0012E3 12E3 E608             7      AND 8
0012E5 12E5 20FA            12      JR  NZ,_S05X1
0012E7 12E7 F1              10      POP AF
0012E8 12E8 F3               4      DI
0012E9 12E9 0D               4      DEC C
0012EA 12EA ED79            12      OUT (C),A
0012EC 12EC 0E03             7      LD  C,3
0012EE 12EE 3E0E             7      LD  A,00EH
0012F0 12F0 ED79            12      OUT (C),A
0012F2 12F2 3C               4      INC A
0012F3 12F3 03               6      INC BC
0012F4 12F4 0B               6      DEC BC
0012F5 12F5 ED79            12      OUT (C),A
0012F7 12F7 FB               4      EI
0012F8 12F8 C1              10      POP BC
0012F9 12F9 AF               4      XOR A
0012FA 12FA C9              10      RET
                                
       12FB                     _CRTCD:
0012FB 12FB 6F5059381F02191C        DB  06FH,050H,059H,038H,01FH,002H,019H,01CH
001303 1303 0007                    DB  000H,007H
001305 1305 30F8B0FF                DW  0-80*LINE,0-80
001309 1309 0C                      DB  00CH
00130A 130A A0                  WK1FD0: DB  0A0H
                                
       130B                     _C8025L:
00130B 130B 6F5059381F02191C        DB  06FH,050H,059H,038H,01FH,002H,019H,01CH
001313 1313 0007                    DB  000H,007H
001315 1315 30F8B0FF                DW  0-80*LINE,0-80
001319 1319 0C                      DB  00CH
00131A 131A A0                      DB  0A0H
                                
       131B                     _C8025H:
00131B 131B 6B5059881B01191A        DB  06BH,050H,059H,088H,01BH,001H,019H,01AH
001323 1323 000F                    DB  000H,00FH
001325 1325 30F8B0FF                DW  0-80*LINE,0-80
001329 1329 0C                      DB  00CH
00132A 132A A3                      DB  0A3H
                                
       132B                     _C4025L:
00132B 132B 37282D341F02191C        DB  037H,028H,02DH,034H,01FH,002H,019H,01CH
001333 1333 0007                    DB  000H,007H
001335 1335 18FCD8FF                DW  0-40*LINE,0-40
001339 1339 0D                      DB  00DH
00133A 133A A0                      DB  0A0H
                                
       133B                     _C4025H:
00133B 133B 35282D841B01191A        DB  035H,028H,02DH,084H,01BH,001H,019H,01AH
001343 1343 000F                    DB  000H,00FH
001345 1345 18FCD8FF                DW  0-40*LINE,0-40
001349 1349 0D                      DB  00DH
00134A 134A A3                      DB  0A3H
                                
001400 1400                         ORG $1400
       1400                     CTRLTB:
001400 1400 190CB30C510C4C08        DW  PRINTE,CTRL01,CTRL02,CTRL03
001408 1408 46087C0C2508F707        DW  CTRL04,CTRL05,CTRL06,CTRL07
001410 1410 510C420C4F08B90C        DW  CTRL08,CTRL09,CTRL0A,CTRL0B
001418 1418 22084C086408190C        DW  CTRL0C,CTRL03,CTRL0E,PRINTE
001420 1420 190C190CB30C190C        DW  PRINTE,PRINTE,CTRL01,PRINTE
001428 1428 190C190C190C190C        DW  PRINTE,PRINTE,PRINTE,PRINTE
001430 1430 190C190C2508C00C        DW  PRINTE,PRINTE,CTRL06,CTRL1B
001438 1438 3C0C250C2F0C4F08        DW  CTRL1C,CTRL1D,CTRL1E,CTRL1F
                                
001440 1440 008E01000B000C10    BEEPD:  DB  0,08EH,1,0,00BH,0,00CH,010H
001448 1448 073E08100D00FF          DB  007H,03EH,008H,010H,00DH,0,0FFH
                                
001451 1451                         ORG $1451
       1451                     AT_CAP:
001451 1451 FE61             7      CP  "a"
001453 1453 D8              11      RET C
001454 1454 FE7B             7      CP  "z"+1
001456 1456 D0              11      RET NC
001457 1457 D620             7      SUB $20
001459 1459 C9              10      RET
                                
                                ;
                                ;   LA JUMP
                                ;
       115E                     AHEX    EQU AT_2HEX
       07F7                     BELL    EQU AT_BELL
       1451                     CAP EQU AT_CAP
       02AA                     FLGET   EQU AT_FLGET
       111F                     HLHEX   EQU AT_HLHEX
       12DC                     LPRNT   EQU AT_LPRNT
       1000                     MON EQU AT_MON
       04C8                     PRNT0   EQU AT_PRNT0
       0B65                     PRINT   EQU IOCS_PRINT
                                ;
       1F82                     AT_ERR  EQU $1F82
       1F83                     AT_RET  EQU $1F83
                                ;
       1F83                     BOOT    EQU AT_RET
       1F83                     MOTOFF  EQU AT_RET
       1F83                     PRTTMS  EQU AT_RET
       1F83                     SETTMS  EQU AT_RET
                                ;
                                ;   LA WORK
                                ;
       001B                     CONYS   EQU AT_CONYS
       001C                     CONYE   EQU AT_CONYE
       001E                     CONXS   EQU AT_CONXS
       001F                     CONXE   EQU AT_CONXE
       0026                     COLORF  EQU AT_COLORF
       2C00                     DTBUF   EQU $2C00
       2400                     FATBF   EQU $2400
       1481                     FNAME   EQU $1481
       1480                     FTYPE   EQU $1480
       002F                     GCEH    EQU $2F
       FF00                     KBFAD   EQU $FF00
       003F                     KYBFX   EQU 63
       0008                     MAXDRV  EQU 8
       0019                     MAXLN   EQU 25
       FF00                     MEMAX   EQU $FF00
       0000                     STKAD   EQU $0000
       0050                     WIDTH   EQU 80
       C000                     WKSIZ   EQU $C000
       000E                     XYADR   EQU AT_XYADR
                                ;
                                ;   FOR PATCH PROGRAM
                                ;
0014A0 14A0                         ORG $14A0
                                ;
0014A0 14A0 00               4      NOP
0014A1 14A1 5F               4      LD  E,A
0014A2 14A2 FE7F             7      CP  $7F
0014A4 14A4 C9              10      RET
[EOF:X1IOCS.ASM:SHIFT_JIS]
                                    INCLUDE "LOS.ASM"
                                ;
                                ;   L-os Angeles OS
                                ;
                                ;
       14A5                     PRINTS:
0014A5 14A5 F5              11      PUSH    AF
0014A6 14A6 3E20             7      LD  A,$20
       14A8                     LTNL1:
0014A8 14A8 CDF41F          17      CALL    _PRINT
0014AB 14AB F1              10      POP AF
0014AC 14AC C9              10      RET
                                ;
       14AD                     LTNL:
0014AD 14AD F5              11      PUSH    AF
0014AE 14AE 3E0D             7      LD  A,$0D
0014B0 14B0 18F6            12      JR  LTNL1
                                ;
       14B2                     CHKATT:
0014B2 14B2 E5              11      PUSH    HL
0014B3 14B3 110B00          10      LD  DE,$0B
0014B6 14B6 19              11      ADD HL,DE
0014B7 14B7 7E               7      LD  A,(HL)
0014B8 14B8 E1              10      POP HL
0014B9 14B9 E61F             7      AND $1F
0014BB 14BB C8              11      RET Z
0014BC 14BC E5              11      PUSH    HL
0014BD 14BD 211A1F          10      LD  HL,_FILEN
0014C0 14C0 35              11      DEC (HL)
0014C1 14C1 E1              10      POP HL
0014C2 14C2 37               4      SCF
0014C3 14C3 C9              10      RET
                                ;
       14C4                     MSG:
0014C4 14C4 E5              11      PUSH    HL
0014C5 14C5 260D             7      LD  H,$0D
0014C7 14C7 1803            12      JR  MSG1
                                ;
       14C9                     MSX:
0014C9 14C9 E5              11      PUSH    HL
0014CA 14CA 2600             7      LD  H,0
       14CC                     MSG1:
0014CC 14CC F5              11      PUSH    AF
0014CD 14CD D5              11      PUSH    DE
       14CE                     MSX1:
0014CE 14CE 1A               7      LD  A,(DE)
0014CF 14CF BC               4      CP  H
0014D0 14D0 2806            12      JR  Z,MSX2
0014D2 14D2 CDF41F          17      CALL    _PRINT
0014D5 14D5 13               6      INC DE
0014D6 14D6 18F6            12      JR  MSX1
       14D8                     MSX2:
0014D8 14D8 D1              10      POP DE
0014D9 14D9 F1              10      POP AF
0014DA 14DA E1              10      POP HL
0014DB 14DB C9              10      RET
                                ;
       14DC                     SDVSW:
0014DC 14DC CD6A20          17      CALL    _CHGDRV
0014DF 14DF D8              11      RET C
0014E0 14E0 327D1F          13      LD  (_DVSW),A
0014E3 14E3 C9              10      RET
                                ;
       14E4                     CAP4:
0014E4 14E4 FE05             7      CP  5
0014E6 14E6 C0              11      RET NZ
0014E7 14E7 3EE5             7      LD  A,$E5
0014E9 14E9 C9              10      RET
                                
       14EA                     MPRINT:
0014EA 14EA E3              19      EX  (SP),HL
       14EB                     MPRNT1:
0014EB 14EB 7E               7      LD  A,(HL)
0014EC 14EC 23               6      INC HL
0014ED 14ED B7               4      OR  A
0014EE 14EE C4F41F          17      CALL    NZ,_PRINT
0014F1 14F1 B7               4      OR  A
0014F2 14F2 20F7            12      JR  NZ,MPRNT1
0014F4 14F4 E3              19      EX  (SP),HL
0014F5 14F5 C9              10      RET
                                ;
       14F6                     BRKEY:
0014F6 14F6 CDD01F          17      CALL    _GETKY
       14F9                     BRKEY1:
0014F9 14F9 FE1B             7      CP  $1B
0014FB 14FB C8              11      RET Z
0014FC 14FC FE03             7      CP  3
0014FE 14FE C9              10      RET
                                
0014FF 14FF                         DS  1
                                ;
                                ;
       1500                     START:      ;X1 START $1500
                                ;
                                ;
       1500                     COLD:
001500 1500 2A7E1F          16      LD  HL,(_USR)
001503 1503 E9               4      JP  (HL)
                                ;
       1504                     INKEY:
001504 1504 CDD01F          17      CALL    _GETKY
001507 1507 B7               4      OR  A
001508 1508 28FA            12      JR  Z,INKEY
00150A 150A C9              10      RET
                                
       150B                     PAUSE:
00150B 150B CDCD1F          17      CALL    _BRKEY
00150E 150E 2817            12      JR  Z,PAUSE2
001510 1510 FE20             7      CP  $20
001512 1512 200E            12      JR  NZ,PAUSE1
                                ;
       1514                     NULL:
001514 1514 CDD01F          17      CALL    _GETKY
001517 1517 B7               4      OR  A
001518 1518 20FA            12      JR  NZ,NULL
00151A 151A CDCA1F          17      CALL    _INKEY
00151D 151D CDF914          17      CALL    BRKEY1
001520 1520 2805            12      JR  Z,PAUSE2
                                ;
       1522                     PAUSE1:
001522 1522 E3              19      EX  (SP),HL
001523 1523 23               6      INC HL
001524 1524 23               6      INC HL
001525 1525 E3              19      EX  (SP),HL
001526 1526 C9              10      RET
                                ;
       1527                     PAUSE2:
001527 1527 E3              19      EX  (SP),HL
001528 1528 7E               7      LD  A,(HL)
001529 1529 23               6      INC HL
00152A 152A 66               7      LD  H,(HL)
00152B 152B 6F               4      LD  L,A
00152C 152C E3              19      EX  (SP),HL
00152D 152D C9              10      RET
                                ;
       152E                     PRTDHL:
00152E 152E 23               6      INC HL
00152F 152F EB               4      EX  DE,HL
001530 1530 CDB21F          17      CALL    _HLHEX
                                ;
       1533                     PRTHL:
001533 1533 7C               4      LD  A,H
001534 1534 CD3815          17      CALL    PRTHX
001537 1537 7D               4      LD  A,L
                                ;
       1538                     PRTHX:
001538 1538 F5              11      PUSH    AF
001539 1539 07               4      RLCA
00153A 153A 07               4      RLCA
00153B 153B 07               4      RLCA
00153C 153C 07               4      RLCA
00153D 153D CD4115          17      CALL    PRTA2
001540 1540 F1              10      POP AF
       1541                     PRTA2:
001541 1541 CD5B15          17      CALL    ASC
001544 1544 C3F41F          10      JP  _PRINT
                                ;
       1547                     HEXHL:
001547 1547 7C               4      LD  A,H
001548 1548 CD4C15          17      CALL    HEXHX
00154B 154B 7D               4      LD  A,L
                                ;
       154C                     HEXHX:
00154C 154C F5              11      PUSH    AF
00154D 154D 07               4      RLCA
00154E 154E 07               4      RLCA
00154F 154F 07               4      RLCA
001550 1550 07               4      RLCA
001551 1551 CD5515          17      CALL    HEXA2
001554 1554 F1              10      POP AF
       1555                     HEXA2:
001555 1555 CD5B15          17      CALL    ASC
001558 1558 12               7      LD  (DE),A
001559 1559 13               6      INC DE
00155A 155A C9              10      RET
                                ;
       155B                     ASC:
00155B 155B E60F             7      AND $0F
00155D 155D F630             7      OR  $30
00155F 155F FE3A             7      CP  $3A
001561 1561 D8              11      RET C
001562 1562 C607             7      ADD A,7
001564 1564 C9              10      RET
                                ;
       1565                     HEX:
001565 1565 CDEB20          17      CALL    _CAP
001568 1568 D630             7      SUB $30
00156A 156A D8              11      RET C
00156B 156B FE0A             7      CP  $0A
00156D 156D 3F               4      CCF
00156E 156E D0              11      RET NC
00156F 156F FE11             7      CP  $11
001571 1571 D8              11      RET C
001572 1572 D607             7      SUB 7
001574 1574 FE10             7      CP  $10
001576 1576 3F               4      CCF
001577 1577 C9              10      RET
                                ;
       1578                     WOPEN:
001578 1578 210000          10      LD  HL,0
00157B 157B 22061F          16      LD  (_SIZEH),HL
                                ;
       157E                     WOPENH:
00157E 157E CD791A          17      CALL    CHKWT
001581 1581 D8              11      RET C
                                ;
001582 1582 218C14          10      LD  HL,FNAME+$0B
001585 1585 3620            10      LD  (HL),$20
001587 1587 0614             7      LD  B,20
       1589                     WOPS1:
001589 1589 23               6      INC HL
00158A 158A 77               7      LD  (HL),A      ;A=0
00158B 158B 10FC            13      DJNZ    WOPS1
                                ;
       158D                     WOPENX:
00158D 158D CDA320          17      CALL    _SOPEN
001590 1590 3805            12      JR  C,WOPEN1
001592 1592 CD8E20          17      CALL    _KILLS
001595 1595 1803            12      JR  WOPEN1X
       1597                     WOPEN1:
001597 1597 C49A20          17      CALL    NZ,_COPEN
       159A                     WOPEN1X:
00159A 159A D8              11      RET C
       159B                     WOPEN2:
00159B 159B 2A721F          16      LD  HL,(_SIZE)  ;SIZE SET
00159E 159E 229D14          16      LD  (FNAME+$1C),HL
0015A1 15A1 2A061F          16      LD  HL,(_SIZEH)
0015A4 15A4 229F14          16      LD  (FNAME+$1E),HL
0015A7 15A7 210000          10      LD  HL,0
0015AA 15AA 220C1F          16      LD  (_CLPS),HL
0015AD 15AD CDE520          17      CALL    _SETTMS
                                ;
0015B0 15B0 3A8014          13      LD  A,(FTYPE)
0015B3 15B3 1F               4      RRA
0015B4 15B4 D0              11      RET NC
0015B5 15B5 118D14          10      LD  DE,FNAME+$0C
0015B8 15B8 2A701F          16      LD  HL,(_DTADR)
0015BB 15BB CDCD20          17      CALL    _HEXHL
0015BE 15BE 3EA0             7      LD  A,$A0
0015C0 15C0 12               7      LD  (DE),A
0015C1 15C1 13               6      INC DE
0015C2 15C2 2A6E1F          16      LD  HL,(_EXADR)
0015C5 15C5 CDCD20          17      CALL    _HEXHL
0015C8 15C8 AF               4      XOR A
0015C9 15C9 12               7      LD  (DE),A
       15CA                     WRTA0:
0015CA 15CA 3A9114          13      LD  A,(FNAME+$10)
0015CD 15CD 01A008          10      LD  BC,$08A0
0015D0 15D0 B9               4      CP  C
0015D1 15D1 200C            12      JR  NZ,WRTA3
0015D3 15D3 3E20             7      LD  A,$20
0015D5 15D5 218114          10      LD  HL,FNAME
       15D8                     WRTA1:
0015D8 15D8 BE               7      CP  (HL)
0015D9 15D9 2001            12      JR  NZ,WRTA2
0015DB 15DB 71               7      LD  (HL),C
       15DC                     WRTA2:
0015DC 15DC 23               6      INC HL
0015DD 15DD 10F9            13      DJNZ    WRTA1
       15DF                     WRTA3:
0015DF 15DF AF               4      XOR A       ;CF=0 ZF=1
0015E0 15E0 C9              10      RET
                                ;
       15E1                     FSIZE:
0015E1 15E1 2A721F          16      LD  HL,(_SIZE)
0015E4 15E4 2B               6      DEC HL
0015E5 15E5 CB3C             8      SRL H
0015E7 15E7 CB3C             8      SRL H
0015E9 15E9 24               4      INC H
0015EA 15EA 44               4      LD  B,H
0015EB 15EB C9              10      RET
                                ;
       15EC                     WRD:
0015EC 15EC CDE115          17      CALL    FSIZE
                                ;
0015EF 15EF CD6420          17      CALL    _WRDF
0015F2 15F2 D4BB20          17      CALL    NC,_WTFAT
0015F5 15F5 D4C120          17      CALL    NC,_WTDIRX
0015F8 15F8 D8              11      RET C
       15F9                     WRDX2:
0015F9 15F9 ED5B9B14        20      LD  DE,(FNAME+$1A)
0015FD 15FD 184E            12      JR  WRD1
                                ;
       15FF                     WRDF:
0015FF 15FF 110200          10      LD  DE,2
       1602                     WRDF1:
001602 1602 C5              11      PUSH    BC      ;FAT
001603 1603 D5              11      PUSH    DE
001604 1604 CD4620          17      CALL    _GNCL
001607 1607 3819            12      JR  C,WRDF3
001609 1609 7A               4      LD  A,D
00160A 160A B3               4      OR  E
00160B 160B 2024            12      JR  NZ,WRDF4
00160D 160D E1              10      POP HL      ;HL=DE
00160E 160E E5              11      PUSH    HL
00160F 160F ED5B0C1F        20      LD  DE,(_CLPS)
001613 1613 220C1F          16      LD  (_CLPS),HL
001616 1616 7A               4      LD  A,D
001617 1617 B3               4      OR  E
001618 1618 2005            12      JR  NZ,WRDF2
00161A 161A 229B14          16      LD  (FNAME+$1A),HL
00161D 161D 1803            12      JR  WRDF3
       161F                     WRDF2:
00161F 161F CD4920          17      CALL    _SNCL
       1622                     WRDF3:
001622 1622 D1              10      POP DE
001623 1623 C1              10      POP BC
001624 1624 D8              11      RET C
001625 1625 100C            13      DJNZ    WRDF5
001627 1627 ED5B0C1F        20      LD  DE,(_CLPS)
00162B 162B 21FFFF          10      LD  HL,$FFFF
00162E 162E C34920          10      JP  _SNCL
                                ;
       1631                     WRDF4:
001631 1631 D1              10      POP DE
001632 1632 C1              10      POP BC
       1633                     WRDF5:
001633 1633 13               6      INC DE
001634 1634 CDC420          17      CALL    _ENDCL
001637 1637 38C9            12      JR  C,WRDF1
       1639                     EMTOFF:
001639 1639 37               4      SCF
00163A 163A 1834            12      JR  MOTOF2
                                ;
       163C                     WRDX:
00163C 163C 2A0C1F          16      LD  HL,(_CLPS)
00163F 163F E5              11      PUSH    HL
001640 1640 CD6420          17      CALL    _WRDF
001643 1643 D1              10      POP DE
001644 1644 D8              11      RET C
001645 1645 7A               4      LD  A,D
001646 1646 B3               4      OR  E
001647 1647 28B0            12      JR  Z,WRDX2
001649 1649 CD4620          17      CALL    _GNCL
00164C 164C D8              11      RET C
                                ;
       164D                     WRD1:
00164D 164D 0600             7      LD  B,0
       164F                     WRDD:
00164F 164F 2A701F          16      LD  HL,(_DTADR)
       1652                     WRD3:
001652 1652 ED530C1F        20      LD  (_CLPS),DE
001656 1656 C5              11      PUSH    BC
001657 1657 D5              11      PUSH    DE
001658 1658 CD4F20          17      CALL    _CLUST
00165B 165B CD4320          17      CALL    _DWTC
00165E 165E D1              10      POP DE
00165F 165F 384E            12      JR  C,RDD3      ;MOTOFF&POP BC
001661 1661 E5              11      PUSH    HL
001662 1662 CD051C          17      CALL    ENDSDI
001665 1665 E1              10      POP HL
001666 1666 C1              10      POP BC
001667 1667 3069            12      JR  NC,WRDE
001669 1669 10E7            13      DJNZ    WRD3
00166B 166B ED530C1F        20      LD  (_CLPS),DE
       166F                     MOTOF3:
00166F 166F AF               4      XOR A
       1670                     MOTOF2:
001670 1670 C34C20          10      JP  _MOTOFF
                                ;
       1673                     RDD:
001673 1673 3A8C14          13      LD  A,(FNAME+$0B)
001676 1676 CB67             8      BIT 4,A
001678 1678 205C            12      JR  NZ,CHDIR
                                ;
00167A 167A 2A061F          16      LD  HL,(_SIZEH)
00167D 167D 7C               4      LD  A,H
00167E 167E B5               4      OR  L
00167F 167F 37               4      SCF
001680 1680 C0              11      RET NZ
001681 1681 2A701F          16      LD  HL,(_DTADR)
001684 1684 ED5B721F        20      LD  DE,(_SIZE)
001688 1688 19              11      ADD HL,DE
001689 1689 D8              11      RET C
00168A 168A EB               4      EX  DE,HL
00168B 168B 2A6A1F          16      LD  HL,(_MEMAX)
00168E 168E ED52            15      SBC HL,DE
001690 1690 D8              11      RET C
                                ;
001691 1691 CDE115          17      CALL    FSIZE
                                ;
       1694                     RDDX:
001694 1694 2A701F          16      LD  HL,(_DTADR)
                                ;
       1697                     RDD1:
001697 1697 ED5B0C1F        20      LD  DE,(_CLPS)
00169B 169B C5              11      PUSH    BC
00169C 169C E5              11      PUSH    HL
00169D 169D D5              11      PUSH    DE
00169E 169E CD051C          17      CALL    ENDSDI
0016A1 16A1 ED530C1F        20      LD  (_CLPS),DE
0016A5 16A5 D1              10      POP DE
0016A6 16A6 300F            12      JR  NC,RDD2
0016A8 16A8 E1              10      POP HL
                                ;
0016A9 16A9 CD4F20          17      CALL    _CLUST
0016AC 16AC CD4020          17      CALL    _DRDC
                                ;
       16AF                     RDD3:
0016AF 16AF C1              10      POP BC      ;CF=1 POP BC JP MOTOFF
0016B0 16B0 38BE            12      JR  C,MOTOF2    ;MOTOF2
0016B2 16B2 10E3            13      DJNZ    RDD1
0016B4 16B4 AF               4      XOR A
0016B5 16B5 18B9            12      JR  MOTOF2      ;ZF=1    CONT.OK
                                ;
       16B7                     RDD2:
0016B7 16B7 2A641F          16      LD  HL,(_DTBUF)
0016BA 16BA E5              11      PUSH    HL
0016BB 16BB CD4F20          17      CALL    _CLUST
0016BE 16BE CD4020          17      CALL    _DRDC
0016C1 16C1 E1              10      POP HL
0016C2 16C2 D1              10      POP DE
0016C3 16C3 38EA            12      JR  C,RDD3      ;POP BC&JP MOTOFF
0016C5 16C5 ED4B721F        20      LD  BC,(_SIZE)
0016C9 16C9 0B               6      DEC BC
0016CA 16CA 78               4      LD  A,B
0016CB 16CB E603             7      AND 3
0016CD 16CD 47               4      LD  B,A
0016CE 16CE 03               6      INC BC
0016CF 16CF EDB0                    LDIR
0016D1 16D1 C1              10      POP BC
       16D2                     WRDE:
0016D2 16D2 F6FF             7      OR  $FF     ;CF=0 ZF=0  END
0016D4 16D4 189A            12      JR  MOTOF2
                                ;
       16D6                     CHDIR:
0016D6 16D6 2A9B14          16      LD  HL,(FNAME+$1A)
       16D9                     CHDIR2:
0016D9 16D9 FDE5            15      PUSH    IY
0016DB 16DB CD8520          17      CALL    _DEVADR
0016DE 16DE FD751A          19      LD  (IY+DPB_SDIR),L
0016E1 16E1 FD741B          19      LD  (IY+DPB_SDIR+1),H
0016E4 16E4 FDE1            14      POP IY
0016E6 16E6 C9              10      RET
                                ;
       16E7                     FILE6:
0016E7 16E7 AF               4      XOR A
0016E8 16E8 32191F          13      LD  (_WILD),A
0016EB 16EB 3E20             7      LD  A,$20
0016ED 16ED 060B             7      LD  B,8+3
0016EF 16EF 218114          10      LD  HL,FNAME
0016F2 16F2 E5              11      PUSH    HL
0016F3 16F3 CDA217          17      CALL    FILE7
0016F6 16F6 E1              10      POP HL
0016F7 16F7 37               4      SCF
0016F8 16F8 C9              10      RET
                                ;
       16F9                     FILE:
0016F9 16F9 328014          13      LD  (FTYPE),A
                                ;
0016FC 16FC CD2420          17      CALL    _RDVSW
0016FF 16FF 325D1F          13      LD  (_DSK),A
001702 1702 C37920          10      JP  _FILEX
                                ;
       1705                     FILEX:
001705 1705 CDDC20          17      CALL    _SPSK
001708 1708 CD2D1C          17      CALL    CCHK3
00170B 170B 280C            12      JR  Z,DEVI1
00170D 170D 13               6      INC DE
00170E 170E 1A               7      LD  A,(DE)
00170F 170F 1B               6      DEC DE
001710 1710 FE3A             7      CP  ":"
001712 1712 2005            12      JR  NZ,DEVI1
001714 1714 1A               7      LD  A,(DE)      ;DRIVE
001715 1715 13               6      INC DE
001716 1716 13               6      INC DE
001717 1717 1803            12      JR  DEVI2
                                ;
       1719                     DEVI1:
001719 1719 3A5D1F          13      LD  A,(_DSK)
                                ;
       171C                     DEVI2:
00171C 171C CD6A20          17      CALL    _CHGDRV
00171F 171F 38C6            12      JR  C,FILE6
                                ;
001721 1721 FDE5            15      PUSH    IY
001723 1723 CD8520          17      CALL    _DEVADR
001726 1726 FD6E1A          19      LD  L,(IY+DPB_SDIR)
001729 1729 FD661B          19      LD  H,(IY+DPB_SDIR+1)
00172C 172C FDE1            14      POP IY
                                ;
00172E 172E 1A               7      LD  A,(DE)
00172F 172F FE5C             7      CP  $5C     ;ルート
001731 1731 3E20             7      LD  A,$20       ;通常(SAVE)
001733 1733 2006            12      JR  NZ,FILE1X
001735 1735 13               6      INC DE
001736 1736 3E10             7      LD  A,$10       ;DIR
001738 1738 210000          10      LD  HL,0
                                ;
       173B                     FILE1X:
00173B 173B 328C14          13      LD  (FNAME+$0B),A
                                ;
       173E                     FILE1:
00173E 173E 221C1F          16      LD  (_NDIRP),HL
                                ;
001741 1741 D5              11      PUSH    DE
       1742                     FILE1L:
001742 1742 1A               7      LD  A,(DE)
001743 1743 FE5C             7      CP  $5C
001745 1745 CABE17          10      JP  Z,FILECD    ;階層ディレクトリ
001748 1748 13               6      INC DE
001749 1749 CD2D1C          17      CALL    CCHK3
00174C 174C 20F4            12      JR  NZ,FILE1L
00174E 174E D1              10      POP DE
00174F 174F C37C20          10      JP  _FILED
                                ;
       1752                     FILED:
001752 1752 CDE716          17      CALL    FILE6
001755 1755 0608             7      LD  B,8
                                ;
001757 1757 1A               7      LD  A,(DE)      ;$E5の処理
001758 1758 FEE5             7      CP  $E5
00175A 175A 2005            12      JR  NZ,FILE3
00175C 175C 3E05             7      LD  A,5
00175E 175E 13               6      INC DE
00175F 175F 180C            12      JR  FILE2
                                ;
       1761                     FILE3:
001761 1761 CDA717          17      CALL    CCHKF
001764 1764 C8              11      RET Z
001765 1765 FE2A             7      CP  "*"
001767 1767 282F            12      JR  Z,FILE9
001769 1769 FE2E             7      CP  "."
00176B 176B 280C            12      JR  Z,FILE4
       176D                     FILE2:
00176D 176D 77               7      LD  (HL),A
00176E 176E 23               6      INC HL
00176F 176F 10F0            13      DJNZ    FILE3
                                ;
       1771                     FILE3L:
001771 1771 CDA717          17      CALL    CCHKF
001774 1774 C8              11      RET Z
001775 1775 FE2E             7      CP  "."
001777 1777 20F8            12      JR  NZ,FILE3L
                                ;
       1779                     FILE4:
001779 1779 218914          10      LD  HL,FNAME+8
00177C 177C 0603             7      LD  B,3
                                ;
       177E                     FILE4L:
00177E 177E CDA717          17      CALL    CCHKF
001781 1781 C8              11      RET Z
001782 1782 FE2E             7      CP  "."
001784 1784 2008            12      JR  NZ,FILE12
001786 1786 328114          13      LD  (FNAME),A   ;..の処理
001789 1789 328214          13      LD  (FNAME+1),A
00178C 178C 3E20             7      LD  A,$20
       178E                     FILE12:
00178E 178E FE2A             7      CP  "*"
001790 1790 280B            12      JR  Z,FILE10
001792 1792 77               7      LD  (HL),A
001793 1793 23               6      INC HL
001794 1794 10E8            13      DJNZ    FILE4L
       1796                     FILENE:
001796 1796 A7               4      AND A
001797 1797 C9              10      RET
                                ;
       1798                     FILE9:
001798 1798 CD9D17          17      CALL    FILE10
00179B 179B 18D4            12      JR  FILE3L
                                ;
       179D                     FILE10:
00179D 179D 3E3F             7      LD  A,"?"
00179F 179F CDB917          17      CALL    FILE11
                                ;
       17A2                     FILE7:
0017A2 17A2 77               7      LD  (HL),A
0017A3 17A3 23               6      INC HL
0017A4 17A4 10FC            13      DJNZ    FILE7
0017A6 17A6 C9              10      RET
                                ;
       17A7                     CCHKF:
0017A7 17A7 1A               7      LD  A,(DE)
0017A8 17A8 CD2A1C          17      CALL    CCHK2
0017AB 17AB C8              11      RET Z
0017AC 17AC CDEB20          17      CALL    _CAP
0017AF 17AF FEA0             7      CP  $A0
0017B1 17B1 2002            12      JR  NZ,CCHKF2
0017B3 17B3 3E20             7      LD  A,$20
       17B5                     CCHKF2:
0017B5 17B5 13               6      INC DE
0017B6 17B6 FE3F             7      CP  "?"
0017B8 17B8 C0              11      RET NZ
                                ;
       17B9                     FILE11:
0017B9 17B9 32191F          13      LD  (_WILD),A
0017BC 17BC A7               4      AND A       ;ZF=0   CF=0
0017BD 17BD C9              10      RET
                                ;
       17BE                     FILECD:
0017BE 17BE D1              10      POP DE
0017BF 17BF CD7C20          17      CALL    _FILED
0017C2 17C2 D5              11      PUSH    DE
0017C3 17C3 CDA320          17      CALL    _SOPEN
0017C6 17C6 D1              10      POP DE
0017C7 17C7 3F               4      CCF
0017C8 17C8 D0              11      RET NC
0017C9 17C9 011A00          10      LD  BC,$1A
0017CC 17CC 09              11      ADD HL,BC
0017CD 17CD 7E               7      LD  A,(HL)
0017CE 17CE 23               6      INC HL
0017CF 17CF 66               7      LD  H,(HL)
0017D0 17D0 6F               4      LD  L,A
0017D1 17D1 13               6      INC DE
0017D2 17D2 C33E17          10      JP  FILE1
                                ;
       17D5                     FPRINT2:
0017D5 17D5 0608             7      LD  B,8     ;FILENAME
0017D7 17D7 CDE117          17      CALL    MSN
0017DA 17DA 3E2E             7      LD  A,"."
0017DC 17DC CDF41F          17      CALL    _PRINT
0017DF 17DF 0603             7      LD  B,3
       17E1                     MSN:
0017E1 17E1 7E               7      LD  A,(HL)
0017E2 17E2 CDE11B          17      CALL    CAP3
0017E5 17E5 CDF41F          17      CALL    _PRINT
0017E8 17E8 23               6      INC HL
0017E9 17E9 10F6            13      DJNZ    MSN
0017EB 17EB C9              10      RET
                                ;
       17EC                     DIR:
0017EC 17EC 113B1C          10      LD  DE,DIRW
0017EF 17EF CD7920          17      CALL    _FILEX
       17F2                     DIRX:
0017F2 17F2 CDB820          17      CALL    _RDFAT
0017F5 17F5 D8              11      RET C
0017F6 17F6 CD6D20          17      CALL    _DSKF
0017F9 17F9 CDE820          17      CALL    _PRTHLX
0017FC 17FC CDE21F          17      CALL    _MPRNT
0017FF 17FF 204B204279746573        DB  " K Bytes Free",9,0
            20467265650900      
00180E 180E 3A5D1F          13      LD  A,(_DSK)
001811 1811 CDF41F          17      CALL    _PRINT
001814 1814 CDE21F          17      CALL    _MPRNT
001817 1817 3A5C00                  DB  ":",$5C,0
                                ;
00181A 181A CDA620          17      CALL    _SOPENX
00181D 181D F5              11      PUSH    AF
00181E 181E E5              11      PUSH    HL
                                ;
00181F 181F 2A1C1F          16      LD  HL,(_NDIRP)
001822 1822 7C               4      LD  A,H
001823 1823 B5               4      OR  L
001824 1824 C4BE1F          17      CALL    NZ,_PRTHL
                                ;
       1827                     DIRT2:
001827 1827 CDEE1F          17      CALL    _LTNL
00182A 182A E1              10      POP HL
00182B 182B F1              10      POP AF
                                ;
       182C                     DIRS1:
00182C 182C 3815            12      JR  C,NCLOSES
                                ;
       182E                     DIRS2:
00182E 182E CD6418          17      CALL    FNAMEX
001831 1831 3F               4      CCF
001832 1832 D0              11      RET NC
001833 1833 CDAC20          17      CALL    _NOPENX
001836 1836 18F4            12      JR  DIRS1
                                ;
       1838                     RCLOSE:
001838 1838 F5              11      PUSH    AF
001839 1839 CD4C20          17      CALL    _MOTOFF
00183C 183C 3A1A1F          13      LD  A,(_FILEN)
00183F 183F B7               4      OR  A
001840 1840 2805            12      JR  Z,POPSCF
001842 1842 F1              10      POP AF
       1843                     NCLOSES:
001843 1843 37               4      SCF
001844 1844 C8              11      RET Z       ;ZF=1 ERROR
001845 1845 3F               4      CCF         ;CF=0
001846 1846 C9              10      RET
       1847                     POPSCF:
001847 1847 F1              10      POP AF
001848 1848 37               4      SCF
001849 1849 C9              10      RET
                                ;
       184A                     DSKF:
00184A 184A 110200          10      LD  DE,2
00184D 184D 6A               4      LD  L,D
00184E 184E 62               4      LD  H,D     ;LD HL,0
       184F                     DSKF1:
00184F 184F D5              11      PUSH    DE
001850 1850 E5              11      PUSH    HL
001851 1851 CD4620          17      CALL    _GNCL
001854 1854 E1              10      POP HL
001855 1855 38F0            12      JR  C,POPSCF
001857 1857 7A               4      LD  A,D
001858 1858 B3               4      OR  E
001859 1859 2001            12      JR  NZ,DSKF2
00185B 185B 23               6      INC HL
       185C                     DSKF2:
00185C 185C D1              10      POP DE
00185D 185D 13               6      INC DE
00185E 185E CDC420          17      CALL    _ENDCL
001861 1861 38EC            12      JR  C,DSKF1
001863 1863 C9              10      RET
                                ;
       1864                     FNAMEX:
001864 1864 FDE5            15      PUSH    IY
001866 1866 E5              11      PUSH    HL
001867 1867 FDE1            14      POP IY
001869 1869 FD7E0B          19      LD  A,(IY+$0B)
00186C 186C 4F               4      LD  C,A
00186D 186D E60E             7      AND $0E
00186F 186F 206B            12      JR  NZ,FNAMEE
001871 1871 3E3B             7      LD  A,";"
001873 1873 CB41             8      BIT 0,C
001875 1875 2802            12      JR  Z,DIR1
001877 1877 3E2A             7      LD  A,"*"
       1879                     DIR1:
001879 1879 CDF41F          17      CALL    _PRINT
00187C 187C 0609             7      LD  B,9
       187E                     DIR1L:
00187E 187E CDF11F          17      CALL    _PRNTS
001881 1881 10FB            13      DJNZ    DIR1L
                                ;
001883 1883 3A5D1F          13      LD  A,(_DSK)    ;DEVICE
001886 1886 CDF41F          17      CALL    _PRINT
001889 1889 CDEF18          17      CALL    PRNTC
00188C 188C CDB520          17      CALL    _NFPRT      ;FILENAME PRINT
00188F 188F CDEF18          17      CALL    PRNTC
001892 1892 FD7E10          19      LD  A,(IY+$10)  ;LAバイナリ?
001895 1895 FEA0             7      CP  $A0
001897 1897 282A            12      JR  Z,DIR4
001899 1899 0606             7      LD  B,6
       189B                     DIR2:
00189B 189B CDEF18          17      CALL    PRNTC
00189E 189E 10FB            13      DJNZ    DIR2
0018A0 18A0 CB61             8      BIT 4,C     ;ディレクトリ?
0018A2 18A2 280E            12      JR  Z,DIR3
0018A4 18A4 CDE21F          17      CALL    _MPRNT
0018A7 18A7 3C6469723E202020        DB  "<dir>   ",0
            00                  
0018B0 18B0 1824            12      JR  DIR6
       18B2                     DIR3:
0018B2 18B2 FD6E1E          19      LD  L,(IY+$1E)  ;サイズの上位16bit
0018B5 18B5 FD661F          19      LD  H,(IY+$1F)
0018B8 18B8 CDBE1F          17      CALL    _PRTHL
0018BB 18BB 110000          10      LD  DE,0
0018BE 18BE CDE518          17      CALL    DIR7
0018C1 18C1 1813            12      JR  DIR6
       18C3                     DIR4:
0018C3 18C3 CD2E15          17      CALL    PRTDHL
0018C6 18C6 EB               4      EX  DE,HL
0018C7 18C7 1B               6      DEC DE
0018C8 18C8 CDEF18          17      CALL    PRNTC
       18CB                     DIR5:
0018CB 18CB E5              11      PUSH    HL
0018CC 18CC CDE518          17      CALL    DIR7
0018CF 18CF E1              10      POP HL
0018D0 18D0 CDEF18          17      CALL    PRNTC
0018D3 18D3 CD2E15          17      CALL    PRTDHL
       18D6                     DIR6:
0018D6 18D6 CDE220          17      CALL    _PRTTMS
0018D9 18D9 CDEE1F          17      CALL    _LTNL
       18DC                     FNAMEE:
0018DC 18DC FDE1            14      POP IY
       18DE                     NFPRTX:
0018DE 18DE CDC71F          17      CALL    _PAUSE      ;-NFPRT から呼び出す
0018E1 18E1 8A1B                    DW  EBELL
0018E3 18E3 A7               4      AND A
0018E4 18E4 C9              10      RET
                                ;
       18E5                     DIR7:
0018E5 18E5 FD6E1C          19      LD  L,(IY+$1C)  ;サイズの下位16bit
0018E8 18E8 FD661D          19      LD  H,(IY+$1D)
0018EB 18EB 19              11      ADD HL,DE
0018EC 18EC C3BE1F          10      JP  _PRTHL
                                ;
       18EF                     PRNTC:
0018EF 18EF 3E3A             7      LD  A,":"
0018F1 18F1 C3F41F          10      JP  _PRINT
                                ;
       18F4                     NROPEN:
0018F4 18F4 CDA920          17      CALL    _NOPEN
0018F7 18F7 1811            12      JR  ROPEN2
                                ;
       18F9                     ROPEN:
0018F9 18F9 3A8C14          13      LD  A,(FNAME+$0B)
0018FC 18FC CB67             8      BIT 4,A
0018FE 18FE 2807            12      JR  Z,ROPEN1
001900 1900 3A8114          13      LD  A,(FNAME)
001903 1903 FE20             7      CP  $20
001905 1905 2839            12      JR  Z,ROPENR
                                ;
       1907                     ROPEN1:
001907 1907 CDA320          17      CALL    _SOPEN      ;READ OPEN
       190A                     ROPEN2:
00190A 190A 3841            12      JR  C,ROPENE
                                ;
00190C 190C 118114          10      LD  DE,FNAME
00190F 190F 012000          10      LD  BC,$20
001912 1912 EDB0                    LDIR
001914 1914 2A9B14          16      LD  HL,(FNAME+$1A)
001917 1917 220C1F          16      LD  (_CLPS),HL
00191A 191A 2A9D14          16      LD  HL,(FNAME+$1C)
00191D 191D 22721F          16      LD  (_SIZE),HL
001920 1920 2A9F14          16      LD  HL,(FNAME+$1E)
001923 1923 22061F          16      LD  (_SIZEH),HL
                                ;
001926 1926 118D14          10      LD  DE,FNAME+$0C
001929 1929 21FFFF          10      LD  HL,$FFFF
00192C 192C 220E1F          16      LD  (_GCAD),HL
00192F 192F CDB21F          17      CALL    _HLHEX
001932 1932 22701F          16      LD  (_DTADR),HL
001935 1935 119214          10      LD  DE,FNAME+$11
001938 1938 CDB21F          17      CALL    _HLHEX
00193B 193B 226E1F          16      LD  (_EXADR),HL
00193E 193E AF               4      XOR A
00193F 193F C9              10      RET
                                ;
       1940                     ROPENR:
001940 1940 2A1C1F          16      LD  HL,(_NDIRP)
001943 1943 229B14          16      LD  (FNAME+$1A),HL
001946 1946 210000          10      LD  HL,0
001949 1949 229D14          16      LD  (FNAME+$1C),HL
00194C 194C C9              10      RET
                                ;
       194D                     ROPENE:
00194D 194D 3E08             7      LD  A,8
00194F 194F C9              10      RET
                                ;
       1950                     COPEN:
001950 1950 2A341F          16      LD  HL,(_NSEA)
001953 1953 180C            12      JR  SOPEN0
                                ;
       1955                     SOPEN:
001955 1955 CDB820          17      CALL    _RDFAT      ;SEARCH OPEN
001958 1958 3875            12      JR  C,RDDERR
                                ;
       195A                     SOPENX:
00195A 195A AF               4      XOR A
00195B 195B 321A1F          13      LD  (_FILEN),A
00195E 195E 2A321F          16      LD  HL,(_FSEA)
       1961                     SOPEN0:
001961 1961 229819          16      LD  (OPENPAT+1),HL
                                ;
001964 1964 ED5B1C1F        20      LD  DE,(_NDIRP)
001968 1968 7A               4      LD  A,D
001969 1969 B3               4      OR  E
00196A 196A 321B1F          13      LD  (_DIRF),A
00196D 196D 2819            12      JR  Z,SDIRX1
                                ;
00196F 196F CDFB19          17      CALL    DC      ;???DIR
001972 1972 3808            12      JR  C,SDIRX0
001974 1974 2A1E1F          16      LD  HL,(_DIRBF)
001977 1977 7E               7      LD  A,(HL)
001978 1978 FE2E             7      CP  "."
00197A 197A 2815            12      JR  Z,SDIRX2
       197C                     SDIRX0:
00197C 197C AF               4      XOR A
00197D 197D 321B1F          13      LD  (_DIRF),A
001980 1980 6F               4      LD  L,A
001981 1981 67               4      LD  H,A
001982 1982 221C1F          16      LD  (_NDIRP),HL ;HL=0
001985 1985 CDD916          17      CALL    CHDIR2
       1988                     SDIRX1:
001988 1988 ED5B601F        20      LD  DE,(_DIRPS) ;サブDIR
                                ;
       198C                     SOPEN1:
00198C 198C CDFB19          17      CALL    DC      ;FILE SEARCH
00198F 198F 383E            12      JR  C,RDDERR
                                ;
       1991                     SDIRX2:
001991 1991 0E20             7      LD  C,32
001993 1993 2A1E1F          16      LD  HL,(_DIRBF)
       1996                     SOPEN2:
001996 1996 D5              11      PUSH    DE
001997 1997 CD191A          17  OPENPAT:CALL    FILESE      ;自己書き換え
00199A 199A D1              10      POP DE
00199B 199B 3867            12      JR  C,SOPENE
00199D 199D 282C            12      JR  Z,NOTSE
       199F                     SOPEN3:
00199F 199F 3A1B1F          13      LD  A,(_DIRF)
0019A2 19A2 B7               4      OR  A
0019A3 19A3 2021            12      JR  NZ,SOPEN5
                                ;
0019A5 19A5 3A2A1B          13      LD  A,(DBLPAT)  ;A=$29 or 0
0019A8 19A8 E601             7      AND 1
0019AA 19AA 4F               4      LD  C,A
0019AB 19AB 3C               4      INC A
0019AC 19AC 83               4      ADD A,E
0019AD 19AD 5F               4      LD  E,A
0019AE 19AE D60C             7  RTEPAT: SUB 12      ;自己書き換え
0019B0 19B0 CB41             8      BIT 0,C
0019B2 19B2 2815            12      JR  Z,SOPEN6
0019B4 19B4 3C               4      INC A
0019B5 19B5 2012            12      JR  NZ,SOPEN6
0019B7 19B7 1B               6      DEC DE
0019B8 19B8 CDFB19          17      CALL    DC
0019BB 19BB 3812            12      JR  C,RDDERR
0019BD 19BD 0E10             7      LD  C,16
0019BF 19BF 2A1E1F          16      LD  HL,(_DIRBF)
0019C2 19C2 24               4      INC H
0019C3 19C3 24               4      INC H
0019C4 19C4 18D0            12      JR  SOPEN2
       19C6                     SOPEN5:
0019C6 19C6 CD051C          17      CALL    ENDSDI
       19C9                     SOPEN6:
0019C9 19C9 38C1            12      JR  C,SOPEN1
                                ;
       19CB                     NOTSE:
0019CB 19CB F608             7      OR  8       ;ZF=0
0019CD 19CD 1801            12      JR  EMTOF2      ;CF=1 ZF=0
                                ;
       19CF                     RDDERR:
0019CF 19CF BF               4      CP  A       ;READ ERR CF=1 ZF=1
       19D0                     EMTOF2:
0019D0 19D0 C33916          10      JP  EMTOFF
                                ;
       19D3                     NOPEN:
0019D3 19D3 CDB820          17      CALL    _RDFAT
0019D6 19D6 38F7            12      JR  C,RDDERR
0019D8 19D8 ED5B141F        20      LD  DE,(_FBPS)
0019DC 19DC CDFB19          17      CALL    DC
0019DF 19DF 38EE            12      JR  C,RDDERR
                                ;
       19E1                     NOPENX:
0019E1 19E1 2A321F          16      LD  HL,(_FSEA)
0019E4 19E4 229819          16      LD  (OPENPAT+1),HL
                                ;
0019E7 19E7 ED5B141F        20      LD  DE,(_FBPS)
0019EB 19EB 3A181F          13      LD  A,(_FBCNT)
0019EE 19EE 3D               4      DEC A
0019EF 19EF 28AE            12      JR  Z,SOPEN3
       19F1                     NOPEN2:
0019F1 19F1 2A161F          16      LD  HL,(_FBAD)
0019F4 19F4 012000          10      LD  BC,$20
0019F7 19F7 09              11      ADD HL,BC
0019F8 19F8 4F               4      LD  C,A
0019F9 19F9 189B            12      JR  SOPEN2
                                ;
       19FB                     DC:
0019FB 19FB D5              11      PUSH    DE
0019FC 19FC CD1F1B          17      CALL    DCPAT
0019FF 19FF CD4020          17      CALL    _DRDC
001A02 1A02 D1              10      POP DE
001A03 1A03 C9              10      RET
                                ;
       1A04                     SOPENE:
001A04 1A04 22161F          16      LD  (_FBAD),HL
001A07 1A07 79               4      LD  A,C
001A08 1A08 32181F          13      LD  (_FBCNT),A
001A0B 1A0B ED53141F        20      LD  (_FBPS),DE
001A0F 1A0F 211A1F          10      LD  HL,_FILEN
001A12 1A12 34              11      INC (HL)
001A13 1A13 2A161F          16      LD  HL,(_FBAD)
001A16 1A16 C36F16          10      JP  MOTOF3      ;OK CF=0
                                ;
       1A19                     FILESE:
001A19 1A19 7E               7      LD  A,(HL)
001A1A 1A1A B7               4      OR  A
001A1B 1A1B C8              11      RET Z       ;END:ZF=1 CF=0
001A1C 1A1C FEE5             7      CP  $E5
001A1E 1A1E 280C            12      JR  Z,FILESE1
001A20 1A20 118114          10      LD  DE,FNAME
001A23 1A23 060B             7      LD  B,11
001A25 1A25 E5              11      PUSH    HL
001A26 1A26 CD471A          17      CALL    CPSTR
001A29 1A29 E1              10      POP HL
001A2A 1A2A 37               4      SCF
001A2B 1A2B C8              11      RET Z       ;!!!:(ZF=1) CF=1
       1A2C                     FILESE1:
001A2C 1A2C 112000          10      LD  DE,$20
001A2F 1A2F 19              11      ADD HL,DE
001A30 1A30 0D               4      DEC C
001A31 1A31 20E6            12      JR  NZ,FILESE
       1A33                     ZFCF0:
001A33 1A33 F6FF             7      OR  $FF     ;ZF=0 CF=0
001A35 1A35 C9              10      RET
                                ;
       1A36                     NEXTSE:
001A36 1A36 7E               7      LD  A,(HL)
001A37 1A37 B7               4      OR  A
001A38 1A38 37               4      SCF
001A39 1A39 C8              11      RET Z       ;!!!:ZF=1 CF=1
001A3A 1A3A FEE5             7      CP  $E5
001A3C 1A3C 37               4      SCF
001A3D 1A3D C8              11      RET Z       ;!!!:(ZF=1) CF=1
001A3E 1A3E 112000          10      LD  DE,$20
001A41 1A41 19              11      ADD HL,DE
001A42 1A42 0D               4      DEC C
001A43 1A43 20F1            12      JR  NZ,NEXTSE
001A45 1A45 18EC            12      JR  ZFCF0
                                ;
       1A47                     CPSTR:
001A47 1A47 1A               7      LD  A,(DE)
001A48 1A48 FE3F             7      CP  "?"     ;ワイルドカード
001A4A 1A4A 280D            12      JR  Z,CPSTR2
001A4C 1A4C 7E               7      LD  A,(HL)
001A4D 1A4D CDDE1B          17      CALL    CAP2
001A50 1A50 E5              11      PUSH    HL
001A51 1A51 67               4      LD  H,A
001A52 1A52 1A               7      LD  A,(DE)
001A53 1A53 CDDE1B          17      CALL    CAP2
001A56 1A56 BC               4      CP  H       ;CP (HL),(DE)
001A57 1A57 E1              10      POP HL
001A58 1A58 C0              11      RET NZ
       1A59                     CPSTR2:
001A59 1A59 13               6      INC DE
001A5A 1A5A 23               6      INC HL
001A5B 1A5B 10EA            13      DJNZ    CPSTR
001A5D 1A5D C9              10      RET
                                ;
       1A5E                     NAME:
001A5E 1A5E CDDC20          17      CALL    _SPSK
001A61 1A61 D5              11      PUSH    DE
001A62 1A62 CD0920          17      CALL    _ROPEN
001A65 1A65 D1              10      POP DE
001A66 1A66 D47C20          17      CALL    NC,_FILED
001A69 1A69 D4791A          17      CALL    NC,CHKWT
001A6C 1A6C D8              11      RET C
001A6D 1A6D CDCA15          17      CALL    WRTA0
001A70 1A70 010B00          10      LD  BC,11
001A73 1A73 CD921A          17      CALL    WTDX2
       1A76                     MOTOF5:
001A76 1A76 C34C20          10      JP  _MOTOFF
                                ;
       1A79                     CHKWT:
001A79 1A79 3A8114          13      LD  A,(FNAME)
001A7C 1A7C C6E0             7      ADD A,-$20
001A7E 1A7E C8              11      RET Z
001A7F 1A7F 3A191F          13      LD  A,(_WILD)   ;(_WILD)<>0 THEN CF=1
001A82 1A82 B7               4      OR  A
001A83 1A83 C8              11      RET Z
001A84 1A84 37               4      SCF
001A85 1A85 C9              10      RET
                                ;
       1A86                     WCLOSE:
001A86 1A86 CDAF20          17      CALL    _RCLOSE
001A89 1A89 D8              11      RET C
       1A8A                     WCLOSE2:
001A8A 1A8A CDBB20          17      CALL    _WTFAT
001A8D 1A8D 18E7            12      JR  MOTOF5
                                ;
       1A8F                     WTDIRX:
001A8F 1A8F 012000          10      LD  BC,$20
       1A92                     WTDX2:
001A92 1A92 218114          10      LD  HL,FNAME
001A95 1A95 ED5B161F        20      LD  DE,(_FBAD)
001A99 1A99 EDB0                    LDIR
                                ;
       1A9B                     WTDIR:
001A9B 1A9B ED5B141F        20      LD  DE,(_FBPS)
001A9F 1A9F CD1F1B          17      CALL    DCPAT
001AA2 1AA2 C34320          10      JP  _DWTC
                                ;
       1AA5                     KILL:
001AA5 1AA5 CDA320          17      CALL    _SOPEN
       1AA8                     KILLW1:
001AA8 1AA8 DAB220          10      JP  C,_WCLOSE
                                ;
001AAB 1AAB CD8B20          17      CALL    _CHKATT
001AAE 1AAE 380E            12      JR  C,KILLW2
001AB0 1AB0 CDF31B          17      CALL    NFPRT
001AB3 1AB3 38F3            12      JR  C,KILLW1
001AB5 1AB5 CD9120          17      CALL    _KILLSX
001AB8 1AB8 CDBE20          17      CALL    _WTDIR
001ABB 1ABB DA8A1A          10      JP  C,WCLOSE2
                                ;
       1ABE                     KILLW2:
001ABE 1ABE 3A191F          13      LD  A,(_WILD)
001AC1 1AC1 D601             7      SUB $01
001AC3 1AC3 38E3            12      JR  C,KILLW1
001AC5 1AC5 CDAC20          17      CALL    _NOPENX
001AC8 1AC8 18DE            12      JR  KILLW1
                                ;
       1ACA                     KILLS:
001ACA 1ACA CD8B20          17      CALL    _CHKATT
001ACD 1ACD D8              11      RET C
                                ;
       1ACE                     KILLSX:
001ACE 1ACE 36E5            10      LD  (HL),$E5    ;DIR
001AD0 1AD0 111A00          10      LD  DE,$1A
001AD3 1AD3 19              11      ADD HL,DE
001AD4 1AD4 5E               7      LD  E,(HL)
001AD5 1AD5 23               6      INC HL
001AD6 1AD6 56               7      LD  D,(HL)
001AD7 1AD7 1804            12      JR  KILLS2
       1AD9                     KILLS1:
001AD9 1AD9 ED5B0C1F        20      LD  DE,(_CLPS)  ;FAT
       1ADD                     KILLS2:
001ADD 1ADD CDC420          17      CALL    _ENDCL
001AE0 1AE0 D0              11      RET NC      ;CF=0
001AE1 1AE1 21FEFF          10      LD  HL,-2
001AE4 1AE4 19              11      ADD HL,DE
001AE5 1AE5 D0              11      RET NC      ;DE= 0 or 1
001AE6 1AE6 D5              11      PUSH    DE
001AE7 1AE7 CD4620          17      CALL    _GNCL
001AEA 1AEA ED530C1F        20      LD  (_CLPS),DE
001AEE 1AEE D1              10      POP DE
001AEF 1AEF 210000          10      LD  HL,0
001AF2 1AF2 D44920          17      CALL    NC,_SNCL
001AF5 1AF5 30E2            12      JR  NC,KILLS1
001AF7 1AF7 C9              10      RET
                                ;
       1AF8                     RDVSW:
001AF8 1AF8 3A7D1F          13      LD  A,(_DVSW)
001AFB 1AFB C9              10      RET
                                ;
       1AFC                     FATS:
001AFC 1AFC ED5B5E1F        20      LD  DE,(_FATPS)
001B00 1B00 2A621F          16      LD  HL,(_FATBF)
001B03 1B03 FD4600          19      LD  B,(IY+DPB_FATLN)
001B06 1B06 C9              10      RET
                                ;
       1B07                     WTFAT:
001B07 1B07 FDE5            15      PUSH    IY
001B09 1B09 CD0F1B          17      CALL    WTFAT0
001B0C 1B0C FDE1            14      POP IY
001B0E 1B0E C9              10      RET
                                ;
       1B0F                     WTFAT0:
001B0F 1B0F CD8520          17      CALL    _DEVADR     ;WRITE FAT
001B12 1B12 D8              11      RET C
001B13 1B13 CDFC1A          17      CALL    FATS
       1B16                     WTFAT1:
001B16 1B16 C5              11      PUSH    BC
001B17 1B17 CD4320          17      CALL    _DWTC
001B1A 1B1A C1              10      POP BC
001B1B 1B1B D8              11      RET C
001B1C 1B1C 10F8            13      DJNZ    WTFAT1
001B1E 1B1E C9              10      RET
                                ;
       1B1F                     DCPAT:
001B1F 1B1F 2A1E1F          16      LD  HL,(_DIRBF)
001B22 1B22 3A1B1F          13      LD  A,(_DIRF)
001B25 1B25 B7               4      OR  A
001B26 1B26 C8              11      RET Z
                                ;
       1B27                     CLUST:
001B27 1B27 EB               4      EX  DE,HL
001B28 1B28 3E08             7  CLSPAT: LD  A,8 ;DE=DE+8 (2D)  DPB_ADDCL 書き換え
001B2A 1B2A 29              11  DBLPAT: ADD HL,HL   ;DE=DE*2 (512) DPB_DBLCL 書き換え
001B2B 1B2B EB               4      EX  DE,HL
001B2C 1B2C 83               4      ADD A,E
001B2D 1B2D 5F               4      LD  E,A
001B2E 1B2E 8A               4      ADC A,D
001B2F 1B2F 93               4      SUB E
001B30 1B30 57               4      LD  D,A
001B31 1B31 C9              10      RET
                                ;
       1B32                     FGETC:
001B32 1B32 E5              11      PUSH    HL      ;CF=0 Ok!
001B33 1B33 2A0E1F          16      LD  HL,(_GCAD)  ;CF=1 Z=1 ERROR
001B36 1B36 3A121F          13      LD  A,(_GCEH)   ;CF=1 Z=0 EOF
001B39 1B39 BC               4      CP  H
001B3A 1B3A 3819            12      JR  C,GETC2
                                ;
       1B3C                     GETC1:
001B3C 1B3C E5              11      PUSH    HL
001B3D 1B3D 2A101F          16      LD  HL,(_GCLN)
001B40 1B40 7C               4      LD  A,H
001B41 1B41 B5               4      OR  L
001B42 1B42 280C            12      JR  Z,GETCE2
001B44 1B44 2B               6      DEC HL
001B45 1B45 22101F          16      LD  (_GCLN),HL
001B48 1B48 E1              10      POP HL
001B49 1B49 7E               7      LD  A,(HL)
001B4A 1B4A 23               6      INC HL
001B4B 1B4B 220E1F          16      LD  (_GCAD),HL
001B4E 1B4E E1              10      POP HL
001B4F 1B4F C9              10      RET
                                ;
       1B50                     GETCE2:
001B50 1B50 E1              10      POP HL
001B51 1B51 E1              10      POP HL
001B52 1B52 D601             7      SUB $01     ;CF=1 ZF=0 A=$FF
001B54 1B54 C9              10      RET
                                ;
       1B55                     GETC2:
001B55 1B55 D5              11      PUSH    DE
001B56 1B56 C5              11      PUSH    BC
001B57 1B57 ED5B0C1F        20      LD  DE,(_CLPS)
001B5B 1B5B CDC420          17      CALL    _ENDCL
001B5E 1B5E 3020            12      JR  NC,GETC3
001B60 1B60 3A131F          13      LD  A,(_CLLN)
001B63 1B63 47               4      LD  B,A
001B64 1B64 2A451F          16      LD  HL,(_GCBUF)
001B67 1B67 C5              11      PUSH    BC
001B68 1B68 CD9716          17      CALL    RDD1
001B6B 1B6B D1              10      POP DE
001B6C 1B6C 3819            12      JR  C,GETCER
001B6E 1B6E 2A721F          16      LD  HL,(_SIZE)
001B71 1B71 2B               6      DEC HL
001B72 1B72 7C               4      LD  A,H
001B73 1B73 E603             7      AND 3
001B75 1B75 67               4      LD  H,A
001B76 1B76 23               6      INC HL
001B77 1B77 7A               4      LD  A,D
001B78 1B78 90               4      SUB B
001B79 1B79 87               4      ADD A,A
001B7A 1B7A 87               4      ADD A,A
001B7B 1B7B 84               4      ADD A,H
001B7C 1B7C 67               4      LD  H,A
001B7D 1B7D 22101F          16      LD  (_GCLN),HL
       1B80                     GETC3:
001B80 1B80 C1              10      POP BC
001B81 1B81 D1              10      POP DE
001B82 1B82 2A451F          16      LD  HL,(_GCBUF)
001B85 1B85 18B5            12      JR  GETC1
                                ;
       1B87                     GETCER:
001B87 1B87 C1              10      POP BC
001B88 1B88 D1              10      POP DE
001B89 1B89 E1              10      POP HL
       1B8A                     EBELL:
001B8A 1B8A AF               4      XOR A       ;CF=1 ZF=1
001B8B 1B8B 37               4      SCF
001B8C 1B8C C9              10      RET
                                ;
       1B8D                     GNCL:
001B8D 1B8D 6B               4      LD  L,E     ;GET NEXT CLUSTER
001B8E 1B8E 62               4      LD  H,D
001B8F 1B8F CB3C             8      SRL H
001B91 1B91 CB1D             8      RR  L
001B93 1B93 ED4B621F        20      LD  BC,(_FATBF)
001B97 1B97 3809            12      JR  C,GNC1
001B99 1B99 19              11      ADD HL,DE
001B9A 1B9A 09              11      ADD HL,BC
001B9B 1B9B 5E               7      LD  E,(HL)
001B9C 1B9C 23               6      INC HL
001B9D 1B9D 7E               7      LD  A,(HL)
001B9E 1B9E E60F             7      AND $0F
001BA0 1BA0 57               4      LD  D,A
001BA1 1BA1 C9              10      RET
       1BA2                     GNC1:
001BA2 1BA2 19              11      ADD HL,DE
001BA3 1BA3 09              11      ADD HL,BC
001BA4 1BA4 7E               7      LD  A,(HL)
001BA5 1BA5 23               6      INC HL
001BA6 1BA6 56               7      LD  D,(HL)
001BA7 1BA7 0604             7      LD  B,4
       1BA9                     GNC1L:
001BA9 1BA9 CB3A             8      SRL D
001BAB 1BAB 1F               4      RRA
001BAC 1BAC 10FB            13      DJNZ    GNC1L
                                ;
001BAE 1BAE 5F               4      LD  E,A
001BAF 1BAF A7               4      AND A
001BB0 1BB0 C9              10      RET
                                ;
       1BB1                     SNCL:
001BB1 1BB1 E5              11      PUSH    HL
001BB2 1BB2 6B               4      LD  L,E     ;SET NEXT CLUSTER
001BB3 1BB3 62               4      LD  H,D
001BB4 1BB4 CB3C             8      SRL H
001BB6 1BB6 CB1D             8      RR  L
001BB8 1BB8 ED4B621F        20      LD  BC,(_FATBF)
001BBC 1BBC 380F            12      JR  C,SNC1
001BBE 1BBE 19              11      ADD HL,DE
001BBF 1BBF 09              11      ADD HL,BC
001BC0 1BC0 D1              10      POP DE
001BC1 1BC1 73               7      LD  (HL),E
001BC2 1BC2 23               6      INC HL
001BC3 1BC3 7A               4      LD  A,D
001BC4 1BC4 E60F             7      AND $0F
001BC6 1BC6 57               4      LD  D,A
001BC7 1BC7 7E               7      LD  A,(HL)
001BC8 1BC8 E6F0             7      AND $F0
001BCA 1BCA B2               4      OR  D
001BCB 1BCB 77               7      LD  (HL),A
001BCC 1BCC C9              10      RET
       1BCD                     SNC1:
001BCD 1BCD 19              11      ADD HL,DE
001BCE 1BCE 09              11      ADD HL,BC
001BCF 1BCF D1              10      POP DE
001BD0 1BD0 EB               4      EX  DE,HL
001BD1 1BD1 29              11      ADD HL,HL
001BD2 1BD2 29              11      ADD HL,HL
001BD3 1BD3 29              11      ADD HL,HL
001BD4 1BD4 29              11      ADD HL,HL
001BD5 1BD5 EB               4      EX  DE,HL
001BD6 1BD6 7E               7      LD  A,(HL)
001BD7 1BD7 E60F             7      AND $0F
001BD9 1BD9 B3               4      OR  E
001BDA 1BDA 77               7      LD  (HL),A
001BDB 1BDB 23               6      INC HL
001BDC 1BDC 72               7      LD  (HL),D
001BDD 1BDD C9              10      RET
                                ;
       1BDE                     CAP2:
001BDE 1BDE CDEB20          17      CALL    _CAP
       1BE1                     CAP3:
001BE1 1BE1 CDE414          17      CALL    CAP4
001BE4 1BE4 FE21             7      CP  $21
001BE6 1BE6 D0              11      RET NC
001BE7 1BE7 3EA0             7      LD  A,$A0
001BE9 1BE9 C9              10      RET
                                ;
       1BEA                     FPRINT:
001BEA 1BEA 218114          10      LD  HL,FNAME
001BED 1BED C3B520          10      JP  _NFPRT
                                ;
       1BF0                     FPRNTW:
001BF0 1BF0 218114          10      LD  HL,FNAME
       1BF3                     NFPRT:
001BF3 1BF3 CDDE18          17      CALL    NFPRTX
001BF6 1BF6 D8              11      RET C
001BF7 1BF7 3A191F          13      LD  A,(_WILD)
001BFA 1BFA B7               4      OR  A
001BFB 1BFB C8              11      RET Z
001BFC 1BFC E5              11      PUSH    HL
001BFD 1BFD CDB520          17      CALL    _NFPRT
001C00 1C00 E1              10      POP HL
001C01 1C01 AF               4      XOR A
001C02 1C02 C3EE1F          10      JP  _LTNL
                                ;
       1C05                     ENDSDI:
001C05 1C05 CD4620          17      CALL    _GNCL   ;END DIR
                                ;
       1C08                     ENDCL:
001C08 1C08 7A               4      LD  A,D ;END CLUSTER
001C09 1C09 FE01             7  CLPAT1: CP  1   ;164=356    書き換え
001C0B 1C0B C0              11      RET NZ
001C0C 1C0C 7B               4      LD  A,E
001C0D 1C0D FE64             7  CLPAT2: CP  $64 ;       書き換え
001C0F 1C0F C9              10      RET
                                ;
       1C10                     DEVADR:
001C10 1C10 3A5D1F          13      LD  A,(_DSK)
       1C13                     DEVADX:
001C13 1C13 3D               4      DEC A
001C14 1C14 E61F             7      AND $1F
001C16 1C16 FE08             7      CP  MAXDRV
001C18 1C18 3F               4      CCF
001C19 1C19 D8              11      RET C
001C1A 1C1A 87               4      ADD A,A ;*2
001C1B 1C1B 87               4      ADD A,A ;*4
001C1C 1C1C 87               4      ADD A,A ;*8
001C1D 1C1D 87               4      ADD A,A ;*16
001C1E 1C1E 87               4      ADD A,A ;*32
001C1F 1C1F FD6F             9      LD  IYL,A
001C21 1C21 FD2623          10      LD  IYH,DEVICE/256
001C24 1C24 FD7E00          19      LD  A,(IY+0)
001C27 1C27 FE01             7      CP  $01     ;A=0 THEN CF=1
001C29 1C29 C9              10      RET
                                ;
       1C2A                     CCHK2:
001C2A 1C2A FE5C             7      CP  $5C
001C2C 1C2C C8              11      RET Z
                                ;
       1C2D                     CCHK3:
001C2D 1C2D FE20             7      CP  $20
001C2F 1C2F 3004            12      JR  NC,CCHK
                                ;
001C31 1C31 BF               4      CP  A       ;Z=1
001C32 1C32 C9              10      RET
                                ;
       1C33                     CCHECK:
001C33 1C33 1A               7      LD  A,(DE)
001C34 1C34 13               6      INC DE
                                ;
       1C35                     CCHK:
001C35 1C35 FE3A             7      CP  ":"
001C37 1C37 C8              11      RET Z
001C38 1C38 FE20             7      CP  $20
001C3A 1C3A C9              10      RET
                                ;
001C3B 1C3B 2A2E2A              DIRW:   DB  "*.*"
                                ;
001C3E 1C3E 01FD                M2D:    DB  1,$FD
001C40 1C40 7320762008296401        DW  _DRDW,_DWTW,$2908,356
001C48 1C48 FF0C280901020501        DB  $FF,12,40,9,1,2,5,1
                                ;
001C50 1C50 02FE                M2HD:   DB  2,$FE
001C52 1C52 522055200900C704        DW  _DRD,_DWT,9,1223
001C5A 1C5A FE0B4D0801040501        DB  $FE,11,77,8,1,4,5,1
                                ;
[EOF:LOS.ASM:SHIFT_JIS]
                                    INCLUDE "X1IO.ASM"
                                ;
                                ;   L-os Angeles X1IO
                                ;
       1C62                     POKEAT_:
001C62 1C62 EB               4      EX  DE,HL
       1C63                     POKEAT_1:
001C63 1C63 1A               7      LD  A,(DE)
001C64 1C64 13               6      INC DE
001C65 1C65 CD9A1F          17      CALL    _POKE
001C68 1C68 23               6      INC HL
001C69 1C69 0B               6      DEC BC
001C6A 1C6A 78               4      LD  A,B
001C6B 1C6B B1               4      OR  C
001C6C 1C6C 20F5            12      JR  NZ,POKEAT_1
001C6E 1C6E C9              10      RET
                                ;
       1C6F                     PEEKAT_:
001C6F 1C6F EB               4      EX  DE,HL
       1C70                     PEEKAT_1:
001C70 1C70 CD941F          17      CALL    _PEEK
001C73 1C73 23               6      INC HL
001C74 1C74 12               7      LD  (DE),A
001C75 1C75 13               6      INC DE
001C76 1C76 0B               6      DEC BC
001C77 1C77 78               4      LD  A,B
001C78 1C78 B1               4      OR  C
001C79 1C79 20F5            12      JR  NZ,PEEKAT_1
001C7B 1C7B C9              10      RET
                                ;
       1C7C                     RDFAT:
001C7C 1C7C FDE5            15      PUSH    IY
001C7E 1C7E CD271E          17      CALL    RDFAT0
001C81 1C81 FDE1            14      POP IY
001C83 1C83 C9              10      RET
                                ;
       1C84                     TAB:
001C84 1C84 3A0E00          13      LD  A,(AT_XYADR)
001C87 1C87 90               4      SUB B
001C88 1C88 3F               4      CCF
001C89 1C89 D8              11      RET C
                                ;
       1C8A                     TAB1:
001C8A 1C8A CDF11F          17      CALL    _PRNTS
001C8D 1C8D 3C               4      INC A
001C8E 1C8E 20FA            12      JR  NZ,TAB1
001C90 1C90 C9              10      RET
                                ;
       1C91                     CHGDRV:
001C91 1C91 E5              11      PUSH    HL
001C92 1C92 FDE5            15      PUSH    IY
001C94 1C94 CD9E1C          17      CALL    CHGDRV0
001C97 1C97 3A5D1F          13      LD  A,(_DSK)
001C9A 1C9A FDE1            14      POP IY
001C9C 1C9C E1              10      POP HL
001C9D 1C9D C9              10      RET
                                ;
       1C9E                     CHGDRV0:
001C9E 1C9E FE40             7      CP  $40
001CA0 1CA0 D8              11      RET C
001CA1 1CA1 CC2420          17      CALL    Z,_RDVSW
                                ;
001CA4 1CA4 6F               4      LD  L,A
001CA5 1CA5 CD8820          17      CALL    _DEVADX
001CA8 1CA8 D8              11      RET C
                                ;
001CA9 1CA9 CD4C20          17      CALL    _MOTOFF
001CAC 1CAC 7D               4      LD  A,L
001CAD 1CAD CDEB20          17      CALL    _CAP
001CB0 1CB0 325D1F          13      LD  (_DSK),A
                                ;
001CB3 1CB3 F3               4      DI
001CB4 1CB4 ED730A1D        20      LD  (SPPAT2+1),SP
                                ;
001CB8 1CB8 FDF9            10      LD  SP,IY
                                ;
001CBA 1CBA E1              10      POP HL
001CBB 1CBB E1              10      POP HL
001CBC 1CBC 224120          16      LD  (_DRDC+1),HL
                                ;
001CBF 1CBF E1              10      POP HL
001CC0 1CC0 224420          16      LD  (_DWTC+1),HL
                                ;
001CC3 1CC3 E1              10      POP HL
001CC4 1CC4 22291B          16      LD  (CLSPAT+1),HL   ;ADDCL
                                ;
001CC7 1CC7 E1              10      POP HL      ;MAXCL
001CC8 1CC8 7D               4      LD  A,L
001CC9 1CC9 320E1C          13      LD  (CLPAT2+1),A
001CCC 1CCC 7C               4      LD  A,H
001CCD 1CCD 320A1C          13      LD  (CLPAT1+1),A
                                ;
001CD0 1CD0 E1              10      POP HL      ;H=MAXDIR L=FDMODE
001CD1 1CD1 7D               4      LD  A,L
001CD2 1CD2 F6FE             7      OR  $FE
001CD4 1CD4 32E31D          13      LD  (FDMODE+1),A
001CD7 1CD7 07               4      RLCA
001CD8 1CD8 32CA1D          13      LD  (FSPAT+1),A
001CDB 1CDB 7C               4      LD  A,H
001CDC 1CDC 32AF19          13      LD  (RTEPAT+1),A
                                ;
001CDF 1CDF E1              10      POP HL
001CE0 1CE0 7D               4      LD  A,L
001CE1 1CE1 32661F          13      LD  (_MXTRK),A
001CE4 1CE4 7C               4      LD  A,H
001CE5 1CE5 32081F          13      LD  (_MSEC),A
                                ;
001CE8 1CE8 E1              10      POP HL
001CE9 1CE9 2600             7      LD  H,0
001CEB 1CEB 225E1F          16      LD  (_FATPS),HL
                                ;
001CEE 1CEE E1              10      POP HL
001CEF 1CEF 7C               4      LD  A,H
001CF0 1CF0 32791D          13      LD  (SECPAT+1),A
001CF3 1CF3 AF               4      XOR A       ;CF=0 ノ タメ
001CF4 1CF4 67               4      LD  H,A
001CF5 1CF5 22601F          16      LD  (_DIRPS),HL
                                ;
001CF8 1CF8 E1              10      POP HL
001CF9 1CF9 7C               4      LD  A,H
001CFA 1CFA 32041F          13      LD  (_DRIVE),A
                                ;
001CFD 1CFD E1              10      POP HL
001CFE 1CFE 224D20          16      LD  (_MOTOFF+1),HL
                                ;
001D01 1D01 E1              10      POP HL
001D02 1D02 224720          16      LD  (_GNCL+1),HL
                                ;
001D05 1D05 E1              10      POP HL
001D06 1D06 224A20          16      LD  (_SNCL+1),HL
                                ;
001D09 1D09 310000          10  SPPAT2: LD  SP,0
001D0C 1D0C FB               4      EI
001D0D 1D0D C9              10      RET
                                ;
       1D0E                     XCSR:
001D0E 1D0E 2A0E00          16      LD  HL,(AT_XYADR)
001D11 1D11 C9              10      RET
                                ;
       1D12                     NL:
001D12 1D12 F5              11      PUSH    AF
001D13 1D13 CDA304          17      CALL    AT_NL
001D16 1D16 F1              10      POP AF
001D17 1D17 C9              10      RET
                                ;
       1D18                     COLOR:
001D18 1D18 322600          13      LD  (AT_COLORF),A
001D1B 1D1B C9              10      RET
                                ;
       1D1C                     WIDCH:
001D1C 1D1C CD4D00          17      CALL    AT_WIDCH
001D1F 1D1F 3A0700          13      LD  A,(AT_WIDTH)
001D22 1D22 325C1F          13      LD  (_WIDTH),A
001D25 1D25 C9              10      RET
                                ;
       1D26                     KYBFC:
001D26 1D26 E5              11      PUSH    HL
001D27 1D27 210000          10      LD  HL,0
001D2A 1D2A 22A60E          16      LD  ($0EA6),HL
001D2D 1D2D E1              10      POP HL
001D2E 1D2E C9              10      RET
                                ;
       1D2F                     KYBFS:
001D2F 1D2F C5              11      PUSH    BC
001D30 1D30 D5              11      PUSH    DE
001D31 1D31 E5              11      PUSH    HL
001D32 1D32 01A80E          10      LD  BC,$0EA8
001D35 1D35 5F               4      LD  E,A
001D36 1D36 CDE303          17      CALL    AT_KYBFS
001D39 1D39 AF               4      XOR A
001D3A 1D3A 32A50E          13      LD  ($0EA5),A
001D3D 1D3D E1              10      POP HL
001D3E 1D3E D1              10      POP DE
001D3F 1D3F C1              10      POP BC
001D40 1D40 C9              10      RET
                                ;
       1D41                     POKE:
001D41 1D41 C5              11      PUSH    BC
001D42 1D42 F5              11      PUSH    AF
001D43 1D43 4D               4      LD  C,L
001D44 1D44 7C               4      LD  A,H
001D45 1D45 C640             7      ADD A,$40
001D47 1D47 47               4      LD  B,A
001D48 1D48 F1              10      POP AF
001D49 1D49 ED79            12      OUT (C),A
001D4B 1D4B C1              10      POP BC
001D4C 1D4C C9              10      RET
                                ;
       1D4D                     PEEK:
001D4D 1D4D C5              11      PUSH    BC
001D4E 1D4E 4D               4      LD  C,L
001D4F 1D4F 7C               4      LD  A,H
001D50 1D50 C640             7      ADD A,$40
001D52 1D52 47               4      LD  B,A
001D53 1D53 ED78            12      IN  A,(C)
001D55 1D55 C1              10      POP BC
001D56 1D56 C9              10      RET
                                ;
       1D57                     CINIT:
001D57 1D57 3A051F          13      LD  A,(_WK1FD0)
001D5A 1D5A CBA7             8      RES 4,A
                                ;
       1D5C                     S1FD0:
001D5C 1D5C C5              11      PUSH    BC
001D5D 1D5D 01D01F          10      LD  BC,$1FD0
001D60 1D60 ED79            12      OUT (C),A
001D62 1D62 32051F          13      LD  (_WK1FD0),A
001D65 1D65 C1              10      POP BC
001D66 1D66 C9              10      RET
                                ;
       1D67                     SEEK:
001D67 1D67 0610             7      LD  B,16
001D69 1D69 3A081F          13      LD  A,(_MSEC)
001D6C 1D6C 4F               4      LD  C,A
001D6D 1D6D AF               4      XOR A
001D6E 1D6E EB               4      EX  DE,HL
       1D6F                     DIV1:
001D6F 1D6F 29              11      ADD HL,HL
001D70 1D70 8F               4      ADC A,A
001D71 1D71 B9               4      CP  C
001D72 1D72 3802            12      JR  C,DIV2
001D74 1D74 91               4      SUB C
001D75 1D75 2C               4      INC L
       1D76                     DIV2:
001D76 1D76 10F7            13      DJNZ    DIV1
                                ;
001D78 1D78 C601             7  SECPAT: ADD A,$01       ;書き換え
001D7A 1D7A 55               4      LD  D,L ;商(TRACK)
       1D7B                     DIV3:
001D7B 1D7B 5F               4      LD  E,A ;余り
001D7C 1D7C CB3A             8      SRL D   ;CYLINDER
001D7E 1D7E 9F               4      SBC A,A
001D7F 1D7F E610             7      AND $10 ;SIDE
001D81 1D81 4F               4      LD  C,A
                                ;
001D82 1D82 3A041F          13      LD  A,(_DRIVE)
001D85 1D85 FE04             7      CP  4
001D87 1D87 3F               4      CCF
001D88 1D88 D8              11      RET C
001D89 1D89 B1               4      OR  C
001D8A 1D8A 321C1E          13      LD  (MOPAT+1),A ;モーターオフデータ
001D8D 1D8D 01FC0F          10      LD  BC,$0FFC
001D90 1D90 F680             7      OR  $80     ;モーターオン
001D92 1D92 ED79            12      OUT (C),A
                                ;
001D94 1D94 CDE11D          17      CALL    SETMODE
001D97 1D97 D8              11      RET C
                                ;
001D98 1D98 2A041F          16      LD  HL,(_DRIVE)
001D9B 1D9B 261F             7      LD  H,$1F
001D9D 1D9D 7E               7      LD  A,(HL)      ;LD A,$1F00+DRIVE NUMBER
001D9E 1D9E 3C               4      INC A       ;A=$FF シリンダフメイ
001D9F 1D9F CC031E          17      CALL    Z,FDCRES    ;リストア
001DA2 1DA2 7E               7      LD  A,(HL)
001DA3 1DA3 0EF9             7      LD  C,$F9
001DA5 1DA5 ED79            12      OUT (C),A       ;現在のシリンダ
001DA7 1DA7 92               4      SUB D
001DA8 1DA8 C8              11      RET Z       ;シーク無し
                                ;
001DA9 1DA9 3A091F          13      LD  A,(_ISEC)
001DAC 1DAC 4F               4      LD  C,A
                                ;
001DAD 1DAD 3A661F          13      LD  A,(_MXTRK)  ;マックスシリンダ
001DB0 1DB0 3D               4      DEC A
001DB1 1DB1 BA               4      CP  D       ;オーバーシリンダ
001DB2 1DB2 D8              11      RET C
                                ;
001DB3 1DB3 B9               4      CP  C       ;内蔵 2DD の為の処理
001DB4 1DB4 3803            12      JR  C,SETM2
001DB6 1DB6 78               4      LD  A,B     ;B=$0F
001DB7 1DB7 DBFE            11      IN  A,($FE)     ;2HD mode for 2DD seek
       1DB9                     SETM2:
001DB9 1DB9 78               4      LD  A,B
001DBA 1DBA DBFD            11      IN  A,($FD)     ;MFM mode
                                ;
001DBC 1DBC CD101E          17      CALL    DELAY0      ;wait100マイクロSEC
                                ;
001DBF 1DBF 0EFB             7      LD  C,$FB
001DC1 1DC1 ED51            12      OUT (C),D
001DC3 1DC3 72               7      LD  (HL),D
001DC4 1DC4 0E18             7      LD  C,$18       ;シーク
       1DC6                     FDCCMD2:
001DC6 1DC6 3A481F          13      LD  A,(_SEEKSP)
001DC9 1DC9 E6FF             7  FSPAT:  AND $FF
001DCB 1DCB B1               4      OR  C
                                ;
       1DCC                     FDCCMD:
001DCC 1DCC CD0C1E          17      CALL    COMSET
                                ;
001DCF 1DCF 3AB11E          13  C_FDCPAT:LD A,(FDCPAT+1)
001DD2 1DD2 E620             7      AND $20     ;ライト・データ ライト・トラック
001DD4 1DD4 3C               4      INC A
                                ;
       1DD5                     SST:
001DD5 1DD5 0E00             7      LD  C,0
       1DD7                     SST1:
001DD7 1DD7 0D               4      DEC C       ; 4
001DD8 1DD8 20FD            12      JR  NZ,SST1     ;12 *256 /4 =約 1ms
001DDA 1DDA 3D               4      DEC A
001DDB 1DDB 20FA            12      JR  NZ,SST1
                                ;
001DDD 1DDD 3C               4      INC A
001DDE 1DDE CDEC1D          17      CALL    READY
       1DE1                     SETMODE:
001DE1 1DE1 78               4      LD  A,B     ;B=$0F
001DE2 1DE2 DBFF            11  FDMODE: IN  A,($FF)     ;フロッピーモード(2D/2HD)カキカエ
                                ;
001DE4 1DE4 78               4      LD  A,B
001DE5 1DE5 DBFD            11      IN  A,($FD)     ;MFM mode
                                ;
001DE7 1DE7 CD101E          17      CALL    DELAY0      ;ヘッドセレクトタイム
001DEA 1DEA 3E81             7      LD  A,$81
       1DEC                     READY:
001DEC 1DEC 32F61D          13      LD  (WAITA+1),A
001DEF 1DEF E5              11      PUSH    HL
001DF0 1DF0 0EF8             7      LD  C,$F8
001DF2 1DF2 61               4      LD  H,C
       1DF3                     READY2:
001DF3 1DF3 ED78            12      IN  A,(C)
001DF5 1DF5 E681             7  WAITA:  AND $81     ;NOT READY,BUSY
001DF7 1DF7 2808            12      JR  Z,READYE
001DF9 1DF9 E3              19      EX  (SP),HL     ;wait
001DFA 1DFA E3              19      EX  (SP),HL     ; //
001DFB 1DFB 2B               6      DEC HL
001DFC 1DFC 7C               4      LD  A,H
001DFD 1DFD B5               4      OR  L
001DFE 1DFE 20F3            12      JR  NZ,READY2
001E00 1E00 37               4      SCF
       1E01                     READYE:
001E01 1E01 E1              10      POP HL
001E02 1E02 C9              10      RET
                                ;
       1E03                     FDCRES:
001E03 1E03 77               7      LD  (HL),A      ;A=0
001E04 1E04 4F               4      LD  C,A
001E05 1E05 18BF            12      JR  FDCCMD2
                                ;
       1E07                     SECSET:
001E07 1E07 01FA0F          10      LD  BC,$0FFA
001E0A 1E0A ED59            12      OUT (C),E
       1E0C                     COMSET:
001E0C 1E0C 0EF8             7      LD  C,$F8
001E0E 1E0E ED79            12      OUT (C),A
       1E10                     DELAY0:
001E10 1E10 3E1A             7      LD  A,26
       1E12                     DELAY:
001E12 1E12 3D               4      DEC A
001E13 1E13 20FD            12      JR  NZ,DELAY
001E15 1E15 C9              10      RET
                                ;
       1E16                     FDMOFF:
001E16 1E16 F5              11      PUSH    AF
001E17 1E17 C5              11      PUSH    BC
001E18 1E18 01FC0F          10      LD  BC,$0FFC    ;モーターオフ
001E1B 1E1B 3E00             7  MOPAT:  LD  A,$00       ;カキカエ
001E1D 1E1D ED79            12      OUT (C),A
001E1F 1E1F C1              10      POP BC
001E20 1E20 F1              10      POP AF
001E21 1E21 C9              10      RET
                                ;
001E22 1E22 05                  RETRY:  DB  5
                                ;
[EOF:X1IO.ASM:SHIFT_JIS]
                                    INCLUDE "X1DMA.ASM"
                                ;
                                ;   L-os Angeles DMA
                                ;
                                ;   DISK I/O (DMA)
                                ;
       1E23                     DMA:
                                ;
       1E23                     VER:
001E23 1E23 218120          10      LD  HL,$2081
001E26 1E26 C9              10      RET
                                ;
       1E27                     RDFAT0:
001E27 1E27 CD361E          17      CALL    RDFATS
001E2A 1E2A D8              11      RET C
001E2B 1E2B 2A621F          16      LD  HL,(_FATBF)
001E2E 1E2E 7E               7      LD  A,(HL)
001E2F 1E2F FDBE01           7      CP  (IY+DPB_FATID)
001E32 1E32 C2CF19          10      JP  NZ,RDDERR
001E35 1E35 C9              10      RET
                                ;
       1E36                     RDFATS:
001E36 1E36 CD8520          17      CALL    _DEVADR
001E39 1E39 CD621E          17      CALL    RDFATS1
001E3C 1E3C D0              11      RET NC
001E3D 1E3D FEFF             7      CP  $FF
001E3F 1E3F 37               4      SCF
001E40 1E40 C8              11      RET Z
001E41 1E41 FD7E12          19      LD  A,(IY+DPB_DEVNO)
001E44 1E44 FE87             7      CP  $87
001E46 1E46 37               4      SCF
001E47 1E47 C0              11      RET NZ
001E48 1E48 FDCB0A46        20      BIT 0,(IY+DPB_FDMODE)
001E4C 1E4C 2A2E1F          16      LD  HL,(_M2D)
001E4F 1E4F 2803            12      JR  Z,CHG2D
001E51 1E51 2A301F          16      LD  HL,(_M2HD)
       1E54                     CHG2D:
001E54 1E54 FDE5            15      PUSH    IY
001E56 1E56 D1              10      POP DE
001E57 1E57 011200          10      LD  BC,18
001E5A 1E5A EDB0                    LDIR
001E5C 1E5C 3A5D1F          13      LD  A,(_DSK)
001E5F 1E5F CD6A20          17      CALL    _CHGDRV
       1E62                     RDFATS1:
001E62 1E62 CDFC1A          17      CALL    FATS
       1E65                     RDFATL:
001E65 1E65 C5              11      PUSH    BC
001E66 1E66 CD4020          17      CALL    _DRDC
001E69 1E69 C1              10      POP BC
001E6A 1E6A D8              11      RET C
001E6B 1E6B 10F8            13      DJNZ    RDFATL
001E6D 1E6D C9              10      RET
                                ;
       1E6E                     WTTRK:
001E6E 1E6E 3EF0             7      LD  A,$F0
001E70 1E70 1806            12      JR  WTTRK1
                                ;
       1E72                     DWTW:
001E72 1E72 CD761E          17      CALL    DWT ;FOR 512/sector
001E75 1E75 D8              11      RET C
                                ;
       1E76                     DWT:
001E76 1E76 3EA0             7      LD  A,$A0
       1E78                     WTTRK1:
001E78 1E78 32B11E          13      LD  (FDCPAT+1),A
001E7B 1E7B 3E10             7      LD  A,16
001E7D 1E7D F3               4      DI
001E7E 1E7E 180F            12      JR  DISK
                                ;
       1E80                     RDID:
001E80 1E80 3EC0             7      LD  A,$C0
001E82 1E82 1806            12      JR  RDID1
                                ;
       1E84                     DRDW:
001E84 1E84 CD881E          17      CALL    DRD ;FOR2D
001E87 1E87 D8              11      RET C
                                ;
       1E88                     DRD:
001E88 1E88 3E80             7      LD  A,$80
                                ;
       1E8A                     RDID1:
001E8A 1E8A 32B11E          13      LD  (FDCPAT+1),A
001E8D 1E8D 3E0E             7      LD  A,14
                                ;
       1E8F                     DISK:
001E8F 1E8F 32A11E          13      LD  (DMAPAT+1),A
                                ;
001E92 1E92 3E05             7      LD  A,5     ;リトライカウント
001E94 1E94 32221E          13      LD  (RETRY),A
                                ;
001E97 1E97 22561F          16      LD  (DMAD+11),HL
       1E9A                     DISK2:
001E9A 1E9A D5              11      PUSH    DE
001E9B 1E9B CD671D          17      CALL    SEEK
001E9E 1E9E 3842            12      JR  C,ERRF
                                ;
001EA0 1EA0 3E0E             7  DMAPAT: LD  A,14
001EA2 1EA2 214B1F          10      LD  HL,DMAD
001EA5 1EA5 01871F          10      LD  BC,$1F87
       1EA8                     SDMA:
001EA8 1EA8 04               4      INC B
001EA9 1EA9 EDA3            16      OUTI
001EAB 1EAB 3D               4      DEC A
001EAC 1EAC 20FA            12      JR  NZ,SDMA
001EAE 1EAE ED49            12      OUT (C),C       ;OUT $1F87,$87
001EB0 1EB0 3E80             7  FDCPAT: LD  A,$80       ;FDC COMMAND 書き換え
001EB2 1EB2 C5              11      PUSH    BC
001EB3 1EB3 CD071E          17      CALL    SECSET
001EB6 1EB6 2A561F          16      LD  HL,(DMAD+11)
001EB9 1EB9 23               6      INC HL
001EBA 1EBA 1106BB          10      LD  DE,$BB06    ;READ DMA
                                ;
001EBD 1EBD 3E03             7      LD  A,3
001EBF 1EBF CDEC1D          17      CALL    READY
001EC2 1EC2 ED78            12      IN  A,(C)
                                ;
001EC4 1EC4 C1              10      POP BC
001EC5 1EC5 ED51            12      OUT (C),D
001EC7 1EC7 ED59            12      OUT (C),E
001EC9 1EC9 ED58            12      IN  E,(C)
001ECB 1ECB ED50            12      IN  D,(C)
001ECD 1ECD 19              11      ADD HL,DE
001ECE 1ECE D1              10      POP DE
001ECF 1ECF 13               6      INC DE
001ED0 1ED0 FB               4      EI
001ED1 1ED1 CD161E          17      CALL    FDMOFF
001ED4 1ED4 B7               4      OR  A
001ED5 1ED5 C8              11      RET Z
001ED6 1ED6 1B               6      DEC DE
001ED7 1ED7 CB67             8      BIT 4,A
001ED9 1ED9 200F            12      JR  NZ,RNF
       1EDB                     DISKE2:
001EDB 1EDB 21221E          10      LD  HL,RETRY
001EDE 1EDE 35              11      DEC (HL)
001EDF 1EDF 20B9            12      JR  NZ,DISK2
001EE1 1EE1 D5              11      PUSH    DE
       1EE2                     ERRF:
001EE2 1EE2 D1              10      POP DE
001EE3 1EE3 3EFF             7      LD  A,$FF
       1EE5                     ERR:
001EE5 1EE5 BF               4      CP  A
001EE6 1EE6 37               4      SCF
001EE7 1EE7 C3161E          10      JP  FDMOFF
                                ;
       1EEA                     RNF:
001EEA 1EEA 2A041F          16      LD  HL,(_DRIVE)
001EED 1EED 261F             7      LD  H,$1F
001EEF 1EEF 7E               7      LD  A,(HL)
001EF0 1EF0 36FF            10      LD  (HL),$FF
001EF2 1EF2 B7               4      OR  A
001EF3 1EF3 28F0            12      JR  Z,ERR
                                ;
001EF5 1EF5 3E02             7      LD  A,2
001EF7 1EF7 32481F          13      LD  (_SEEKSP),A
001EFA 1EFA 18DF            12      JR  DISKE2
                                ;
       1EFC                     BIOSE:
                                ;
[EOF:X1DMA.ASM:SHIFT_JIS]
                                    INCLUDE "LWORK.ASM"
                                ;
                                ;   L-os Angeles WORK
                                ;
                                ;   LA WORKS
                                ;
001F00 1F00                         ORG $1F00
                                ;
001F00 1F00 FF                  _CYL0:  DB  $FF ;シリンダ
001F01 1F01 FF                  _CYL1:  DB  $FF ;シリンダ
001F02 1F02 FF                  _CYL2:  DB  $FF ;シリンダ
001F03 1F03 FF                  _CYL3:  DB  $FF ;シリンダ
001F04 1F04 00                  _DRIVE: DB  0   ;unit no.
001F05 1F05 00                  _WK1FD0:DB  0   ;=PORT$1FD0
001F06 1F06 0000                _SIZEH: DW  0   ;REAL SIZE=_SIZEH*65536+_SIZE
001F08 1F08 09                  _MSEC:  DB  9   ;MAX SECTOR
001F09 1F09 FF                  _ISEC:  DB  $FF ;
001F0A 1F0A 791D                _SECADD:DW  SECPAT+1;for 2HS
001F0C 1F0C 0000                _CLPS:  DW  0   ;CLUSTER POSITION
001F0E 1F0E 0000                _GCAD:  DW  0   ;シーケンシャル(_FGETC)
001F10 1F10 0000                _GCLN:  DW  0   ;    //
001F12 1F12 2F                  _GCEH:  DB  GCEH    ;    //
001F13 1F13 01                  _CLLN:  DB  1   ;    //
001F14 1F14 0000                _FBPS:  DW  0   ;WILD CARD関係
001F16 1F16 0000                _FBAD:  DW  0   ;    //
001F18 1F18 00                  _FBCNT: DB  0   ;    //
001F19 1F19 00                  _WILD:  DB  0   ;WILD CARDｼﾖｳ?
001F1A 1F1A 00                  _FILEN: DB  0   ;Search Files
001F1B 1F1B 00                  _DIRF:  DB  0
001F1C 1F1C 0000                _NDIRP: DW  0   ;現在のDIRの位置
001F1E 1F1E 002C                _DIRBF: DW  DTBUF   ;ディレクトリバッファ
001F20 1F20 5220                _DRDA:  DW  _DRD    ;1SEC=1024byte
001F22 1F22 5520                _DWTA:  DW  _DWT    ;     //
001F24 1F24 7320                _DRDWA: DW  _DRDW   ;1SEC=512byte
001F26 1F26 7620                _DWTWA: DW  _DWTW   ;     //
001F28 1F28 A020                _MTOFFA:DW  _FDMOFF ;FLOPPY DISK MOTOR OFF
001F2A 1F2A 8D1B                _GNCLA: DW  GNCL    ;GET Cluster from FAT
001F2C 1F2C B11B                _SNCLA: DW  SNCL    ;SET Cluster to FAT
001F2E 1F2E 3E1C                _M2D:   DW  M2D
001F30 1F30 501C                _M2HD:  DW  M2HD
001F32 1F32 191A                _FSEA:  DW  FILESE
001F34 1F34 361A                _NSEA:  DW  NEXTSE
001F36 1F36 0024                _FATBF1:DW  FATBF
001F38 1F38 00FF                _MEMAX1:DW  MEMAX
001F3A 1F3A 1B00                _CONYS: DW  CONYS
001F3C 1F3C 1C00                _CONYE: DW  CONYE
001F3E 1F3E 1E00                _CONXS: DW  CONXS
001F40 1F40 1F00                _CONXE: DW  CONXE
001F42 1F42 2600                _COLORF:DW  COLORF
001F44 1F44 08                  _MAXDRV:DB  MAXDRV
001F45 1F45 002C                _GCBUF: DW  DTBUF
001F47 1F47 3F                  _KYBFX: DB  KYBFX   ;ｾﾝｺｳﾆｭｳﾘｮｸﾉｻｲﾀﾞｲﾓｼﾞｽｳ
001F48 1F48 00                  _SEEKSP:DB  0   ;ｼｰｸｽﾋﾟｰﾄﾞ
001F49 1F49 0140                _LVER:  DB  VH,VL   ;LAﾊﾞｰｼﾞｮﾝ
                                ;
001F4B 1F4B C37DFB0FFFFF2C10    DMAD:   DB  $C3,$7D,$FB,$0F,$FF,$FF,$2C,$10     ;X1turbo
001F53 1F53 80928D0000CF01CF        DB  $80,$92,$8D,$00,$00,$CF,$01,$CF     ;DISK DMA
                                ;
       1F5B                     LWORKEND:
                                ;
                                ;   S-OS WORKS
                                ;
001F5B 1F5B                         ORG $1F5B
                                ;
001F5B 1F5B 19                  _MAXLN: DB  MAXLN
001F5C 1F5C 50                  _WIDTH: DB  WIDTH
001F5D 1F5D 41                  _DSK:   DB  "A"
001F5E 1F5E 0100                _FATPS: DW  1
001F60 1F60 0500                _DIRPS: DW  5
001F62 1F62 0024                _FATBF: DW  FATBF
001F64 1F64 002C                _DTBUF: DW  DTBUF
001F66 1F66 28                  _MXTRK: DB  40
001F67 1F67 00                  _DIRNO: DB  0   ;No Use
001F68 1F68 00C0                _WKSIZ: DW  WKSIZ
001F6A 1F6A 00FF                _MEMAX: DW  MEMAX
001F6C 1F6C 0000                _STKAD: DW  STKAD
001F6E 1F6E 0000                _EXADR: DW  0
001F70 1F70 0000                _DTADR: DW  0
001F72 1F72 0000                _SIZE:  DW  0
001F74 1F74 8014                _IBFAD: DW  FTYPE
001F76 1F76 00FF                _KBFAD: DW  KBFAD
001F78 1F78 0E00                _XYADR: DW  XYADR
001F7A 1F7A 0E00                _PRCNT: DW  XYADR   ;???
001F7C 1F7C 00                  _LPSW:  DB  0   ;No Use
001F7D 1F7D 41                  _DVSW:  DB  "A" ;カレントドライブ
001F7E 1F7E 0024                _USR:   DW  INIT
                                ;
[EOF:LWORK.ASM:SHIFT_JIS]
                                    INCLUDE "LJUMP.ASM"
                                ;
                                ;   L-os Angeles JUMP
                                ;
                                ;   S-OS Compatible Subroutain
                                ;
001F80 1F80                         ORG $1F80
                                ;
001F80 1F80 E1              10  _GETPC: POP HL
001F81 1F81 E9               4  JP_HL:  JP  (HL)
001F82 1F82 37               4  _ERR:   SCF
001F83 1F83 C9              10  _RET:   RET
001F84 1F84 4572726F7221070D    _ERRMES:DB  "Error!",$07,$0D,0
            00                  
       1F8D                     EMS:
                                ;
001F8E 1F8E                         ORG $1F8E
                                ;
001F8E 1F8E C30010          10  _MON:   JP  MON
       1F91                     _PEEKAT_:
001F91 1F91 C36F1C          10      JP  PEEKAT_
001F94 1F94 C34D1D          10  _PEEK:  JP  PEEK
       1F97                     _POKEAT_:
001F97 1F97 C3621C          10      JP  POKEAT_
001F9A 1F9A C3411D          10  _POKE:  JP  POKE
001F9D 1F9D C3EA1B          10  _FPRNT: JP  FPRINT
001FA0 1FA0 00               4  _FSAME: NOP     ;Not Support
001FA1 1FA1 BF               4      CP  A
001FA2 1FA2 C9              10      RET
001FA3 1FA3 C3F916          10  _FILE:  JP  FILE
001FA6 1FA6 C37316          10  _RDD:   JP  RDD
001FA9 1FA9 C3821F          10  _FCB:   JP  _ERR    ;Not Support
001FAC 1FAC C3EC15          10  _WRD:   JP  WRD
001FAF 1FAF C37815          10  _WOPEN: JP  WOPEN
001FB2 1FB2 C31F11          10  _HLHEX: JP  HLHEX
001FB5 1FB5 C35E11          10  _2HEX:  JP  AHEX
001FB8 1FB8 C36515          10  _HEX:   JP  HEX
001FBB 1FBB C35B15          10  _ASC:   JP  ASC
001FBE 1FBE C33315          10  _PRTHL: JP  PRTHL
001FC1 1FC1 C33815          10  _PRTHX: JP  PRTHX
001FC4 1FC4 C3F707          10  _BELL:  JP  BELL
001FC7 1FC7 C30B15          10  _PAUSE: JP  PAUSE
001FCA 1FCA C30415          10  _INKEY: JP  INKEY
001FCD 1FCD C3F614          10  _BRKEY: JP  BRKEY
001FD0 1FD0 C3DF01          10  _GETKY: JP  GETKY
001FD3 1FD3 C3D301          10  _GETL:  JP  GETL
001FD6 1FD6 C3821F          10  _LPTOF: JP  _ERR    ;Reserved Future
001FD9 1FD9 C3821F          10  _LPTON: JP  _ERR    ;Reserved Future
001FDC 1FDC C3DC12          10  _LPRNT: JP  LPRNT
001FDF 1FDF C3841C          10  _TAB:   JP  TAB
001FE2 1FE2 C3EA14          10  _MPRNT: JP  MPRINT
001FE5 1FE5 C3C914          10  _MSX:   JP  MSX
001FE8 1FE8 C3C414          10  _MSG:   JP  MSG
001FEB 1FEB C3121D          10  _NL:    JP  NL
001FEE 1FEE C3AD14          10  _LTNL:  JP  LTNL
001FF1 1FF1 C3A514          10  _PRNTS: JP  PRINTS
001FF4 1FF4 C3650B          10  _PRINT: JP  PRINT
001FF7 1FF7 C3231E          10  _VER:   JP  VER
001FFA 1FFA C30021          10  _HOT:   JP  HOT
001FFD 1FFD C30015          10  _COLD:  JP  COLD
002000 2000 C3821F          10  _DRDSB: JP  _ERR    ;Not Support
002003 2003 C3821F          10  _DWTSB: JP  _ERR    ;Not Support
002006 2006 C3EC17          10  _DIR:   JP  DIR
002009 2009 C3F918          10  _ROPEN: JP  ROPEN
00200C 200C C3821F          10  _SET:   JP  _ERR    ;Reserved Future
00200F 200F C3821F          10  _RESET: JP  _ERR    ;Reserved Future
002012 2012 C35E1A          10  _NAME:  JP  NAME
002015 2015 C3A51A          10  _KILL:  JP  KILL
002018 2018 C33F09          10  _CSR:   JP  CSR
00201B 201B C31709          10  _SCRN:  JP  SCRN
00201E 201E C3A50C          10  _LOC:   JP  LOC
002021 2021 C3AA02          10  _FLGET: JP  FLGET
002024 2024 C3F81A          10  _RDVSW: JP  RDVSW
002027 2027 C3DC14          10  _SDVSW: JP  SDVSW
00202A 202A C3821F          10  _INP:   JP  _ERR    ;Reserved Future
00202D 202D C3821F          10  _OUT:   JP  _ERR    ;Reserved Future
002030 2030 C31C1D          10  _WIDCH: JP  WIDCH
002033 2033 11841F          10  _ERROR: LD  DE,_ERRMES
002036 2036 CDE51F          17      CALL    _MSX
002039 2039 C3D020          10      JP  _KYBFC
                                ;
                                ;   LA Original Subroutain
                                ;
00203D 203D                         ORG $203D
                                ;
00203D 203D C3821F          10  _SYSTEM:JP  _ERR    ;Reserved Future
                                ;
002040 2040 C37320          10  _DRDC:  JP  _DRDW   ;書き換えあり
002043 2043 C37620          10  _DWTC:  JP  _DWTW   ;  //
002046 2046 C38D1B          10  _GNCL:  JP  GNCL    ;  //
002049 2049 C3B11B          10  _SNCL:  JP  SNCL    ;  //
00204C 204C C3A020          10  _MOTOFF:JP  _FDMOFF ;  //
                                ;
00204F 204F C3271B          10  _CLUST: JP  CLUST
                                ;
002052 2052 C3881E          10  _DRD:   JP  DRD
002055 2055 C3761E          10  _DWT:   JP  DWT
002058 2058 C3801E          10  _RDID:  JP  RDID
00205B 205B C36E1E          10  _WTTRK: JP  WTTRK
                                ;
00205E 205E C39416          10  _RDDX:  JP  RDDX
002061 2061 C33C16          10  _WRDX:  JP  WRDX
002064 2064 C3FF15          10  _WRDF:  JP  WRDF
002067 2067 C34F16          10  _WRDD:  JP  WRDD
                                ;
00206A 206A C3911C          10  _CHGDRV:JP  CHGDRV      ;Change Drive
00206D 206D C34A18          10  _DSKF:  JP  DSKF
002070 2070 C3321B          10  _FGETC: JP  FGETC
                                ;
002073 2073 C3841E          10  _DRDW:  JP  DRDW
002076 2076 C3721E          10  _DWTW:  JP  DWTW
                                ;
002079 2079 C30517          10  _FILEX: JP  FILEX
00207C 207C C35217          10  _FILED: JP  FILED
00207F 207F C3F217          10  _DIRX:  JP  DIRX
       2082                     _FNAMEX:
002082 2082 C36418          10      JP  FNAMEX
       2085                     _DEVADR:
002085 2085 C3101C          10      JP  DEVADR      ;IY=DEVICE ADDRESS
       2088                     _DEVADX:
002088 2088 C3131C          10      JP  DEVADX      ;      //
                                ;
       208B                     _CHKATT:
00208B 208B C3B214          10      JP  CHKATT
       208E                     _KILLS: 
00208E 208E C3CA1A          10      JP  KILLS
       2091                     _KILLSX:
002091 2091 C3CE1A          10      JP  KILLSX
                                ;
002094 2094 C38D15          10  _WOPENX:JP  WOPENX
002097 2097 C37E15          10  _WOPENH:JP  WOPENH
00209A 209A C35019          10  _COPEN: JP  COPEN
                                ;
00209D 209D C3F418          10  _NROPEN:JP  NROPEN
                                ;
0020A0 20A0 C3831F          10  _FDMOFF:JP  MOTOFF
                                ;
0020A3 20A3 C35519          10  _SOPEN: JP  SOPEN
0020A6 20A6 C35A19          10  _SOPENX:JP  SOPENX
0020A9 20A9 C3D319          10  _NOPEN: JP  NOPEN
0020AC 20AC C3E119          10  _NOPENX:JP  NOPENX
0020AF 20AF C33818          10  _RCLOSE:JP  RCLOSE
0020B2 20B2 C3861A          10  _WCLOSE:JP  WCLOSE
0020B5 20B5 C3D517          10  _NFPRT: JP  FPRINT2
                                ;
0020B8 20B8 C37C1C          10  _RDFAT: JP  RDFAT
0020BB 20BB C3071B          10  _WTFAT: JP  WTFAT
0020BE 20BE C39B1A          10  _WTDIR: JP  WTDIR
0020C1 20C1 C38F1A          10  _WTDIRX:JP  WTDIRX
0020C4 20C4 C3081C          10  _ENDCL: JP  ENDCL
                                ;
0020C7 20C7 C3C804          10  _PRNT0: JP  PRNT0
0020CA 20CA C34C15          10  _HEXHX: JP  HEXHX
0020CD 20CD C34715          10  _HEXHL: JP  HEXHL
0020D0 20D0 C3261D          10  _KYBFC: JP  KYBFC
0020D3 20D3 C32F1D          10  _KYBFS: JP  KYBFS
0020D6 20D6 C3181D          10  _COLOR: JP  COLOR
0020D9 20D9 C35C1D          10  _S1FD0: JP  S1FD0
0020DC 20DC C3EF22          10  _SPSK:  JP  SSKIP
0020DF 20DF C3E822          10  _SPSE:  JP  SPS2
0020E2 20E2 C3831F          10  _PRTTMS:JP  PRTTMS  ;ﾀｲﾑｽﾀﾝﾌﾟ表示
0020E5 20E5 C3831F          10  _SETTMS:JP  SETTMS  ;ﾀｲﾑｽﾀﾝﾌﾟｾｯﾄ
0020E8 20E8 C3BE1F          10  _PRTHLX:JP  _PRTHL
0020EB 20EB C35114          10  _CAP:   JP  CAP
                                ;
0020EE 20EE C3571D          10  _CINIT: JP  CINIT
0020F1 20F1 C31B21          10  _CMDANL:JP  CMDANL
0020F4 20F4 C33C21          10  _EXCMD: JP  EXCMD
0020F7 20F7 C39F22          10  _EXBAT: JP  EXBAT
0020FA 20FA C30422          10  _CEXE:  JP  C_EXE
0020FD 20FD C3F221          10  _CDIR:  JP  C_DIR
                                ;
[EOF:LJUMP.ASM:SHIFT_JIS]
                                    INCLUDE "LCOMMAND.ASM"
                                ;
                                ;   L-os Angeles COMMAND
                                ;
002100 2100                         ORG $2100
                                ;
       2100                     HOT:
002100 2100 ED7B6C1F        20      LD  SP,(_STKAD)
002104 2104 CDEE20          17      CALL    _CINIT
002107 2107 3E00             7      LD  A,$00
002109 2109 CDF41F          17      CALL    _PRINT
00210C 210C ED5B761F        20      LD  DE,(_KBFAD)
002110 2110 CDD31F          17      CALL    _GETL
002113 2113 CDF120          17      CALL    _CMDANL
002116 2116 DC3320          17      CALL    C,_ERROR
002119 2119 18E5            12      JR  HOT
                                ;
       211B                     CMDANL:             ;$211B
00211B 211B 1A               7      LD  A,(DE)
00211C 211C FE2A             7      CP  "*"
00211E 211E C8              11      RET Z
00211F 211F FE23             7      CP  "#"
002121 2121 13               6      INC DE
002122 2122 280C            12      JR  Z,CMDSOS
002124 2124 1B               6      DEC DE
002125 2125 CDDC20          17      CALL    _SPSK
002128 2128 13               6      INC DE
002129 2129 1A               7      LD  A,(DE)
00212A 212A 1B               6      DEC DE
00212B 212B FE21             7      CP  $21
00212D 212D D2FA20          10      JP  NC,_CEXE
       2130                     CMDSOS:
002130 2130 1A               7      LD  A,(DE)
002131 2131 F5              11      PUSH    AF
002132 2132 CDEE22          17      CALL    SS1
002135 2135 F1              10      POP AF
002136 2136 CDEB20          17      CALL    _CAP
002139 2139 C3F420          10      JP  _EXCMD
                                ;
       213C                     EXCMD:
00213C 213C FE20             7      CP  $20
00213E 213E CAFA20          10      JP  Z,_CEXE
002141 2141 FE21             7      CP  "!"
002143 2143 CA831F          10      JP  Z,BOOT
002146 2146 FE44             7      CP  "D"
002148 2148 CAFD20          10      JP  Z,_CDIR
00214B 214B FE4D             7      CP  "M"
00214D 214D CA8E1F          10      JP  Z,_MON
002150 2150 FE50             7      CP  "P"
002152 2152 CABA22          10      JP  Z,C_PATH
002155 2155 FE4C             7      CP  "L"
002157 2157 282C            12      JR  Z,C_LOAD
002159 2159 FE4E             7      CP  "N"
00215B 215B 2842            12      JR  Z,C_NAME
00215D 215D FE4B             7      CP  "K"
00215F 215F 284A            12      JR  Z,C_KILL
002161 2161 FE53             7      CP  "S"
002163 2163 284D            12      JR  Z,C_SAVE
002165 2165 FE4A             7      CP  "J"
002167 2167 2812            12      JR  Z,C_JUMP
002169 2169 FE57             7      CP  "W"
00216B 216B 2806            12      JR  Z,C_WITH
00216D 216D FE56             7      CP  "V"
00216F 216F 287E            12      JR  Z,C_DVSW
                                ;
002171 2171 A7               4      AND A
002172 2172 C9              10      RET
                                ;
       2173                     C_WITH:
002173 2173 3A5C1F          13      LD  A,(_WIDTH)
002176 2176 D629             7      SUB 41
002178 2178 C33020          10      JP  _WIDCH
                                ;
       217B                     C_JUMP:
00217B 217B CDB21F          17      CALL    _HLHEX
00217E 217E D8              11      RET C
00217F 217F C1              10      POP BC
002180 2180 01FA1F          10      LD  BC,_HOT
002183 2183 C5              11      PUSH    BC
002184 2184 E9               4      JP  (HL)
                                ;
       2185                     C_LOAD:
002185 2185 CDA31F          17      CALL    _FILE
002188 2188 D8              11      RET C
002189 2189 D5              11      PUSH    DE
00218A 218A CD0920          17      CALL    _ROPEN
00218D 218D D1              10      POP DE
00218E 218E D8              11      RET C
00218F 218F CDDB22          17      CALL    CCHEX
002192 2192 3803            12      JR  C,CLD1
002194 2194 22701F          16      LD  (_DTADR),HL
       2197                     CLD1:
002197 2197 CDF01B          17      CALL    FPRNTW
00219A 219A CDA61F          17      CALL    _RDD
00219D 219D 1847            12      JR  CLOADX
                                ;
       219F                     C_NAME:
00219F 219F CDA31F          17      CALL    _FILE
0021A2 21A2 D8              11      RET C
0021A3 21A3 1A               7      LD  A,(DE)
0021A4 21A4 FE20             7      CP  $20
0021A6 21A6 CA1220          10      JP  Z,_NAME
0021A9 21A9 37               4      SCF
0021AA 21AA C9              10      RET
                                ;
       21AB                     C_KILL:
0021AB 21AB CDA31F          17      CALL    _FILE
0021AE 21AE D8              11      RET C
0021AF 21AF C31520          10      JP  _KILL
                                ;
       21B2                     C_SAVE:
0021B2 21B2 3E01             7      LD  A,1
0021B4 21B4 CDA31F          17      CALL    _FILE
0021B7 21B7 D8              11      RET C
                                ;
0021B8 21B8 CDDB22          17      CALL    CCHEX
0021BB 21BB D8              11      RET C
0021BC 21BC 22701F          16      LD  (_DTADR),HL
                                ;
0021BF 21BF CDDB22          17      CALL    CCHEX
0021C2 21C2 D8              11      RET C
0021C3 21C3 ED4B701F        20      LD  BC,(_DTADR)
0021C7 21C7 ED42            15      SBC HL,BC
0021C9 21C9 23               6      INC HL
0021CA 21CA 22721F          16      LD  (_SIZE),HL
0021CD 21CD 69               4      LD  L,C     ;_DTADR
0021CE 21CE 60               4      LD  H,B
0021CF 21CF CDDB22          17      CALL    CCHEX
0021D2 21D2 226E1F          16      LD  (_EXADR),HL
                                ;
0021D5 21D5 D5              11      PUSH    DE
0021D6 21D6 CDAF1F          17      CALL    _WOPEN
0021D9 21D9 D1              10      POP DE
0021DA 21DA D8              11      RET C
                                ;
0021DB 21DB CDDB22          17      CALL    CCHEX
0021DE 21DE 3803            12      JR  C,CSV1
0021E0 21E0 22701F          16      LD  (_DTADR),HL
                                ;
       21E3                     CSV1:
0021E3 21E3 CDAC1F          17      CALL    _WRD
       21E6                     CLOADX:
0021E6 21E6 D8              11      RET C
                                ;
0021E7 21E7 CDE21F          17      CALL    _MPRNT
0021EA 21EA 4F6B0D00                DB  "Ok",$0D,0
0021EE 21EE C9              10      RET
                                ;
       21EF                     C_DVSW:
0021EF 21EF 1A               7      LD  A,(DE)
0021F0 21F0 183E            12      JR  CDVSW1
                                ;
       21F2                     C_DIR:
0021F2 21F2 CDA31F          17      CALL    _FILE
0021F5 21F5 D8              11      RET C
0021F6 21F6 3A8114          13      LD  A,(FNAME)
0021F9 21F9 FE20             7      CP  $20
0021FB 21FB 113B1C          10      LD  DE,DIRW
0021FE 21FE CC7C20          17      CALL    Z,_FILED
002201 2201 C37F20          10      JP  _DIRX
                                ;
       2204                     C_EXE:
002204 2204 21F522          10      LD  HL,PATHD
       2207                     CEX1:
002207 2207 7E               7      LD  A,(HL)
002208 2208 23               6      INC HL
002209 2209 FE40             7      CP  "@"
00220B 220B D8              11      RET C
00220C 220C CD6A20          17      CALL    _CHGDRV
00220F 220F 38F6            12      JR  C,CEX1
002211 2211 E5              11      PUSH    HL
002212 2212 D5              11      PUSH    DE
002213 2213 CD7920          17      CALL    _FILEX
002216 2216 380F            12      JR  C,CEXX
002218 2218 13               6      INC DE
002219 2219 ED535A22        20      LD  (EXPAT+1),DE
00221D 221D 3A8114          13      LD  A,(FNAME)
002220 2220 FE20             7      CP  $20
002222 2222 2807            12      JR  Z,SDVSWX
002224 2224 CD3322          17      CALL    CEX3
       2227                     CEXX:
002227 2227 D1              10      POP DE
002228 2228 E1              10      POP HL
002229 2229 18DC            12      JR  CEX1
                                ;
       222B                     SDVSWX:
00222B 222B D1              10      POP DE
00222C 222C D1              10      POP DE
00222D 222D 3A5D1F          13      LD  A,(_DSK)
       2230                     CDVSW1:
002230 2230 C32720          10      JP  _SDVSW
                                ;
       2233                     CEX3:
002233 2233 218914          10      LD  HL,FNAME+8
002236 2236 7E               7      LD  A,(HL)
002237 2237 FE20             7      CP  $20
002239 2239 2008            12      JR  NZ,CEX4
00223B 223B 3642            10      LD  (HL),"B"    ;B??
00223D 223D 23               6      INC HL
00223E 223E 363F            10      LD  (HL),"?"
002240 2240 23               6      INC HL
002241 2241 363F            10      LD  (HL),"?"
       2243                     CEX4:
002243 2243 CD0920          17      CALL    _ROPEN
002246 2246 D8              11      RET C
002247 2247 D1              10      POP DE
002248 2248 D1              10      POP DE
002249 2249 D1              10      POP DE
00224A 224A 3A9114          13      LD  A,(FNAME+$10)
00224D 224D FEA0             7      CP  $A0
00224F 224F C2F720          10      JP  NZ,_EXBAT
       2252                     CEX5:
002252 2252 CDA61F          17      CALL    _RDD
002255 2255 D8              11      RET C
       2256                     MSXB3:
002256 2256 2A6E1F          16      LD  HL,(_EXADR)
002259 2259 110000          10  EXPAT:  LD  DE,0
00225C 225C AF               4      XOR A
00225D 225D E9               4      JP  (HL)
                                ;
       225E                     MSXBIN:
00225E 225E 2A451F          16      LD  HL,(_GCBUF)
002261 2261 23               6      INC HL
002262 2262 5E               7      LD  E,(HL)      ;開始番地
002263 2263 23               6      INC HL
002264 2264 56               7      LD  D,(HL)
002265 2265 23               6      INC HL
002266 2266 ED53701F        20      LD  (_DTADR),DE
00226A 226A 4E               7      LD  C,(HL)      ;終了番地
00226B 226B 23               6      INC HL
00226C 226C 46               7      LD  B,(HL)
00226D 226D 23               6      INC HL
00226E 226E E5              11      PUSH    HL
00226F 226F 2A6A1F          16      LD  HL,(_MEMAX)
002272 2272 ED42            15      SBC HL,BC
002274 2274 E1              10      POP HL
002275 2275 D8              11      RET C
002276 2276 4E               7      LD  C,(HL)      ;実行番地
002277 2277 23               6      INC HL
002278 2278 46               7      LD  B,(HL)
002279 2279 23               6      INC HL
00227A 227A ED436E1F        20      LD  (_EXADR),BC
                                ;
00227E 227E ED4B721F        20      LD  BC,(_SIZE)
002282 2282 0B               6      DEC BC
002283 2283 78               4      LD  A,B
002284 2284 FE04             7      CP  4
002286 2286 300A            12      JR  NC,MSXB2
002288 2288 0B               6      DEC BC      ;1 ｸﾗｽﾀ ﾉ ｼｮﾘ
002289 2289 0B               6      DEC BC
00228A 228A 0B               6      DEC BC
00228B 228B 0B               6      DEC BC
00228C 228C 0B               6      DEC BC
00228D 228D 0B               6      DEC BC
00228E 228E EDB0                    LDIR
002290 2290 18C4            12      JR  MSXB3
       2292                     MSXB2:
002292 2292 01F903          10      LD  BC,$0400-7  ;2 ｸﾗｽﾀ ｲｼﾞｮｳ
002295 2295 EDB0                    LDIR
002297 2297 EB               4      EX  DE,HL
002298 2298 0640             7      LD  B,64
00229A 229A CD9716          17      CALL    RDD1
00229D 229D 18B7            12      JR  MSXB3
                                ;
       229F                     EXBAT:
00229F 229F CD7020          17      CALL    _FGETC
0022A2 22A2 D8              11      RET C
0022A3 22A3 FEFE             7      CP  $FE
0022A5 22A5 28B7            12      JR  Z,MSXBIN
                                ;
0022A7 22A7 CDD020          17      CALL    _KYBFC
       22AA                     BAT1:
0022AA 22AA B7               4      OR  A
0022AB 22AB C8              11      RET Z
0022AC 22AC FE1A             7      CP  $1A
0022AE 22AE C8              11      RET Z
0022AF 22AF FE0A             7      CP  $0A
0022B1 22B1 C4D320          17      CALL    NZ,_KYBFS
0022B4 22B4 CD7020          17      CALL    _FGETC
0022B7 22B7 30F1            12      JR  NC,BAT1
0022B9 22B9 C9              10      RET
                                ;
       22BA                     C_PATH:
0022BA 22BA EB               4      EX  DE,HL
0022BB 22BB 11F522          10      LD  DE,PATHD
0022BE 22BE 7E               7      LD  A,(HL)
0022BF 22BF B7               4      OR  A
0022C0 22C0 2006            12      JR  NZ,CPATH0
                                ;
0022C2 22C2 CDE51F          17      CALL    _MSX
0022C5 22C5 C3EE1F          10      JP  _LTNL
                                ;
       22C8                     CPATH0:
0022C8 22C8 060A             7      LD  B,PATHX
       22CA                     CPATH1:
0022CA 22CA 7E               7      LD  A,(HL)
0022CB 22CB B7               4      OR  A
0022CC 22CC 2806            12      JR  Z,CPATH2
0022CE 22CE FE40             7      CP  "@"
0022D0 22D0 3002            12      JR  NC,CPATH2
0022D2 22D2 3E40             7      LD  A,"@"
       22D4                     CPATH2:
0022D4 22D4 12               7      LD  (DE),A
0022D5 22D5 13               6      INC DE
0022D6 22D6 23               6      INC HL
0022D7 22D7 10F1            13      DJNZ    CPATH1
0022D9 22D9 A7               4      AND A
0022DA 22DA C9              10      RET
                                ;
       22DB                     CCHEX:
0022DB 22DB CD331C          17      CALL    CCHECK
0022DE 22DE 37               4      SCF
0022DF 22DF C0              11      RET NZ
0022E0 22E0 1A               7      LD  A,(DE)
0022E1 22E1 FE21             7      CP  $21
0022E3 22E3 D8              11      RET C
0022E4 22E4 C3B21F          10      JP  _HLHEX
                                ;
       22E7                     SPS1:
0022E7 22E7 13               6      INC DE
       22E8                     SPS2:
0022E8 22E8 1A               7      LD  A,(DE)
0022E9 22E9 FE21             7      CP  $21
0022EB 22EB 30FA            12      JR  NC,SPS1
0022ED 22ED C9              10      RET
                                ;
       22EE                     SS1:
0022EE 22EE 13               6      INC DE
       22EF                     SSKIP:
0022EF 22EF 1A               7      LD  A,(DE)
0022F0 22F0 FE20             7      CP  $20
0022F2 22F2 28FA            12      JR  Z,SS1
0022F4 22F4 C9              10      RET
                                ;
       000A                     PATHX   EQU 10
                                ;
0022F5 22F5 40                  PATHD:  DB  "@"
0022F6 22F6                         DS  PATHX-1
0022FF 22FF 00                      DB  0
                                ;
       2300                     CMDE:
[EOF:LCOMMAND.ASM:SHIFT_JIS]
                                    INCLUDE "LDEVICE.ASM"
                                ;
                                ;   L-os Angeles DEVICE
                                ;
002300 2300                         ORG $2300
                                ;
       2300                     DEVICE:
                                ;
                                ;   A:
                                ;
002300 0000                         ORG 0,$2300
                                
002300 0000 00                  DPB_FATLN:  DB  0
002301 0001 00                  DPB_FATID:  DB  0
002302 0002 0000                DPB_DRDC:   DW  0
002304 0004 0000                DPB_DWTC:   DW  0
002306 0006 0000                DPB_ADDCL:  DW  0   ;H($29=512,0=1024)L=CLADD
002308 0008 0000                DPB_MAXCL:  DW  0
00230A 000A 00                  DPB_FDMODE: DB  0   ;$FF=2D $FE=2HD
00230B 000B 00                  DPB_MAXDIR: DB  0
00230C 000C 00                  DPB_MAXCYL: DB  0
00230D 000D 00                  DPB_MAXSEC: DB  0
00230E 000E 00                  DPB_FATPS:  DB  0
00230F 000F 00                  DPB_INCSEC: DB  0   ;2=512 4=1024
002310 0010 00                  DPB_DIRPS:  DB  0
002311 0011 00                  DPB_ADDSEC: DB  0   ;Sector start for 9SCDRV
002312 0012 00                  DPB_DEVNO:  DB  0   ;Device NO
002313 0013 00                  DPB_UNITNO: DB  0
002314 0014 0000                DPB_MOTOFF: DW  0
002316 0016 0000                DPB_GNCL:   DW  0
002318 0018 0000                DPB_SNCL:   DW  0
00231A 001A 0000                DPB_SDIR:   DW  0
00231C 001C 00000000            DPB_NAME:   DB  0,0,0,0
                                ;
                                ;
                                ;   DEVICE  B:- H:
                                ;
[EOF:LDEVICE.ASM:UTF_8]
                                    INCLUDE "X1INIT.ASM"
                                ;
                                ;   L-os Angeles INIT
                                ;
002400 2400                         ORG $2400
                                ;
       2400                     INIT:
002400 2400 ED7B6C1F        20      LD  SP,(_STKAD)
                                ;
002404 2404 21FA1F          10      LD  HL,_HOT
002407 2407 227E1F          16      LD  (_USR),HL
00240A 240A 3ECD             7      LD  A,$CD
00240C 240C 21A109          10      LD  HL,$09A1
00240F 240F 320F01          13      LD  ($010F),A
002412 2412 221001          16      LD  ($0110),HL
                                ;
002415 2415 01C41F          10      LD  BC,$1FC4
002418 2418 3E0C             7      LD  A,$0C
00241A 241A ED79            12      OUT (C),A
                                ;
00241C 241C 0EC0             7      LD  C,$C0
00241E 241E ED71                    DB  $ED,$71
                                ;
002420 2420 0C               4      INC C
002421 2421 3E28             7      LD  A,40
002423 2423 ED79            12      OUT (C),A
                                ;
002425 2425 0C               4      INC C
002426 2426 ED71                    DB  $ED,$71
                                ;
002428 2428 0C               4      INC C
002429 2429 ED71                    DB  $ED,$71
                                ;
00242B 242B 0EC5             7      LD  C,$C5
00242D 242D ED71                    DB  $ED,$71
                                ;
       242F                     TEXT:
00242F 242F 0EB0             7      LD  C,$B0
002431 2431 3E80             7      LD  A,$80
002433 2433 ED79            12      OUT (C),A
002435 2435 1607             7      LD  D,7
002437 2437 0EB9             7      LD  C,$B9
002439 2439 213126          10      LD  HL,TEXTDT
       243C                     TEXT1:
00243C 243C 04               4      INC B
00243D 243D EDA3            16      OUTI
00243F 243F 0C               4      INC C
002440 2440 15               4      DEC D
002441 2441 20F9            12      JR  NZ,TEXT1
002443 2443 01B01F          10      LD  BC,$1FB0
002446 2446 ED71                    DB  $ED,$71
                                ;
002448 2448 0EC4             7      LD  C,$C4
00244A 244A ED71                    DB  $ED,$71
                                ;
00244C 244C 01011A          10      LD  BC,$1A01    ;printer init
00244F 244F ED78            12      IN  A,(C)
002451 2451 CB5F             8      BIT 3,A
002453 2453 2806            12      JR  Z,PRN
002455 2455 0E03             7      LD  C,$03
002457 2457 3E0F             7      LD  A,$0F
002459 2459 ED79            12      OUT (C),A
       245B                     PRN:
00245B 245B 3EE6             7      LD  A,$E6
00245D 245D CDFE0D          17      CALL    AT_COMOUT
002460 2460 CD490B          17      CALL    AT_IN49SB
002463 2463 CD490B          17      CALL    AT_IN49SB
002466 2466 FE01             7      CP  $01
002468 2468 280E            12      JR  Z,NORMAL
00246A 246A 01D03F          10      LD  BC,$3FD0
00246D 246D ED49            12      OUT (C),C
00246F 246F 3E37             7      LD  A,$37
002471 2471 D3D0            11      OUT ($D0),A
002473 2473 ED78            12      IN  A,(C)
002475 2475 B9               4      CP  C
002476 2476 2857            12      JR  Z,INIT0
       2478                     NORMAL:
002478 2478 210027          10      LD  HL,$2700    ;for normal X1
00247B 247B 11231E          10      LD  DE,CPU
00247E 247E 01D700          10      LD  BC,CPUE-CPU
002481 2481 EDB0                    LDIR
002483 2483 21D727          10      LD  HL,$2700+CPUE-CPU
002486 2486 116E08          10      LD  DE,SCR1
002489 2489 012300          10      LD  BC,AT_SCRE-AT_SCR1
00248C 248C EDB0                    LDIR
                                
00248E 248E 210000          10      LD  HL,0
002491 2491 220F08          16      LD  (X1PAT),HL
                                
002494 2494 3EAF             7      LD  A,0AFH      ;XOR    A
002496 2496 32770B          13      LD  (X1KPAT),A
                                
002499 2499 213C09          10      LD  HL,SCRNX
00249C 249C 221C20          16      LD  (_SCRN+1),HL
                                ;
00249F 249F 21231E          10      LD  HL,C_VER
0024A2 24A2 22F81F          16      LD  (_VER+1),HL
0024A5 24A5 219C1E          10      LD  HL,C_DRD
0024A8 24A8 225320          16      LD  (_DRD+1),HL
0024AB 24AB 214E1E          10      LD  HL,C_DWT
0024AE 24AE 225620          16      LD  (_DWT+1),HL
0024B1 24B1 21461E          10      LD  HL,C_WTTRK
0024B4 24B4 225C20          16      LD  (_WTTRK+1),HL
0024B7 24B7 21271E          10      LD  HL,C_RDFAT
0024BA 24BA 22B920          16      LD  (_RDFAT+1),HL
0024BD 24BD 21981E          10      LD  HL,C_DRDW
0024C0 24C0 227420          16      LD  (_DRDW+1),HL
0024C3 24C3 214A1E          10      LD  HL,C_DWTW
0024C6 24C6 227720          16      LD  (_DWTW+1),HL
                                ;
0024C9 24C9 21651E          10      LD  HL,DWTPAT+1
0024CC 24CC 22D01D          16      LD  (C_FDCPAT+1),HL
       24CF                     INIT0:
0024CF 24CF 3E1F             7      LD  A,$1F
0024D1 24D1 DBF0            11      IN  A,($F0)
0024D3 24D3 0F               4      RRCA
0024D4 24D4 3817            12      JR  C,INIT1
0024D6 24D6 CDF71F          17      CALL    _VER
0024D9 24D9 CB45             8      BIT 0,L
0024DB 24DB 2810            12      JR  Z,INIT1
                                ;
0024DD 24DD 213826          10      LD  HL,CRTCD
0024E0 24E0 11DD00          10      LD  DE,$DD
0024E3 24E3 011400          10      LD  BC,20
0024E6 24E6 EDB0                    LDIR
0024E8 24E8 3E03             7      LD  A,3
0024EA 24EA CDD920          17      CALL    _S1FD0
                                ;
       24ED                     INIT1:
0024ED 24ED CDA109          17      CALL    $09A1
                                
0024F0 24F0 3E50             7      LD  A,80
0024F2 24F2 CD3020          17      CALL    _WIDCH
                                ;
0024F5 24F5 CDE21F          17      CALL    _MPRNT
0024F8 24F8 4C2D6F7320416E67        DB "L-os Angeles for X1",0
            656C657320666F72    
            20583100            
00250C 250C CDF71F          17      CALL    _VER
00250F 250F CB45             8      BIT 0,L
002511 2511 3E2F             7      LD  A,"/"
002513 2513 CCF41F          17      CALL    Z,_PRINT
002516 2516 CDE21F          17      CALL    _MPRNT
002519 2519 747572626F207665        DB  "turbo version ",0
            7273696F6E2000      
002528 2528 3A491F          13      LD  A,(_LVER)
00252B 252B C630             7      ADD A,"0"
00252D 252D CDF41F          17      CALL    _PRINT
002530 2530 3E2E             7      LD  A,"."
002532 2532 CDF41F          17      CALL    _PRINT
002535 2535 3A4A1F          13      LD  A,(_LVER+1)
002538 2538 CDC11F          17      CALL    _PRTHX
00253B 253B CDE21F          17      CALL    _MPRNT
00253E 253E 2047616B7520284C        DB  " Gaku (Lovers/Tablacus)",13
            6F766572732F5461    
            626C61637573290D    
002556 2556 4F6B0D00                DB  "Ok",$0D,0
                                ;
00255A 255A CB45             8      BIT 0,L
00255C 255C 280A            12      JR  Z,INITN1
00255E 255E 3A8CFF          13      LD  A,($FF8C)
002561 2561 2A301F          16      LD  HL,(_M2HD)
002564 2564 FE02             7      CP  2
002566 2566 2803            12      JR  Z,INIT2
       2568                     INITN1:
002568 2568 2A2E1F          16      LD  HL,(_M2D)
       256B                     INIT2:
00256B 256B 227825          16      LD  (INIPAT+1),HL
                                ;
00256E 256E 3E41             7      LD  A,"A"
       2570                     INIT3:
002570 2570 F5              11      PUSH    AF
002571 2571 CD8820          17      CALL    _DEVADX
002574 2574 FDE5            15      PUSH    IY
002576 2576 D1              10      POP DE
002577 2577 213E1C          10  INIPAT: LD  HL,M2D
00257A 257A 011200          10      LD  BC,18
00257D 257D EDB0                    LDIR
                                ;
00257F 257F FD361287        19      LD  (IY+DPB_DEVNO),$87
                                ;
002583 2583 2A281F          16      LD  HL,(_MTOFFA)
002586 2586 FD7514          19      LD  (IY+DPB_MOTOFF),L
002589 2589 FD7415          19      LD  (IY+DPB_MOTOFF+1),H
                                ;
00258C 258C 2A2A1F          16      LD  HL,(_GNCLA)
00258F 258F FD7516          19      LD  (IY+DPB_GNCL),L
002592 2592 FD7417          19      LD  (IY+DPB_GNCL+1),H
                                ;
002595 2595 2A2C1F          16      LD  HL,(_SNCLA)
002598 2598 FD7518          19      LD  (IY+DPB_SNCL),L
00259B 259B FD7419          19      LD  (IY+DPB_SNCL+1),H
                                ;
00259E 259E FD361A00        19      LD  (IY+DPB_SDIR),0
0025A2 25A2 FD361B00        19      LD  (IY+DPB_SDIR+1),0
                                ;
0025A6 25A6 FD361C46        19      LD  (IY+DPB_NAME),"F"
0025AA 25AA FD361D44        19      LD  (IY+DPB_NAME+1),"D"
0025AE 25AE FD361E44        19      LD  (IY+DPB_NAME+2),"D"
0025B2 25B2 F1              10      POP AF
0025B3 25B3 C6EF             7      ADD A,"0"-"A"
0025B5 25B5 FD771F          19      LD  (IY+DPB_NAME+3),A
0025B8 25B8 D630             7      SUB "0"
0025BA 25BA FD7713          19      LD  (IY+DPB_UNITNO),A
0025BD 25BD C641             7      ADD A,"A"
0025BF 25BF 3C               4      INC A
0025C0 25C0 FE49             7      CP  MAXDRV+$41
0025C2 25C2 38AC            12      JR  C,INIT3
                                ;
0025C4 25C4 3E45             7      LD  A,"E"
                                ;
       25C6                     INIT4:
0025C6 25C6 F5              11      PUSH    AF
0025C7 25C7 CD8820          17      CALL    _DEVADX
0025CA 25CA FD360000        19      LD  (IY+0),0
0025CE 25CE FD361300        19      LD  (IY+DPB_UNITNO),0
0025D2 25D2 FD361207        19      LD  (IY+DPB_DEVNO),7
0025D6 25D6 FD361C20        19      LD  (IY+DPB_NAME),$20
0025DA 25DA FD361D20        19      LD  (IY+DPB_NAME+1),$20
0025DE 25DE FD361E20        19      LD  (IY+DPB_NAME+2),$20
0025E2 25E2 F1              10      POP AF
0025E3 25E3 3C               4      INC A
0025E4 25E4 FE49             7      CP  MAXDRV+$41
0025E6 25E6 38DE            12      JR  C,INIT4
                                ;
0025E8 25E8 3A87FF          13      LD  A,($FF87)
0025EB 25EB E603             7      AND 3
0025ED 25ED C641             7      ADD A,"A"
0025EF 25EF 322E26          13      LD  (AUTODV),A
0025F2 25F2 CD2720          17      CALL    _SDVSW
0025F5 25F5 CD6A20          17      CALL    _CHGDRV
0025F8 25F8 CD161E          17      CALL    FDMOFF
                                ;
0025FB 25FB 21FA1F          10      LD  HL,_HOT
0025FE 25FE E5              11      PUSH    HL
0025FF 25FF CDD020          17      CALL    _KYBFC
002602 2602 3EE6             7      LD  A,$E6
002604 2604 CDFE0D          17      CALL    AT_COMOUT
002607 2607 CD490B          17      CALL    AT_IN49SB
00260A 260A CD490B          17      CALL    AT_IN49SB
00260D 260D FE03             7      CP  3
00260F 260F C8              11      RET Z
002610 2610 FE1B             7      CP  $1B
002612 2612 C8              11      RET Z
                                ;
002613 2613 212626          10      LD  HL,AUTOD
002616 2616 ED5B761F        20      LD  DE,(_KBFAD)
00261A 261A 010B00          10      LD  BC,AUTOE-AUTOD
00261D 261D EDB0                    LDIR
00261F 261F ED5B761F        20      LD  DE,(_KBFAD)
002623 2623 C3FA20          10      JP  _CEXE
                                ;
002626 2626 434F4D4D414E4420    AUTOD:  DB  "COMMAND "
00262E 262E 413A00              AUTODV: DB  "A:",0
       2631                     AUTOE:
                                ;
002631 2631 030C0F30333C3F      TEXTDT: DB  $03,$0C,$0F,$30,$33,$3C,$3F
                                ;
002638 2638 35282D841B00191A    CRTCD:  DB  $35,$28,$2D,$84,$1B,$00,$19,$1A,$00,$0F
            000F                
002642 2642 0000000000006B50        DB  $00,$00,$00,$00,$00,$00,$6B,$50,$59,$88
            5988                
                                ;
       264C                     INITE:
[EOF:X1INIT.ASM:UTF_8]
                                    INCLUDE "X1BIOS.ASM"
       264C                     BIOS_SRC:
00264C FF51                         ORG $FF00+81,BIOS_SRC
                                
       FF51                     BIOS_DEST:
       FF51                     BIOS1:
00264C FF51 CD59FF          17      CALL    BIOS3
00264F FF54 061E             7      LD  B,01EH
002651 FF56 ED79            12      OUT (C),A
002653 FF58 C9              10      RET
       FF59                     BIOS3:
002654 FF59 C5              11      PUSH    BC
002655 FF5A 061D             7      LD  B,01DH
002657 FF5C ED79            12      OUT (C),A
002659 FF5E C9              10      RET
       FF5F                     CHECK_BIOS:
00265A FF5F F3               4      DI
00265B FF60 061D             7      LD  B,01DH
00265D FF62 ED79            12      OUT (C),A       ;BIOS ON
00265F FF64 3A512F          13      LD  A,(02F51H)
002662 FF67 04               4      INC B       ;B=01EH
002663 FF68 ED79            12      OUT (C),A       ;BIOS OFF
002665 FF6A FB               4      EI
002666 FF6B C9              10      RET
       FF6C                     BIOS_END:
[EOF:X1BIOS.ASM:UTF_8]
                                    INCLUDE "X1CPU.ASM"
                                ;
                                ;   L-os Angeles CPU
                                ;
                                ;   DISK I/O (CPU)
                                ;
002700 1E23                         ORG DMA,$2700
                                ;
       1E23                     CPU:
                                ;
       1E23                     C_VER:
002700 1E23 218020          10      LD  HL,$2080
002703 1E26 C9              10      RET
                                ;
       1E27                     C_RDFAT:
002704 1E27 CD371E          17      CALL    C_RDFATS
002707 1E2A D8              11      RET C
002708 1E2B 2A621F          16      LD  HL,(_FATBF)
00270B 1E2E 7E               7      LD  A,(HL)
00270C 1E2F FDBE01           7      CP  (IY+DPB_FATID)
00270F 1E32 C2CF19          10      JP  NZ,RDDERR
002712 1E35 B7               4      OR  A
002713 1E36 C9              10      RET
                                ;
       1E37                     C_RDFATS:
002714 1E37 CD8520          17      CALL    _DEVADR
                                ;
002717 1E3A CDFC1A          17      CALL    FATS
                                ;
       1E3D                     C_RDFATL:
00271A 1E3D C5              11      PUSH    BC
00271B 1E3E CD4020          17      CALL    _DRDC
00271E 1E41 C1              10      POP BC
00271F 1E42 D8              11      RET C
002720 1E43 10F8            13      DJNZ    C_RDFATL
002722 1E45 C9              10      RET
                                ;
       1E46                     C_WTTRK:
002723 1E46 3EF0             7      LD  A,$F0
002725 1E48 1806            12      JR  C_WTTRK1
                                ;
       1E4A                     C_DWTW:
002727 1E4A CD4E1E          17      CALL    C_DWT       ;512/sector
00272A 1E4D D8              11      RET C
                                ;
       1E4E                     C_DWT:
00272B 1E4E 3EA0             7      LD  A,$A0
       1E50                     C_WTTRK1:
00272D 1E50 32651E          13      LD  (DWTPAT+1),A
                                ;
002730 1E53 3E05             7      LD  A,5     ;リトライカウント
002732 1E55 32221E          13      LD  (RETRY),A
                                ;
       1E58                     DWT0:
002735 1E58 D5              11      PUSH    DE
002736 1E59 E5              11      PUSH    HL
002737 1E5A 22E41E          16      LD  (DHLPAT+1),HL
00273A 1E5D CD671D          17      CALL    SEEK        ;ディスクライト
00273D 1E60 E1              10      POP HL
00273E 1E61 3829            12      JR  C,ERRD
002740 1E63 F3               4      DI
       1E64                     DWTPAT:
002741 1E64 3EA0             7      LD  A,$A0
002743 1E66 CD071E          17      CALL    SECSET
002746 1E69 0EFB             7      LD  C,$FB
                                ;
       1E6B                     DWT1:
002748 1E6B 56               7      LD  D,(HL)
       1E6C                     DWT2:
002749 1E6C 78               4      LD  A,B
00274A 1E6D DBF8            11      IN  A,($F8)
00274C 1E6F 0F               4      RRCA
00274D 1E70 3009            12      JR  NC,DWT4
00274F 1E72 0F               4      RRCA
002750 1E73 30F7            12      JR  NC,DWT2
       1E75                     DWT3:
002752 1E75 ED51            12      OUT (C),D
002754 1E77 23               6      INC HL
002755 1E78 C36B1E          10      JP  DWT1
                                ;
       1E7B                     DWT4:
002758 1E7B 3D               4      DEC A
002759 1E7C 28F7            12      JR  Z,DWT3
00275B 1E7E 3C               4      INC A
00275C 1E7F FB               4      EI
00275D 1E80 D1              10      POP DE
00275E 1E81 13               6      INC DE
00275F 1E82 CD161E          17      CALL    FDMOFF
002762 1E85 C8              11      RET Z
002763 1E86 CDDA1E          17      CALL    DISKC
       1E89                     DWTN:
002766 1E89 20CD            12      JR  NZ,DWT0
002768 1E8B D5              11      PUSH    DE
       1E8C                     ERRD:
002769 1E8C D1              10      POP DE
       1E8D                     ERRW:
00276A 1E8D 3EFF             7      LD  A,$FF
       1E8F                     ERRZ:
00276C 1E8F BF               4      CP  A
00276D 1E90 37               4      SCF
00276E 1E91 C3161E          10      JP  FDMOFF
                                ;
       1E94                     C_RDID:
002771 1E94 3EC0             7      LD  A,$C0
002773 1E96 1806            12      JR  C_RDID1
                                ;
       1E98                     C_DRDW:
002775 1E98 CD9C1E          17      CALL    C_DRD       ;512/sector
002778 1E9B D8              11      RET C
                                ;
       1E9C                     C_DRD:
002779 1E9C 3E80             7      LD  A,$80
       1E9E                     C_RDID1:
00277B 1E9E 32B61E          13      LD  (DRDPAT+1),A
00277E 1EA1 32651E          13      LD  (DWTPAT+1),A
                                ;
002781 1EA4 3E05             7      LD  A,5     ;リトライカウント
002783 1EA6 32221E          13      LD  (RETRY),A
                                ;
       1EA9                     DRD0:
002786 1EA9 D5              11      PUSH    DE
002787 1EAA E5              11      PUSH    HL
002788 1EAB 22E41E          16      LD  (DHLPAT+1),HL
00278B 1EAE CD671D          17      CALL    SEEK        ;ディスクリード
00278E 1EB1 E1              10      POP HL
00278F 1EB2 38D8            12      JR  C,ERRD
002791 1EB4 F3               4      DI
       1EB5                     DRDPAT:
002792 1EB5 3E80             7      LD  A,$80
002794 1EB7 CD071E          17      CALL    SECSET
002797 1EBA 0EFB             7      LD  C,$FB
       1EBC                     DRD1:
002799 1EBC 78               4      LD  A,B
00279A 1EBD DBF8            11      IN  A,($F8)
00279C 1EBF 0F               4      RRCA
00279D 1EC0 3009            12      JR  NC,DRD3
00279F 1EC2 0F               4      RRCA
0027A0 1EC3 30F7            12      JR  NC,DRD1
0027A2 1EC5 EDA2            16      INI
0027A4 1EC7 04               4      INC B
0027A5 1EC8 C3BC1E          10      JP  DRD1
                                ;
       1ECB                     DRD3:
0027A8 1ECB B7               4      OR  A
0027A9 1ECC FB               4      EI
0027AA 1ECD D1              10      POP DE
0027AB 1ECE 13               6      INC DE
0027AC 1ECF CD161E          17      CALL    FDMOFF
0027AF 1ED2 C8              11      RET Z
0027B0 1ED3 CDDA1E          17      CALL    DISKC
       1ED6                     DRDN:
0027B3 1ED6 20D1            12      JR  NZ,DRD0
0027B5 1ED8 18B3            12      JR  ERRW
                                ;
       1EDA                     DISKC:
0027B7 1EDA 1B               6      DEC DE
0027B8 1EDB CB5F             8      BIT 3,A
0027BA 1EDD 200A            12      JR  NZ,C_RNF
       1EDF                     DISKD:
0027BC 1EDF 21221E          10      LD  HL,RETRY
0027BF 1EE2 35              11      DEC (HL)
0027C0 1EE3 210000          10  DHLPAT: LD  HL,0
0027C3 1EE6 3EFF             7      LD  A,$FF
0027C5 1EE8 C9              10      RET
                                ;
       1EE9                     C_RNF:
0027C6 1EE9 2A041F          16      LD  HL,(_DRIVE)
0027C9 1EEC 261F             7      LD  H,$1F
0027CB 1EEE 7E               7      LD  A,(HL)
0027CC 1EEF 36FF            10      LD  (HL),$FF
0027CE 1EF1 B7               4      OR  A
0027CF 1EF2 C8              11      RET Z
                                ;
0027D0 1EF3 3E02             7      LD  A,2
0027D2 1EF5 32481F          13      LD  (_SEEKSP),A
0027D5 1EF8 18E5            12      JR  DISKD
                                ;
       1EFA                     CPUE:
0027D7 086E                         ORG SCR1,$2700+CPUE-CPU
       086E                     AT_SCR1:
0027D7 086E D9               4      EXX
0027D8 086F C5              11      PUSH    BC
0027D9 0870 015020          10      LD  BC,02000H+80
0027DC 0873 D9               4      EXX
0027DD 0874 C5              11      PUSH    BC
0027DE 0875 010020          10      LD  BC,02000H
                                
0027E1 0878 67               4      LD  H,A
0027E2 0879 B7               4      OR  A
       087A                     AT_SCRUP1:
0027E3 087A 281E            12      JR  Z,AT_SCRCL
0027E5 087C C5              11      PUSH    BC
0027E6 087D CBE0             8      SET 4,B
0027E8 087F D9               4      EXX
0027E9 0880 C5              11      PUSH    BC
0027EA 0881 CBE0             8      SET 4,B
0027EC 0883 D9               4      EXX
0027ED 0884 CDB108          17      CALL    AT_UPSUB
0027F0 0887 D9               4      EXX
0027F1 0888 C1              10      POP BC
0027F2 0889 D9               4      EXX
0027F3 088A C1              10      POP BC
0027F4 088B CDB108          17      CALL    AT_UPSUB
0027F7 088E 25               4      DEC H
0027F8 088F 18E9            12      JR  AT_SCRUP1
                                
       0891                     AT_SCRE:
[EOF:X1CPU.ASM:SHIFT_JIS]
[EOF:X1.ASM:UTF_8]
